{
  "version": 3,
  "sources": ["../../../../../apps/frappe/frappe/public/js/frappe/form/script_manager.js", "frappe-html:/home/server/pro-bench/apps/frappe/frappe/public/js/frappe/form/templates/address_list.html", "frappe-html:/home/server/pro-bench/apps/frappe/frappe/public/js/frappe/form/templates/contact_list.html", "frappe-html:/home/server/pro-bench/apps/frappe/frappe/public/js/frappe/form/templates/form_dashboard.html", "frappe-html:/home/server/pro-bench/apps/frappe/frappe/public/js/frappe/form/templates/form_footer.html", "frappe-html:/home/server/pro-bench/apps/frappe/frappe/public/js/frappe/form/templates/form_links.html", "frappe-html:/home/server/pro-bench/apps/frappe/frappe/public/js/frappe/form/templates/form_sidebar.html", "frappe-html:/home/server/pro-bench/apps/frappe/frappe/public/js/frappe/form/templates/print_layout.html", "frappe-html:/home/server/pro-bench/apps/frappe/frappe/public/js/frappe/form/templates/report_links.html", "frappe-html:/home/server/pro-bench/apps/frappe/frappe/public/js/frappe/form/templates/set_sharing.html", "frappe-html:/home/server/pro-bench/apps/frappe/frappe/public/js/frappe/form/templates/timeline_message_box.html", "frappe-html:/home/server/pro-bench/apps/frappe/frappe/public/js/frappe/form/templates/users_in_sidebar.html", "../../../../../apps/frappe/frappe/public/js/frappe/views/formview.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/quick_entry.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/linked_with.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/form_viewers.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/toolbar.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/section.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/dashboard.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/workflow.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/save.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/print_utils.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/success_action.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/form.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/script_helpers.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/assign_to.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/attachments.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/share.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/review.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/document_follow.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/user_image.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/form_sidebar_users.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/form_sidebar.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/base_timeline.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/version_timeline_content_builder.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/form_timeline.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/footer.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/form_tour.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/undo_manager.js", "../../../../../apps/frappe/frappe/public/js/frappe/meta_tag.js", "../../../../../apps/frappe/frappe/public/js/frappe/doctype/index.js"],
  "sourcesContent": ["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form.handlers\");\n\nwindow.extend_cscript = (cscript, controller_object) => {\n\t$.extend(cscript, controller_object);\n\tif (cscript && controller_object) {\n\t\tcscript.__proto__ = controller_object.__proto__;\n\t}\n\treturn cscript;\n};\n\nfrappe.ui.form.get_event_handler_list = function(doctype, fieldname) {\n\tif(!frappe.ui.form.handlers[doctype]) {\n\t\tfrappe.ui.form.handlers[doctype] = {};\n\t}\n\tif(!frappe.ui.form.handlers[doctype][fieldname]) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\treturn frappe.ui.form.handlers[doctype][fieldname];\n}\n\nfrappe.ui.form.on = frappe.ui.form.on_change = function(doctype, fieldname, handler) {\n\tvar add_handler = function(fieldname, handler) {\n\t\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\n\t\tlet _handler = (...args) => {\n\t\t\ttry {\n\t\t\t\treturn handler(...args);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(handler);\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\n\t\thandler_list.push(_handler);\n\n\t\t// add last handler to events so it can be called as\n\t\t// frm.events.handler(frm)\n\t\tif(cur_frm && cur_frm.doctype===doctype) {\n\t\t\tcur_frm.events[fieldname] = _handler;\n\t\t}\n\t}\n\n\tif (!handler && $.isPlainObject(fieldname)) {\n\t\t// a dict of handlers {fieldname: handler, ...}\n\t\tfor (var key in fieldname) {\n\t\t\tvar fn = fieldname[key];\n\t\t\tif (typeof fn === \"function\") {\n\t\t\t\tadd_handler(key, fn);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tadd_handler(fieldname, handler);\n\t}\n}\n\n// remove standard event handlers\nfrappe.ui.form.off = function(doctype, fieldname, handler) {\n\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\tif(handler_list.length) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\n\tif(cur_frm && cur_frm.doctype===doctype && cur_frm.events[fieldname]) {\n\t\tdelete cur_frm.events[fieldname];\n\t}\n\n\tif(cur_frm && cur_frm.cscript && cur_frm.cscript[fieldname]) {\n\t\tdelete cur_frm.cscript[fieldname];\n\t}\n}\n\n\nfrappe.ui.form.trigger = function(doctype, fieldname) {\n\tcur_frm.script_manager.trigger(fieldname, doctype);\n}\n\nfrappe.ui.form.ScriptManager = class ScriptManager {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\tmake(ControllerClass) {\n\t\tthis.frm.cscript = extend_cscript(this.frm.cscript,\n\t\t\tnew ControllerClass({frm: this.frm}));\n\t}\n\ttrigger(event_name, doctype, name) {\n\t\t// trigger all the form level events that\n\t\t// are bound to this event_name\n\t\tlet me = this;\n\t\tdoctype = doctype || this.frm.doctype;\n\t\tname = name || this.frm.docname;\n\n\t\tlet tasks = [];\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\n\t\t// helper for child table\n\t\tthis.frm.selected_doc = frappe.get_doc(doctype, name);\n\n\t\tlet runner = (_function, is_old_style) => {\n\t\t\tlet _promise = null;\n\t\t\tif(is_old_style) {\n\t\t\t\t// old style arguments (doc, cdt, cdn)\n\t\t\t\t_promise = me.frm.cscript[_function](me.frm.doc, doctype, name);\n\t\t\t} else {\n\t\t\t\t// new style (frm, doctype, name)\n\t\t\t\t_promise = _function(me.frm, doctype, name);\n\t\t\t}\n\n\t\t\t// if the trigger returns a promise, return it,\n\t\t\t// or use the default promise frappe.after_ajax\n\t\t\tif (_promise && _promise.then) {\n\t\t\t\treturn _promise;\n\t\t\t} else {\n\t\t\t\treturn frappe.after_server_call();\n\t\t\t}\n\t\t};\n\n\t\t// make list of functions to be run serially\n\t\thandlers.new_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, false);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, false));\n\t\t\t}\n\t\t});\n\n\t\thandlers.old_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, true);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, true));\n\t\t\t}\n\t\t});\n\n\t\t// run them serially\n\t\treturn frappe.run_serially(tasks);\n\t}\n\thas_handlers(event_name, doctype) {\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\t\treturn handlers && (handlers.old_style.length || handlers.new_style.length);\n\t}\n\tget_handlers(event_name, doctype) {\n\t\t// returns list of all functions to be called (old style and new style)\n\t\tlet me = this;\n\t\tlet handlers = {\n\t\t\told_style: [],\n\t\t\tnew_style: []\n\t\t};\n\t\tif(frappe.ui.form.handlers[doctype] && frappe.ui.form.handlers[doctype][event_name]) {\n\t\t\t$.each(frappe.ui.form.handlers[doctype][event_name], function(i, fn) {\n\t\t\t\thandlers.new_style.push(fn);\n\t\t\t});\n\t\t}\n\t\tif(this.frm.cscript[event_name]) {\n\t\t\thandlers.old_style.push(event_name);\n\t\t}\n\t\tif(this.frm.cscript[\"custom_\" + event_name]) {\n\t\t\thandlers.old_style.push(\"custom_\" + event_name);\n\t\t}\n\t\treturn handlers;\n\t}\n\tsetup() {\n\t\tconst doctype = this.frm.meta;\n\t\tconst me = this;\n\t\tlet client_script;\n\n\t\t// process the custom script for this form\n\t\tif (this.frm.doctype_layout) {\n\t\t\tclient_script = this.frm.doctype_layout.client_script;\n\t\t} else {\n\t\t\tclient_script = doctype.__js;\n\t\t}\n\n\t\tif (client_script) {\n\t\t\teval(client_script);\n\t\t}\n\n\t\tif (!this.frm.doctype_layout && doctype.__custom_js) {\n\t\t\ttry {\n\t\t\t\teval(doctype.__custom_js);\n\t\t\t} catch(e) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error in Client Script'),\n\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\tmessage: '<pre class=\"small\"><code>' + e.stack  + '</code></pre>'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setup_add_fetch(df) {\n\t\t\tlet is_read_only_field = (\n\t\t\t\t['Data', 'Read Only', 'Text', 'Small Text', 'Currency', 'Check', 'Text Editor', 'Attach Image',\n\t\t\t\t'Code', 'Link', 'Float', 'Int', 'Date', 'Select', 'Duration'].includes(df.fieldtype)\n\t\t\t\t|| df.read_only == 1\n\t\t\t\t|| df.is_virtual == 1\n\t\t\t)\n\n\t\t\tif (\n\t\t\t\tis_read_only_field\n\t\t\t\t&& df.fetch_from\n\t\t\t\t&& df.fetch_from.indexOf(\".\") != -1\n\t\t\t) {\n\t\t\t\tvar parts = df.fetch_from.split(\".\");\n\t\t\t\tme.frm.add_fetch(parts[0], parts[1], df.fieldname, df.parent);\n\t\t\t}\n\t\t}\n\n\t\t// setup add fetch\n\t\t$.each(this.frm.fields, function(i, field) {\n\t\t\tsetup_add_fetch(field.df);\n\t\t\tif(frappe.model.table_fields.includes(field.df.fieldtype)) {\n\t\t\t\t$.each(frappe.meta.get_docfields(field.df.options, me.frm.docname), function(i, df) {\n\t\t\t\t\tsetup_add_fetch(df);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// css\n\t\tdoctype.__css && frappe.dom.set_style(doctype.__css);\n\n\t\tthis.trigger('setup');\n\t}\n\tlog_error(caller, e) {\n\t\tfrappe.show_alert({message: __(\"Error in Client Script.\"), indicator: \"error\"});\n\t\tconsole.group && console.group();\n\t\tconsole.log(\"----- error in client script -----\");\n\t\tconsole.log(\"method: \" + caller);\n\t\tconsole.log(e);\n\t\tconsole.log(\"error message: \" + e.message);\n\t\tconsole.trace && console.trace();\n\t\tconsole.log(\"----- end of error message -----\");\n\t\tconsole.group && console.groupEnd();\n\t}\n\tcopy_from_first_row(parentfield, current_row, fieldnames) {\n\t\tvar data = this.frm.doc[parentfield];\n\t\tif(data.length===1 || data[0]===current_row) return;\n\n\t\tif(typeof fieldnames==='string') {\n\t\t\tfieldnames = [fieldnames];\n\t\t}\n\n\t\t$.each(fieldnames, function(i, fieldname) {\n\t\t\tfrappe.model.set_value(current_row.doctype, current_row.name, fieldname,\n\t\t\t\tdata[0][fieldname]);\n\t\t});\n\t}\n};\n", "\n\tfrappe.templates['address_list'] = `<div class=\"clearfix\"></div>\n{% for(var i=0, l=addr_list.length; i<l; i++) { %}\n<div class=\"address-box\">\n\t<p class=\"h6\">\n\t\t{%= i+1 %}. {%= addr_list[i].address_title %}{% if(addr_list[i].address_type!=\"Other\") { %}\n\t\t<span class=\"text-muted\">({%= __(addr_list[i].address_type) %})</span>{% } %}\n\t\t{% if(addr_list[i].is_primary_address) { %}\n\t\t<span class=\"text-muted\">({%= __(\"Primary\") %})</span>{% } %}\n\t\t{% if(addr_list[i].is_shipping_address) { %}\n\t\t<span class=\"text-muted\">({%= __(\"Shipping\") %})</span>{% } %}\n\n\t\t<a href=\"/app/Form/Address/{%= encodeURIComponent(addr_list[i].name) %}\" class=\"btn btn-default btn-xs pull-right\"\n\t\t\tstyle=\"margin-top:-3px; margin-right: -5px;\">\n\t\t\t{%= __(\"Edit\") %}</a>\n\t</p>\n\t<p>{%= addr_list[i].display %}</p>\n</div>\n{% } %}\n{% if(!addr_list.length) { %}\n<p class=\"text-muted small\">{%= __(\"No address added yet.\") %}</p>\n{% } %}\n<p><button class=\"btn btn-xs btn-default btn-address\">{{ __(\"New Address\") }}</button></p>`;\n", "\n\tfrappe.templates['contact_list'] = `<div class=\"clearfix\"></div>\n{% for(var i=0, l=contact_list.length; i<l; i++) { %}\n\t<div class=\"address-box\">\n\t\t<p class=\"h6 flex align-center\">\n\t\t\t{%= contact_list[i].first_name %} {%= contact_list[i].last_name %}\n\t\t\t{% if(contact_list[i].is_primary_contact) { %}\n\t\t\t\t<span class=\"text-muted\">&nbsp;({%= __(\"Primary\") %})</span>\n\t\t\t{% } %}\n\t\t\t{% if(contact_list[i].designation){ %}\n\t\t\t <span class=\"text-muted\">&ndash; {%= contact_list[i].designation %}</span>\n\t\t\t{% } %}\n\t\t\t<a href=\"/app/Form/Contact/{%= encodeURIComponent(contact_list[i].name) %}\"\n\t\t\t\tclass=\"btn btn-xs btn-default ml-auto\">\n\t\t\t\t{%= __(\"Edit\") %}\n\t\t\t</a>\n\t\t</p>\n\t\t{% if (contact_list[i].phones || contact_list[i].email_ids) { %}\n\t\t<p>\n\t\t\t{% if(contact_list[i].phone) { %}\n\t\t\t\t{%= __(\"Phone\") %}: {%= contact_list[i].phone %}<span class=\"text-muted\"> ({%= __(\"Primary\") %})</span><br>\n\t\t\t{% endif %}\n\t\t\t{% if(contact_list[i].mobile_no) { %}\n\t\t\t\t{%= __(\"Mobile No\") %}: {%= contact_list[i].mobile_no %}<span class=\"text-muted\"> ({%= __(\"Primary\") %})</span><br>\n\t\t\t{% endif %}\n\t\t\t{% if(contact_list[i].phone_nos) { %}\n\t\t\t\t{% for(var j=0, k=contact_list[i].phone_nos.length; j<k; j++) { %}\n\t\t\t\t\t{%= __(\"Phone\") %}: {%= contact_list[i].phone_nos[j].phone %}<br>\n\t\t\t\t{% } %}\n\t\t\t{% endif %}\n\t\t</p>\n\t\t<p>\n\t\t\t{% if(contact_list[i].email_id) { %}\n\t\t\t\t{%= __(\"Email\") %}: {%= contact_list[i].email_id %}<span class=\"text-muted\"> ({%= __(\"Primary\") %})</span><br>\n\t\t\t{% endif %}\n\t\t\t{% if(contact_list[i].email_ids) { %}\n\t\t\t\t{% for(var j=0, k=contact_list[i].email_ids.length; j<k; j++) { %}\n\t\t\t\t\t{%= __(\"Email\") %}: {%= contact_list[i].email_ids[j].email_id %}<br>\n\t\t\t\t{% } %}\n\t\t\t{% endif %}\n\t\t</p>\n\t\t{% endif %}\n\t\t<p>\n\t\t{% if (contact_list[i].address) { %}\n\t\t\t{%= __(\"Address\") %}: {%= contact_list[i].address %}<br>\n\t\t{% endif %}\n\t\t</p>\n\t</div>\n{% } %}\n{% if(!contact_list.length) { %}\n<p class=\"text-muted small\">{%= __(\"No contacts added yet.\") %}</p>\n{% } %}\n<p><button class=\"btn btn-xs btn-default btn-contact\">\n\t{{ __(\"New Contact\") }}</button>\n</p>`;\n", "\n\tfrappe.templates['form_dashboard'] = `<div class=\"form-dashboard-wrapper\">\n\t<div class=\"progress-area hidden form-dashboard-section\">\n\t</div>\n\t<div class=\"form-heatmap hidden form-dashboard-section\">\n\t\t<div class=\"section-head\">{{ __(\"Overview\") }}</div>\n\t\t<div id=\"heatmap-{{ frappe.model.scrub(frm.doctype) }}\" class=\"heatmap\"></div>\n\t\t<div class=\"text-muted small heatmap-message hidden\"></div>\n\t</div>\n\t<div class=\"form-graph form-dashboard-section hidden\">\n\t\t<div class=\"section-head\">{{ __(\"Graph\") }}</div>\n\t</div>\n\t<div class=\"form-stats form-dashboard-section hidden\">\n\t\t<div class=\"section-head\">{{ __(\"Stats\") }}</div>\n\t\t<div class=\"row\"></div>\n\t</div>\n\t<div class=\"form-links form-dashboard-section hidden\">\n\t\t<div class=\"section-head\">{{ __(\"Documents\") }}</div>\n\t\t<div class=\"transactions\"></div>\n\t</div>\n</div>`;\n", "\n\tfrappe.templates['form_footer'] = `<div class=\"form-footer\">\n\t<div class=\"after-save\">\n\t\t<div class=\"comment-box\"></div>\n\t\t<div class=\"timeline\"></div>\n\t</div>\n\t<button class=\"scroll-to-top btn btn-default icon-btn\" onclick=\"frappe.utils.scroll_to(0)\">\n\t\t<svg class=\"icon icon-xs\"><use href=\"#icon-up-line\"></use></svg>\n\t</button>\n</div>\n`;\n", "\n\tfrappe.templates['form_links'] = `<div class=\"form-documents\">\n\t{% for (let i=0; i < transactions.length; i++) { %}\n\t\t{% if (i % 3 === 0) { %}\n\t\t<div class=\"row\">\n\t\t{% } %}\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<div class=\"form-link-title\">\n\t\t\t\t\t<span>{{ __(transactions[i].label) }}<span>\n\t\t\t\t</div>\n\t\t\t\t{% for (let j=0; j < transactions[i].items.length; j++) { %}\n\t\t\t\t\t{% let doctype = transactions[i].items[j]; %}\n\t\t\t\t\t<div class=\"document-link\" data-doctype=\"{{ doctype }}\">\n\t\t\t\t\t\t<div class=\"document-link-badge\" data-doctype=\"{{ doctype }}\">\n\t\t\t\t\t\t\t<span class=\"count hidden\"></span>\n\t\t\t\t\t\t\t<a class=\"badge-link\">{{ __(doctype) }}</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"open-notification hidden\"\n\t\t\t\t\t\t\ttitle=\"{{ __(\"Open {0}\", [__(doctype)])}}\">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t{% if !internal_links[doctype] %}\n\t\t\t\t\t\t\t<button class=\"btn btn-new btn-secondary btn-xs icon-btn hidden\"\n\t\t\t\t\t\t\t\tdata-doctype=\"{{ doctype }}\">\n\t\t\t\t\t\t\t\t<svg class=\"icon icon-sm\"><use href=\"#icon-add\"></use></svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{% endif %}\n\t\t\t\t\t</div>\n\t\t\t\t{% } %}\n\t\t\t</div>\n\t\t{% if (i % 3 === 2 || i === (transactions.length - 1)) { %}\n\t\t</div>\n\t\t{% } %}\n\t{% } %}\n</div>\n`;\n", "\n\tfrappe.templates['form_sidebar'] = `<ul class=\"list-unstyled sidebar-menu user-actions hidden\"></ul>\n<ul class=\"list-unstyled sidebar-menu sidebar-image-section hide\">\n\t<li class=\"sidebar-image-wrapper\">\n\t\t<img class=\"sidebar-image\">\n\t\t<div class=\"sidebar-standard-image\">\n\t\t\t<div class=\"standard-image\"></div>\n\t\t</div>\n\t\t<div class=\"sidebar-image-actions\">\n\t\t\t<div class=\"dropdown\">\n\t\t\t\t<a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">{{ __(\"Change\") }}</a>\n\t\t\t\t<div class=\"dropdown-menu\" role=\"menu\">\n\t\t\t\t\t<a class=\"dropdown-item sidebar-image-change\">{{ __(\"Upload\") }}</a>\n\t\t\t\t\t<a class=\"dropdown-item sidebar-image-remove\">{{ __(\"Remove\") }}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</li>\n</ul>\n{% if frm.meta.beta %}\n<div class=\"sidebar-menu\">\n\t<p><label class=\"indicator-pill yellow\" title=\"{{ __(\"This feature is brand new and still experimental\") }}\">{{ __(\"Experimental\") }}</label></p>\n\t<p><a class=\"small text-muted\" href=\"https://github.com/frappe/{{ frappe.boot.module_app[frappe.scrub(frm.meta.module)] }}/issues/new\"\n\t\t\ttarget=\"_blank\">\n\t\t{{ __(\"Click here to post bugs and suggestions\") }}</a></p>\n\n</div>\n{% endif %}\n<ul class=\"list-unstyled sidebar-menu sidebar-rating hide\">\n\t<li style=\"position: relative;\">\n\t\t<a class=\"strong badge-hover\">\n\t\t\t<span>{%= __(\"Feedback\") %}</span>\n\t\t</a>\n\t</li>\n\t<li class=\"rating-icons\"></li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu hidden\">\n\t{% if (frappe.help.has_help(doctype)) { %}\n\t<li><a class=\"help-link list-link\" data-doctype=\"{{ doctype }}\">{{ __(\"Help\") }}</a></li>\n\t{% } %}\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-assignments\">\n\t<li class=\"sidebar-label\">\n\t\t<svg class=\"icon icon-sm\"><use href=\"#icon-assign\"></use></svg>\n\t\t{%= __(\"Assigned To\") %}\n\t</li>\n\t<li class=\"flex flex-wrap\">\n\t\t<span class=\"assignments\"></span>\n\t\t<button class=\"text-muted btn btn-default icon-btn add-assignment-btn\">\n\t\t\t<svg class=\"icon icon-sm\"><use href=\"#icon-add\"></use></svg>\n\t\t</button>\n\t</li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-attachments\">\n\t<li class=\"sidebar-label attachments-label\">\n\t\t<svg class=\"icon icon-sm\"><use href=\"#icon-attachment\"></use></svg>\n\t\t{%= __(\"Attachments\") %}\n\t</li>\n\t<li class=\"add-attachment-btn\">\n\t\t<button class=\"data-pill btn\">\n\t\t\t<span class=\"pill-label ellipsis\">\n\t\t\t\t{%= __(\"Attach File\") %}\n\t\t\t</span>\n\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t<use href=\"#icon-add\"></use>\n\t\t\t</svg>\n\t\t</button>\n\t</li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-reviews\">\n\t<li class=\"sidebar-label reviews-label\">\n\t\t<svg class=\"icon icon-sm\"><use href=\"#icon-review\"></use></svg>\n\t\t{%= __(\"Reviews\") %}\n\t</li>\n\t<li class=\"reviews\">\n\t\t<button class=\"add-review-btn text-muted btn btn-default icon-btn\">\n\t\t\t<svg class=\"icon icon-sm\"><use href=\"#icon-add\"></use></svg>\n\t\t</button>\n\t</li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-shared\">\n\t<li class=\"sidebar-label\">\n\t\t<svg class=\"icon icon-sm\"><use href=\"#icon-share\"></use></svg>\n\t\t{%= __(\"Shared With\") %}\n\t</li>\n\t<li class=\"flex flex-wrap\">\n\t\t<span class=\"shares\"></span>\n\t\t<button class=\"share-doc-btn text-muted btn btn-default icon-btn\">\n\t\t\t<svg class=\"icon icon-sm\"><use href=\"#icon-add\"></use></svg>\n\t\t</button>\n\t</li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu followed-by-section\">\n\t<li class=\"sidebar-label followed-by-label hidden\">\n\t\t<svg class=\"icon icon-sm\">\n\t\t\t<use href=\"#icon-link-url\" class=\"like-icon\"></use>\n\t\t</svg>\n\t\t{%= __(\"Followed by\") %}\n\t</li>\n\t<li class=\"followed-by\"></li>\n\t<li class=\"document-follow\">\n\t\t<a class=\"badge-hover follow-document-link hidden\">\n\t\t\t{%= __(\"Follow\") %}\n\t\t</a>\n\t\t<a class=\"badge-hover unfollow-document-link hidden\">\n\t\t\t{%= __(\"Unfollow\") %}\n\t\t</a>\n\t</li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-tags\">\n\t<li class=\"sidebar-label tags-label\">\n\t\t<svg class=\"icon icon-sm\"><use href=\"#icon-tag\"></use></svg>\n\t\t{%= __(\"Tags\") %}\n\t</li>\n</ul>\n<ul class=\"list-unstyled sidebar-menu\">\n\t<a><li class=\"auto-repeat-status\"><li></a>\n</ul>\n<ul class=\"list-unstyled sidebar-menu form-sidebar-stats\">\n\t<li class=\"flex\">\n\t\t<div class=\"form-stats\">\n\t\t\t<span class=\"form-stats-likes\">\n\t\t\t\t<span class=\"liked-by like-action\">\n\t\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t\t<use href=\"#icon-heart\" class=\"like-icon\"></use>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class=\"like-count\"></span>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span class=\"mx-1\">\u00B7</span>\n\t\t\t<a class=\"comments\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-comment\" class=\"comment-icon\"></use>\n\t\t\t\t</svg>\n\t\t\t\t<span class=\"comments-count\"></span>\n\t\t\t</a>\n\t\t</div>\n\t\t<a class=\"form-follow text-sm\">\n\t\t\tFollow\n\t\t</a>\n\t</li>\n</ul>\n<hr>\n<!-- <ul class=\"list-unstyled sidebar-menu\">\n\t<li class=\"liked-by-parent\">\n\t\t<span class=\"liked-by like-action\">\n\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t<use href=\"#icon-heart\" class=\"like-icon\"></use>\n\t\t\t</svg>\n\t\t\t<span class=\"likes-count\"></span>\n\t\t</span>\n\t</li>\n</ul> -->\n<ul class=\"list-unstyled sidebar-menu text-muted\">\n\t<li class=\"pageview-count\"></li>\n\t<li class=\"modified-by\"></li>\n\t<li class=\"created-by\"></li>\n</ul>\n{% if(frappe.get_form_sidebar_extension) { %}\n\t{{ frappe.get_form_sidebar_extension() }}\n{% } %}\n`;\n", "\n\tfrappe.templates['print_layout'] = `<!-- <div class=\"form-print-wrapper frappe-card\">\n\t<div class=\"print-toolbar row\">\n\t\t<div class=\"col-xs-3\">\n\t\t\t<div class=\"flex\">\n\t\t\t\t<select class=\"print-preview-select input-sm form-control\"></select>\n\t\t\t\t<button class=\"btn btn-default btn-sm border print-preview-refresh\" type=\"button\">{%= __(\"Refresh\") %}</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"col-xs-2\">\n\t\t\t<select class=\"languages input-sm form-control\"\n\t\t\t\tplaceholder=\"{{ __(\"Language\") }}\"></select></div>\n\t\t<div class=\"col-xs-2\">\n\t\t\t<div class=\"checkbox small\" style=\"margin-top: 7px; margin-bottom: 0px;\">\n\t\t\t\t<label>\n\t\t\t\t\t<input type=\"checkbox\" class=\"print-letterhead text-muted\"/>\n\t\t\t\t\t{%= __(\"Letter Head\") %}</label>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"col-xs-5 text-right\">\n\t\t\t<a class=\"close btn-print-close\" style=\"margin-top: 2px; margin-left: 10px;\">&times;</a>\n\t\t\t<div class=\"btn-group\">\n\t\t\t\t<a class=\"btn btn-default btn-sm\"\n\t\t\t\t\tstyle=\"border-top-right-radius:0px; border-bottom-right-radius: 0px;\"\n\t\t\t\t\tdata-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n\t\t\t\t\t<span>{%= __(\"Settings\") %}</span>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t<svg class=\"icon icon-xs\">\n\t\t\t\t\t\t\t<use href=\"#icon-select\"></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</span>\n\t\t\t\t</a>\n\t\t\t\t<ul class=\"dropdown-menu print-format-dropdown\" style=\"max-height: 300px;\n\t\t\t\t\toverflow-y: auto; left: auto;\">\n\t\t\t\t\t<li><a class=\"dropdown-item\" href=\"/app/Form/Print Settings\">\n\t\t\t\t\t\t{%= __(\"Print Settings\") %}</a></li>\n\t\t\t\t\t<li><a class=\"btn-printer-setting dropdown-item\" style=\"display: none;\">\n\t\t\t\t\t\t{%= __(\"Raw Printing Settings\") %}</a></li>\n\t\t\t\t\t<li><a class=\"btn-print-edit dropdown-item\">\n\t\t\t\t\t\t{%= __(\"Customize\") %}</a></li>\n\t\t\t\t</ul>\n\t\t\t\t<a class=\"btn-print-preview btn-sm btn btn-default\">\n\t\t\t\t\t{%= __(\"Full Page\") %}</a>\n\t\t\t\t<a class=\"btn-download-pdf btn-sm btn btn-default\">\n\t\t\t\t\t{%= __(\"PDF\") %}</a>\n\t\t\t\t<a class=\"btn-print-print btn-sm btn btn-default\">\n\t\t\t\t\t<strong>{%= __(\"Print\") %}</strong></a>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class=\"print-preview-wrapper\">\n\t\t<div class=\"print-preview\">\n\t\t\t<div class=\"print-format\"></div>\n\t\t</div>\n\t\t<div class=\"page-break-message text-muted text-center text-medium margin-top\"></div>\n\t</div>\n</div> -->\n`;\n", "\n\tfrappe.templates['report_links'] = `<div class=\"form-documents\">\n\t{% for (var i=0; i < reports.length; i++) { %}\n\t\t{% if (i % 3 === 0) { %}\n\t\t<div class=\"row\">\n\t\t{% } %}\n\t\t\t<div class=\"col-md-4\">\n\t\t\t\t<div class=\"form-link-title\">\n\t\t\t\t\t<span>{{ __(reports[i].label) }}</span>\n\t\t\t\t</div>\n\t\t\t\t{% for (let j=0; j < reports[i].items.length; j++) { %}\n\t\t\t\t\t{% let report = reports[i].items[j]; %}\n\t\t\t\t\t<div class=\"document-link\" data-report=\"{{ report }}\">\n\t\t\t\t\t\t<div class=\"report-link-badge\" data-report=\"{{ report }}\">\n\t\t\t\t\t\t\t<a class=\"report-link\">{{ __(report) }}</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{% } %}\n\t\t\t</div>\n\t\t{% if (i % 3 === 2 || i === (reports.length - 1)) { %}\n\t\t</div>\n\t\t{% } %}\n\t{% } %}\n</div>\n`;\n", "\n\tfrappe.templates['set_sharing'] = `<div>\n\t<div class=\"row\">\n\t\t<div class=\"col-xs-4\"><h6>{%= __(\"User\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Read\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Write\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Submit\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Share\") %}</h6></div>\n\t</div>\n\n\t<div class=\"row shared-user\" data-everyone=1>\n\t\t<div class=\"col-xs-4 share-all\"><b>{{ __(\"Everyone\") }}</b></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"read\"\n\t\t\t{% if(cint(everyone.read)) { %}checked{% } %} class=\"edit-share\"></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"write\"\n\t\t\tclass=\"edit-share\"\n\t\t\t{% if(cint(everyone.write)) { %}checked{% } %}\n\t\t\t{% if (!frm.perm[0].write){ %} disabled=\"disabled\"{% } %}>\n\t\t</div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"submit\"\n\t\t\tclass=\"edit-share\"\n\t\t\t{% if(cint(everyone.submit)) { %}checked{% } %}\n\t\t\t{% if (!frm.perm[0].submit){ %} disabled=\"disabled\"{% } %}>\n\t\t</div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"share\"\n\t\t\t{% if(cint(everyone.share)) { %}checked{% } %} class=\"edit-share\"></div>\n\t</div>\n\n\t{% for (var i=0, l=shared.length; i < l; i++) {\n\t\tvar s = shared[i]; %}\n\t\t{% if(s && !s.everyone) { %}\n\t\t<div class=\"row shared-user\" data-user=\"{%= s.user %}\" data-name=\"{%= s.name %}\">\n\t\t\t<div class=\"col-xs-4\">{%= s.user %}</div>\n\t\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"read\"\n\t\t\t\t{% if(cint(s.read)) { %}checked{% } %} class=\"edit-share\"></div>\n\t\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"write\"\n\t\t\t\t{% if(cint(s.write)) { %}checked{% } %} class=\"edit-share\"{% if (!frm.perm[0].write){ %} disabled=\"disabled\"{% } %}></div>\n\t\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"submit\"\n\t\t\t\t{% if(cint(s.submit)) { %}checked{% } %} class=\"edit-share\"{% if (!frm.perm[0].submit){ %} disabled=\"disabled\"{% } %}></div>\n\t\t\t<div class=\"col-xs-2 flex justify-center align-center\"><input type=\"checkbox\" name=\"share\"\n\t\t\t\t{% if(cint(s.share)) { %}checked{% } %} class=\"edit-share\"></div>\n\t\t</div>\n\t\t{% } %}\n\t{% } %}\n\n\t{% if(frappe.model.can_share(null, frm)) { %}\n\t<hr>\n\n\t<div class=\"row\">\n\t\t<div class=\"col-xs-4\"><h6>{%= __(\"Share this document with\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Read\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Write\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Submit\") %}</h6></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-center\"><h6>{%= __(\"Can Share\") %}</h6></div>\n\t</div>\n\n\t<div class=\"row\">\n\t\t<div class=\"col-xs-4 input-wrapper-add-share\"></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-flex-start mt-2\"><input type=\"checkbox\" class=\"add-share-read\" name=\"read\"></div>\n\t\t<div class=\"col-xs-2 flex justify-center align-flex-start mt-2\"><input type=\"checkbox\" class=\"add-share-write\" name=\"write\"\n\t\t\t{% if (!frm.perm[0].write){ %} disabled=\"disabled\"{% } %}>\n\t\t</div>\n\t\t<div class=\"col-xs-2 flex justify-center align-flex-start mt-2\"><input type=\"checkbox\" class=\"add-share-submit\" name=\"submit\"\n\t\t\t{% if (!frm.perm[0].submit){ %} disabled=\"disabled\"{% } %}>\n\t\t</div>\n\t\t<div class=\"col-xs-2 flex justify-center align-flex-start mt-2\"><input type=\"checkbox\" class=\"add-share-share\" name=\"share\"></div>\n\t</div>\n\t<div>\n\t\t<button class=\"btn btn-primary btn-sm btn-add-share mt-3\">{{ __(\"Add\") }}</button>\n\t</div>\n\t{% endif %}\n</div>`;\n", "\n\tfrappe.templates['timeline_message_box'] = `<div class=\"timeline-message-box\" data-communication-type=\"{{ doc.communication_type }}\">\n\t<span class=\"flex justify-between\">\n\t\t<span class=\"text-color flex\">\n\t\t\t{% if (doc.communication_type && doc.communication_type == \"Automated Message\") { %}\n\t\t\t\t<span>\n\t\t\t\t\t<!-- Display maximum of 3 users-->\n\t\t\t\t\t{{ __(\"Notification sent to\") }}\n\t\t\t\t\t{% var recipients = (doc.recipients && doc.recipients.split(\",\")) || [] %}\n\t\t\t\t\t{% var cc = (doc.cc && doc.cc.split(\",\")) || [] %}\n\t\t\t\t\t{% var bcc = (doc.bcc && doc.bcc.split(\",\")) || [] %}\n\t\t\t\t\t{% var emails = recipients.concat(cc, bcc) %}\n\t\t\t\t\t{% var display_emails_len = Math.min(emails.length, 3) %}\n\n\t\t\t\t\t{% for (var i=0, len=display_emails_len; i<len; i++) { var email = emails[i]; %}\n\t\t\t\t\t\t{{ frappe.user_info(email).fullname || email }}\n\t\t\t\t\t\t{% if (len > i+1) { %}\n\t\t\t\t\t\t\t{{ \",\" }}\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t{% } %}\n\n\t\t\t\t\t{% if (emails.length > display_emails_len) { %}\n\t\t\t\t\t\t{{ \"...\" }}\n\t\t\t\t\t{% } %}\n\n\t\t\t\t\t<div class=\"text-muted\">\n\t\t\t\t\t\t{{ comment_when(doc.creation) }}\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t{% } else if (doc.comment_type && doc.comment_type == \"Comment\") { %}\n\t\t\t\t<span>\n\t\t\t\t\t{{ doc.user_full_name || frappe.user.full_name(doc.owner) }} {{ __(\"commented\") }}\n\t\t\t\t\t<span class=\"text-muted margin-left\">\n\t\t\t\t\t\t{{ comment_when(doc.creation) }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t{% } else { %}\n\t\t\t\t<span class=\"margin-right\">\n\t\t\t\t\t{{ frappe.avatar(doc.owner, \"avatar-medium\") }}\n\t\t\t\t</span>\n\t\t\t\t<span>\n\t\t\t\t\t{{ doc.user_full_name || frappe.user.full_name(doc.owner) }}\n\t\t\t\t\t<div class=\"text-muted\">\n\t\t\t\t\t\t{{ comment_when(doc.creation) }}\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t{% } %}\n\t\t</span>\n\t\t<span class=\"actions\">\n\t\t\t{% if (doc._doc_status && doc._doc_status_indicator) { %}\n\t\t\t<span class=\"indicator-pill {%= doc._doc_status_indicator %}\"\n\t\t\t\ttitle=\"{%= __(doc._doc_status) %}\"\n\t\t\t\tstyle=\"order: -1\">\n\t\t\t\t<span class=\"hidden-xs small\">\n\t\t\t\t\t{%= __(doc._doc_status) %}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t{% } %}\n\n\t\t\t{% if (doc._url) { %}\n\t\t\t<a class=\"action-btn\" href=\"{{ doc._url }}\" title=\"{{ __(\"Open Communication\") }}\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-link-url\" class=\"like-icon\"></use>\n\t\t\t\t</svg>\n\t\t\t</a>\n\t\t\t{% } %}\n\t\t\t<div class=\"custom-actions\"></div>\n\t\t\t<div class=\"more-actions\">\n\t\t\t\t<a type=\"button\" class=\"action-btn\"\n\t\t\t\t\tdata-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n\t\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t\t<use href=\"#icon-dot-horizontal\"></use>\n\t\t\t\t\t</svg>\n\t\t\t\t</a>\n\t\t\t\t<ul class=\"dropdown-menu small\">\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a class=\"dropdown-item\" data-action=\"copy_link\">{{ __('Copy Link') }}</a>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</span>\n\t</span>\n\t<div class=\"content\">\n\t\t{{ doc.content }}\n\t</div>\n\t{% if (doc.attachments && doc.attachments.length) { %}\n\t<div style=\"margin-top: 10px\">\n\t{% $.each(doc.attachments, function(i, a) { %}\n\t<div class=\"ellipsis flex\">\n\t\t<a href=\"{%= encodeURI(a.file_url).replace(/#/g, \\'%23\\') %}\"\n\t\t\tclass=\"text-muted small\" target=\"_blank\" rel=\"noopener noreferrer\">\n\t\t\t<svg viewBox=\"0 0 16 16\" class=\"icon icon-xs\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<path d=\"M14 7.66625L8.68679 12.8875C7.17736 14.3708 4.64151 14.3708 3.13208 12.8875C1.62264 11.4042 1.62264 8.91224 3.13208 7.42892L7.84151 2.80099C8.9283 1.733 10.6189 1.733 11.7057 2.80099C12.7925 3.86897 12.7925 5.53028 11.7057 6.59827L7.35849 10.8109C6.75472 11.4042 5.78868 11.4042 5.24528 10.8109C4.64151 10.2176 4.64151 9.26823 5.24528 8.73424L8.86792 5.17429\" stroke=\"currentColor\" stroke-miterlimit=\"10\" stroke-linecap=\"round\"/>\n\t\t\t</svg>\n\t\t\t{%= a.file_url.split(\"/\").slice(-1)[0] %}\n\t\t\t{% if (a.is_private) { %}\n\t\t\t\t<svg class=\"icon icon-xs\" style=\"color: var(--yellow-300)\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\">\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.077 1.45h-.055a3.356 3.356 0 00-3.387 3.322v.35H3.75a2 2 0 00-2 2v5.391a2 2 0 002 2h8.539a2 2 0 002-2V7.122a2 2 0 00-2-2h-.885v-.285A3.356 3.356 0 008.082 1.45h-.005zm2.327 3.672V4.83a2.356 2.356 0 00-2.33-2.38h-.06a2.356 2.356 0 00-2.38 2.33v.342h4.77zm-6.654 1a1 1 0 00-1 1v5.391a1 1 0 001 1h8.539a1 1 0 001-1V7.122a1 1 0 00-1-1H3.75zm4.27 4.269a.573.573 0 100-1.147.573.573 0 000 1.147zm1.573-.574a1.573 1.573 0 11-3.147 0 1.573 1.573 0 013.147 0z\" fill=\"currentColor\" stroke=\"currentColor\"></path>\n\t\t\t\t</svg>\n\t\t\t{% } %}\n\t\t</a>\n\t</div>\n\t{% }); %}\n\t</div>\n\t{% } %}\n</div>\n`;\n", "\n\tfrappe.templates['users_in_sidebar'] = `{% for (var i=0, l=users.length; i < l; i++) {\n\tvar u = users[i];\n%}\n\t<span class=\"avatar avatar-small {{ u.avatar_class || \"\" }}\" title=\"{{ u.title }}\">\n\t{% if (u.icon) { %}\n\t\t<i class=\"{{ u.icon }}\"></i>\n\t{% } else if(u.image) { %}\n\t\t<img class=\"media-object\" src=\"{{ u.image }}\" alt=\"{{ u.fullname }}\">\n\t{% } else { %}\n\t\t<div class=\"standard-image\" style=\"background-color: {{ u.color }};\">{{ u.abbr.substr(0,1) }}</div>\n\t{% } %}\n\t</span>\n{% } %}\n`;\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.views.formview');\n\nfrappe.views.FormFactory = class FormFactory extends frappe.views.Factory {\n\tmake(route) {\n\t\tvar doctype = route[1],\n\t\t\tdoctype_layout = frappe.router.doctype_layout || doctype;\n\n\t\tif (!frappe.views.formview[doctype_layout]) {\n\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\tthis.page = frappe.container.add_page(doctype_layout);\n\t\t\t\tfrappe.views.formview[doctype_layout] = this.page;\n\t\t\t\tthis.make_and_show(doctype, route);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.show_doc(route);\n\t\t}\n\n\t\tthis.setup_events();\n\t}\n\n\tmake_and_show(doctype, route) {\n\t\tif (frappe.router.doctype_layout) {\n\t\t\tfrappe.model.with_doc('DocType Layout', frappe.router.doctype_layout, () => {\n\t\t\t\tthis.make_form(doctype);\n\t\t\t\tthis.show_doc(route);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.make_form(doctype);\n\t\t\tthis.show_doc(route);\n\t\t}\n\t}\n\n\tmake_form(doctype) {\n\t\tthis.page.frm = new frappe.ui.form.Form(doctype, this.page, true, frappe.router.doctype_layout);\n\t}\n\n\tsetup_events() {\n\t\tif (!this.initialized) {\n\t\t\t$(document).on(\"page-change\", function() {\n\t\t\t\tfrappe.ui.form.close_grid_form();\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"doc_viewers\", function(data) {\n\t\t\t\t// set users that currently viewing the form\n\t\t\t\tfrappe.ui.form.FormViewers.set_users(data, 'viewers');\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"doc_typers\", function(data) {\n\t\t\t\t// set users that currently typing on the form\n\t\t\t\tfrappe.ui.form.FormViewers.set_users(data, 'typers');\n\t\t\t});\n\t\t}\n\t\tthis.initialized = true;\n\t}\n\n\tshow_doc(route) {\n\t\tvar doctype = route[1],\n\t\t\tdoctype_layout = frappe.router.doctype_layout || doctype,\n\t\t\tname = route.slice(2).join(\"/\");\n\n\t\tif (frappe.model.new_names[name]) {\n\t\t\t// document has been renamed, reroute\n\t\t\tname = frappe.model.new_names[name];\n\t\t\tfrappe.set_route(\"Form\", doctype_layout, name);\n\t\t\treturn;\n\t\t}\n\n\t\tconst doc = frappe.get_doc(doctype, name);\n\t\tif (doc && frappe.model.get_docinfo(doctype, name) && (doc.__islocal || frappe.model.is_fresh(doc))) {\n\t\t\t// is document available and recent?\n\t\t\tthis.render(doctype_layout, name);\n\t\t} else {\n\t\t\tthis.fetch_and_render(doctype, name, doctype_layout);\n\t\t}\n\t}\n\n\tfetch_and_render(doctype, name, doctype_layout) {\n\t\tfrappe.model.with_doc(doctype, name, (name, r) => {\n\t\t\tif (r && r['403']) return; // not permitted\n\n\t\t\tif (!(locals[doctype] && locals[doctype][name])) {\n\t\t\t\tif (name && name.substr(0, 3) === 'new') {\n\t\t\t\t\tthis.render_new_doc(doctype, name, doctype_layout);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_not_found();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render(doctype_layout, name);\n\t\t});\n\t}\n\n\trender_new_doc(doctype, name, doctype_layout) {\n\t\tconst new_name = frappe.model.make_new_doc_and_get_name(doctype, true);\n\t\tif (new_name===name) {\n\t\t\tthis.render(doctype_layout, name);\n\t\t} else {\n\t\t\tfrappe.route_flags.replace_route = true;\n\t\t\tfrappe.set_route(\"Form\", doctype_layout, new_name);\n\t\t}\n\t}\n\n\trender(doctype_layout, name) {\n\t\tfrappe.container.change_to(doctype_layout);\n\t\tfrappe.views.formview[doctype_layout].frm.refresh(name);\n\t}\n}\n", "frappe.provide('frappe.ui.form');\n\nfrappe.quick_edit = function(doctype, name) {\n\tfrappe.db.get_doc(doctype, name).then(doc => {\n\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, doc);\n\t});\n};\n\nfrappe.ui.form.make_quick_entry = (doctype, after_insert, init_callback, doc, force) => {\n\tvar trimmed_doctype = doctype.replace(/ /g, '');\n\tvar controller_name = \"QuickEntryForm\";\n\n\tif(frappe.ui.form[trimmed_doctype + \"QuickEntryForm\"]){\n\t\tcontroller_name = trimmed_doctype + \"QuickEntryForm\";\n\t}\n\n\tfrappe.quick_entry = new frappe.ui.form[controller_name](doctype, after_insert, init_callback, doc, force);\n\treturn frappe.quick_entry.setup();\n};\n\nfrappe.ui.form.QuickEntryForm = class QuickEntryForm {\n\tconstructor(doctype, after_insert, init_callback, doc, force) {\n\t\tthis.doctype = doctype;\n\t\tthis.after_insert = after_insert;\n\t\tthis.init_callback = init_callback;\n\t\tthis.doc = doc;\n\t\tthis.force = force ? force : false;\n\t}\n\n\tsetup() {\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.model.with_doctype(this.doctype, () => {\n\t\t\t\tthis.check_quick_entry_doc();\n\t\t\t\tthis.set_meta_and_mandatory_fields();\n\t\t\t\tif (this.is_quick_entry() || this.force) {\n\t\t\t\t\tthis.render_dialog();\n\t\t\t\t\tresolve(this);\n\t\t\t\t} else {\n\t\t\t\t\t// no quick entry, open full form\n\t\t\t\t\tfrappe.quick_entry = null;\n\t\t\t\t\tfrappe.set_route('Form', this.doctype, this.doc.name)\n\t\t\t\t\t\t.then(() => resolve(this));\n\t\t\t\t\t// call init_callback for consistency\n\t\t\t\t\tif (this.init_callback) {\n\t\t\t\t\t\tthis.init_callback(this.doc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tset_meta_and_mandatory_fields() {\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tlet fields = this.meta.fields;\n\n\t\t// prepare a list of mandatory, bold and allow in quick entry fields\n\t\tthis.mandatory = fields.filter(df => {\n\t\t\treturn ((df.reqd || df.bold || df.allow_in_quick_entry) && !df.read_only && !df.is_virtual);\n\t\t});\n\t}\n\n\tcheck_quick_entry_doc() {\n\t\tif (!this.doc) {\n\t\t\tthis.doc = frappe.model.get_new_doc(this.doctype, null, null, true);\n\t\t}\n\t}\n\n\tis_quick_entry() {\n\t\tif(this.meta.quick_entry != 1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.validate_for_prompt_autoname();\n\n\t\tif (this.has_child_table() || !this.mandatory.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\ttoo_many_mandatory_fields() {\n\t\tif(this.mandatory.length > 7) {\n\t\t\t// too many fields, show form\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\thas_child_table(){\n\t\tif($.map(this.mandatory, function(d) {\n\t\t\treturn d.fieldtype==='Table' ? d : null; }).length) {\n\t\t\t// has mandatory table, quit!\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tvalidate_for_prompt_autoname() {\n\t\tif(this.meta.autoname && this.meta.autoname.toLowerCase()==='prompt') {\n\t\t\tthis.mandatory = [{fieldname:'__newname', label:__('{0} Name', [this.meta.name]),\n\t\t\t\treqd: 1, fieldtype:'Data'}].concat(this.mandatory);\n\t\t}\n\t}\n\n\trender_dialog() {\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"New {0}\", [__(this.doctype)]),\n\t\t\tfields: this.mandatory,\n\t\t\tdoc: this.doc\n\t\t});\n\n\t\tthis.register_primary_action();\n\t\t!this.force && this.render_edit_in_full_page_link();\n\t\t// ctrl+enter to save\n\t\tthis.dialog.wrapper.keydown(function(e) {\n\t\t\tif((e.ctrlKey || e.metaKey) && e.which==13) {\n\t\t\t\tif(!frappe.request.ajax_count) {\n\t\t\t\t\t// not already working -- double entry\n\t\t\t\t\tme.dialog.get_primary_btn().trigger(\"click\");\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.dialog.onhide = () => frappe.quick_entry = null;\n\t\tthis.dialog.show();\n\n\t\tthis.dialog.refresh_dependency();\n\t\tthis.set_defaults();\n\n\t\tif (this.init_callback) {\n\t\t\tthis.init_callback(this.dialog);\n\t\t}\n\t}\n\n\tregister_primary_action() {\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif(me.dialog.working) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar data = me.dialog.get_values();\n\n\t\t\tif(data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tme.dialog.set_message(__('Saving...'));\n\t\t\t\tme.insert().then(() => {\n\t\t\t\t\tme.dialog.clear_message();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tinsert() {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tme.update_doc();\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.save\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: me.dialog.doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\n\t\t\t\t\tif (frappe.model.is_submittable(me.doctype)) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => me.dialog.working = true,\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tme.dialog.set_primary_action(__('Submit'), function() {\n\t\t\t\t\t\t\t\t\tme.submit(r.message);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t// delete the old doc\n\t\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\t\tif(frappe._from_link) {\n\t\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(me.after_insert) {\n\t\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tif (!me.skip_redirect_on_error) {\n\t\t\t\t\t\tme.open_doc(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t}\n\n\tsubmit(doc) {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.client.submit\",\n\t\t\targs : {\n\t\t\t\tdoc: doc\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.dialog.hide();\n\t\t\t\t// delete the old doc\n\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t} else {\n\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcur_frm && cur_frm.reload_doc();\n\t\t\t}\n\t\t});\n\t}\n\n\topen_form_if_not_list() {\n\t\tlet route = frappe.get_route();\n\t\tlet doc = this.dialog.doc;\n\t\tif (route && !(route[0]==='List' && route[1]===doc.doctype)) {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => frappe.set_route('Form', doc.doctype, doc.name)\n\t\t\t]);\n\t\t}\n\t}\n\n\tupdate_doc(){\n\t\tvar me = this;\n\t\tvar data = this.dialog.get_values(true);\n\t\t$.each(data, function(key, value) {\n\t\t\tif (!is_null(value)) {\n\t\t\t\tme.dialog.doc[key] = value;\n\t\t\t}\n\t\t});\n\t\treturn this.dialog.doc;\n\t}\n\n\topen_doc(set_hooks) {\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tif (set_hooks && this.after_insert) {\n\t\t\tfrappe.route_options = frappe.route_options || {};\n\t\t\tfrappe.route_options.after_save = (frm) => {\n\t\t\t\tthis.after_insert(frm);\n\t\t\t};\n\t\t}\n\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t}\n\n\trender_edit_in_full_page_link() {\n\t\tvar me = this;\n\t\tthis.dialog.add_custom_action(\n\t\t\t`${__(\"Edit Full Form\")}`,\n\t\t\t() => me.open_doc(true)\n\t\t);\n\t}\n\n\tset_defaults() {\n\t\tvar me = this;\n\t\t// set defaults\n\t\t$.each(this.dialog.fields_dict, function(fieldname, field) {\n\t\t\tfield.doctype = me.doc.doctype;\n\t\t\tfield.docname = me.doc.name;\n\n\t\t\tif (!is_null(me.doc[fieldname])) {\n\t\t\t\tfield.set_input(me.doc[fieldname]);\n\t\t\t}\n\t\t});\n\t}\n};\n", "// Copyright (c) 2022, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See LICENSE\n\n\nfrappe.ui.form.LinkedWith = class LinkedWith {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tshow() {\n\t\tif(!this.dialog)\n\t\t\tthis.make_dialog();\n\n\t\t$(this.dialog.body).html(\n\t\t\t`<div class=\"text-muted text-center\" style=\"padding: 30px 0px\">\n\t\t\t\t${__(\"Loading\")}...\n\t\t\t</div>`);\n\n\t\tthis.dialog.show();\n\t}\n\n\tmake_dialog() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Linked With\")\n\t\t});\n\n\t\tthis.dialog.on_page_show = () => {\n\t\t\tfrappe.xcall(\n\t\t\t\t\"frappe.desk.form.linked_with.get\",\n\t\t\t\t{\"doctype\": cur_frm.doctype, \"docname\": cur_frm.docname},\n\t\t\t).then(r => {\n\t\t\t\tthis.frm.__linked_docs = r;\n\t\t\t}).then(() => this.make_html());\n\t\t};\n\t}\n\n\tmake_html() {\n\t\tlet html = '';\n\t\tconst linked_docs = this.frm.__linked_docs;\n\t\tconst linked_doctypes = Object.keys(linked_docs);\n\n\t\tif (linked_doctypes.length === 0) {\n\t\t\thtml = __(\"Not Linked to any record\");\n\t\t} else {\n\t\t\thtml = linked_doctypes.map(doctype => {\n\t\t\t\tconst docs = linked_docs[doctype];\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"list-item-table margin-bottom\">\n\t\t\t\t\t\t${this.make_doc_head(doctype)}\n\t\t\t\t\t\t${docs.map(doc => this.make_doc_row(doc, doctype)).join('')}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}).join('');\n\t\t}\n\n\t\t$(this.dialog.body).html(html);\n\t}\n\n\tmake_doc_head(heading) {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div>${__(heading)}</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tmake_doc_row(doc, doctype) {\n\t\treturn `<div class=\"list-row-container\">\n\t\t\t<div class=\"level list-row small\">\n\t\t\t\t<div class=\"level-left bold\">\n\t\t\t\t\t<a href=\"/app/${frappe.router.slug(doctype)}/${doc.name}\">${doc.name}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n};\n", "frappe.ui.form.FormViewers = class FormViewers {\n\tconstructor({ frm, parent }) {\n\t\tthis.frm = frm;\n\t\tthis.parent = parent;\n\t\tthis.parent.tooltip({ title: __('Currently Viewing') });\n\t}\n\n\trefresh() {\n\t\tlet users = this.frm.get_docinfo()['viewers'];\n\t\tif (!users || !users.current || !users.current.length) {\n\t\t\tthis.parent.empty();\n\t\t\treturn;\n\t\t}\n\n\t\tlet currently_viewing = users.current.filter(user => user != frappe.session.user);\n\t\tlet avatar_group = frappe.avatar_group(currently_viewing, 5, {'align': 'left', 'overlap': true});\n\t\tthis.parent.empty().append(avatar_group);\n\t}\n};\n\nfrappe.ui.form.FormViewers.set_users = function(data, type) {\n\tconst doctype = data.doctype;\n\tconst docname = data.docname;\n\tconst docinfo = frappe.model.get_docinfo(doctype, docname);\n\n\tconst past_users = ((docinfo && docinfo[type]) || {}).past || [];\n\tconst users = data.users || [];\n\tconst new_users = users.filter(user => !past_users.includes(user));\n\n\tif (new_users.length===0) return;\n\n\tconst set_and_refresh = () => {\n\t\tconst info = {\n\t\t\tpast: past_users.concat(new_users),\n\t\t\tnew: new_users,\n\t\t\tcurrent: users\n\t\t};\n\n\t\tfrappe.model.set_docinfo(doctype, docname, type, info);\n\n\t\tif (\n\t\t\tcur_frm &&\n\t\t\tcur_frm.doc &&\n\t\t\tcur_frm.doc.doctype === doctype &&\n\t\t\tcur_frm.doc.name == docname &&\n\t\t\tcur_frm.viewers\n\t\t) {\n\t\t\tcur_frm.viewers.refresh(true, type);\n\t\t}\n\t};\n\n\tlet unknown_users = [];\n\tfor (let user of users) {\n\t\tif (!frappe.boot.user_info[user]) unknown_users.push(user);\n\t}\n\n\tif (unknown_users.length===0) {\n\t\tset_and_refresh();\n\t} else {\n\t\t// load additional user info\n\t\tfrappe.xcall('frappe.desk.form.load.get_user_info_for_viewers', {users: unknown_users}).then((data) => {\n\t\t\tObject.assign(frappe.boot.user_info, data);\n\t\t\tset_and_refresh();\n\t\t});\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport './linked_with';\nimport './form_viewers';\n\nfrappe.ui.form.Toolbar = class Toolbar {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.refresh();\n\t\tthis.add_update_button_on_dirty();\n\t\tthis.setup_editable_title();\n\t}\n\trefresh() {\n\t\tthis.make_menu();\n\t\tthis.make_viewers();\n\t\tthis.set_title();\n\t\tthis.page.clear_user_actions();\n\t\tthis.show_title_as_dirty();\n\t\tthis.set_primary_action();\n\n\t\tif(this.frm.meta.hide_toolbar) {\n\t\t\tthis.page.hide_menu();\n\t\t} else {\n\t\t\tif(this.frm.doc.__islocal) {\n\t\t\t\tthis.page.hide_menu();\n\t\t\t\tthis.print_icon && this.print_icon.addClass(\"hide\");\n\t\t\t} else {\n\t\t\t\tthis.page.show_menu();\n\t\t\t\tthis.print_icon && this.print_icon.removeClass(\"hide\");\n\t\t\t}\n\t\t}\n\t}\n\tset_title() {\n\t\tif (this.frm.is_new()) {\n\t\t\tvar title = __('New {0}', [__(this.frm.meta.name)]);\n\t\t} else if (this.frm.meta.title_field) {\n\t\t\tlet title_field = (this.frm.doc[this.frm.meta.title_field] || \"\").toString().trim();\n\t\t\tvar title = strip_html(title_field || this.frm.docname);\n\t\t\tif(this.frm.doc.__islocal || title === this.frm.docname || this.frm.meta.autoname===\"hash\") {\n\t\t\t\tthis.page.set_title_sub(\"\");\n\t\t\t} else {\n\t\t\t\tthis.page.set_title_sub(this.frm.docname);\n\t\t\t\tthis.page.$sub_title_area.css(\"cursor\", \"copy\");\n\t\t\t\tthis.page.$sub_title_area.on('click', (event) => {\n\t\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\t\tfrappe.utils.copy_to_clipboard(this.frm.docname);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tvar title = this.frm.docname;\n\t\t}\n\n\t\tvar me = this;\n\t\ttitle = __(title);\n\t\tthis.page.set_title(title);\n\t\tif(this.frm.meta.title_field) {\n\t\t\tfrappe.utils.set_title(title + \" - \" + this.frm.docname);\n\t\t}\n\t\tthis.page.$title_area.toggleClass(\"editable-title\",\n\t\t\t!!(this.is_title_editable() || this.can_rename()));\n\n\t\tthis.set_indicator();\n\t}\n\tis_title_editable() {\n\t\tlet title_field = this.frm.meta.title_field;\n\t\tlet doc_field = this.frm.get_docfield(title_field);\n\n\t\tif (title_field\n\t\t\t&& this.frm.perm[0].write\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& doc_field.fieldtype === \"Data\"\n\t\t\t&& !doc_field.read_only) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tcan_rename() {\n\t\treturn this.frm.perm[0].write && this.frm.meta.allow_rename && !this.frm.doc.__islocal;\n\t}\n\tshow_unchanged_document_alert() {\n\t\tfrappe.show_alert({\n\t\t\tindicator: \"info\",\n\t\t\tmessage: __(\"Unchanged\")\n\t\t});\n\t}\n\trename_document_title(input_name, input_title, merge=false) {\n\t\tlet confirm_message = null;\n\t\tconst docname = this.frm.doc.name;\n\t\tconst title_field = this.frm.meta.title_field || '';\n\t\tconst doctype = this.frm.doctype;\n\n\t\tif (input_name) {\n\t\t\tconst warning = __(\"This cannot be undone\");\n\t\t\tconst message = __(\"Are you sure you want to merge {0} with {1}?\", [docname.bold(), input_name.bold()]);\n\t\t\tconfirm_message = `${message}<br><b>${warning}<b>`;\n\t\t}\n\n\t\tlet rename_document = () => {\n\t\t\treturn frappe.xcall(\"frappe.model.rename_doc.update_document_title\", {\n\t\t\t\tdoctype,\n\t\t\t\tdocname,\n\t\t\t\tname: input_name,\n\t\t\t\ttitle: input_title,\n\t\t\t\tenqueue: true,\n\t\t\t\tmerge,\n\t\t\t\tfreeze: true,\n\t\t\t\tfreeze_message: __(\"Updating related fields...\")\n\t\t\t}).then(new_docname => {\n\t\t\t\tconst reload_form = (input_name) => {\n\t\t\t\t\t$(document).trigger(\"rename\", [doctype, docname, input_name]);\n\t\t\t\t\tif (locals[doctype] && locals[doctype][docname]) delete locals[doctype][docname];\n\t\t\t\t\tthis.frm.reload_doc();\n\t\t\t\t}\n\n\t\t\t\t// handle document renaming queued action\n\t\t\t\tif (input_name && (new_docname == docname)) {\n\t\t\t\t\tfrappe.socketio.doc_subscribe(doctype, input_name);\n\t\t\t\t\tfrappe.realtime.on(\"doc_update\", data => {\n\t\t\t\t\t\tif (data.doctype == doctype && data.name == input_name) {\n\t\t\t\t\t\t\treload_form(input_name);\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __('Document renamed from {0} to {1}', [docname.bold(), input_name.bold()]),\n\t\t\t\t\t\t\t\tindicator: 'success',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t__('Document renaming from {0} to {1} has been queued', [docname.bold(), input_name.bold()])\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// handle document sync rename action\n\t\t\t\tif (input_name && ((new_docname || input_name) != docname)) {\n\t\t\t\t\treload_form(new_docname || input_name);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (input_title === this.frm.doc[title_field] && input_name === docname) {\n\t\t\t\tthis.show_unchanged_document_alert();\n\t\t\t\tresolve();\n\t\t\t} else if (merge) {\n\t\t\t\tfrappe.confirm(confirm_message, () => {\n\t\t\t\t\trename_document().then(resolve).catch(reject);\n\t\t\t\t}, reject);\n\t\t\t} else {\n\t\t\t\trename_document().then(resolve).catch(reject);\n\t\t\t}\n\t\t});\n\t}\n\tsetup_editable_title () {\n\t\tlet me = this;\n\n\t\tthis.page.$title_area.find(\".title-text\").on(\"click\", () => {\n\t\t\tlet fields = [];\n\t\t\tlet docname = me.frm.doc.name;\n\t\t\tlet title_field = me.frm.meta.title_field || '';\n\n\t\t\t// check if title is updatable\n\t\t\tif (me.is_title_editable()) {\n\t\t\t\tlet title_field_label = me.frm.get_docfield(title_field).label;\n\n\t\t\t\tfields.push({\n\t\t\t\t\tlabel: __(\"New {0}\", [__(title_field_label)]),\n\t\t\t\t\tfieldname: \"title\",\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdefault: me.frm.doc[title_field]\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// check if docname is updatable\n\t\t\tif (me.can_rename()) {\n\t\t\t\tfields.push(...[{\n\t\t\t\t\tlabel: __(\"New Name\"),\n\t\t\t\t\tfieldname: \"name\",\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdefault: docname\n\t\t\t\t}, {\n\t\t\t\t\tlabel: __(\"Merge with existing\"),\n\t\t\t\t\tfieldname: \"merge\",\n\t\t\t\t\tfieldtype: \"Check\",\n\t\t\t\t\tdefault: 0\n\t\t\t\t}]);\n\t\t\t}\n\n\t\t\t// create dialog\n\t\t\tif (fields.length > 0) {\n\t\t\t\tlet d = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __(\"Rename\"),\n\t\t\t\t\tfields: fields\n\t\t\t\t});\n\t\t\t\td.show();\n\t\t\t\td.set_primary_action(__(\"Rename\"), (values) => {\n\t\t\t\t\td.disable_primary_action();\n\t\t\t\t\td.hide();\n\t\t\t\t\tthis.rename_document_title(values.name, values.title, values.merge)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\td.enable_primary_action();\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tget_dropdown_menu(label) {\n\t\treturn this.page.add_dropdown(label);\n\t}\n\tset_indicator() {\n\t\tvar indicator = frappe.get_indicator(this.frm.doc);\n\t\tif (this.frm.save_disabled && indicator && [__('Saved'), __('Not Saved')].includes(indicator[0])) {\n\t\t\treturn;\n\t\t}\n\t\tif(indicator) {\n\t\t\tthis.page.set_indicator(indicator[0], indicator[1]);\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t}\n\tmake_menu() {\n\t\tthis.page.clear_icons();\n\t\tthis.page.clear_menu();\n\n\t\tif (frappe.boot.desk_settings.form_sidebar) {\n\t\t\tthis.make_navigation();\n\t\t\tthis.make_menu_items();\n\t\t}\n\t}\n\n\tmake_viewers() {\n\t\tif (this.frm.viewers) {\n\t\t\treturn;\n\t\t}\n\t\tthis.frm.viewers = new frappe.ui.form.FormViewers({\n\t\t\tfrm: this.frm,\n\t\t\tparent: $('<div class=\"form-viewers d-flex\"></div>').prependTo(this.frm.page.page_actions)\n\t\t});\n\t}\n\n\tmake_navigation() {\n\t\t// Navigate\n\t\tif (!this.frm.is_new() && !this.frm.meta.issingle) {\n\t\t\tthis.page.add_action_icon(\"left\", () => {\n\t\t\t\tthis.frm.navigate_records(1);\n\t\t\t}, 'prev-doc', __(\"Previous Document\"));\n\t\t\tthis.page.add_action_icon(\"right\", ()=> {\n\t\t\t\tthis.frm.navigate_records(0);\n\t\t\t}, 'next-doc', __(\"Next Document\"));\n\t\t}\n\t}\n\n\tmake_menu_items() {\n\t\t// Print\n\t\tconst me = this;\n\t\tconst p = this.frm.perm[0];\n\t\tconst docstatus = cint(this.frm.doc.docstatus);\n\t\tconst is_submittable = frappe.model.is_submittable(this.frm.doc.doctype);\n\n\t\tconst print_settings = frappe.model.get_doc(\":Print Settings\", \"Print Settings\");\n\t\tconst allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tconst allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\tif (!is_submittable || docstatus == 1  ||\n\t\t\t(allow_print_for_cancelled && docstatus == 2)||\n\t\t\t(allow_print_for_draft && docstatus == 0)) {\n\t\t\tif (frappe.model.can_print(null, me.frm) && !this.frm.meta.issingle) {\n\t\t\t\tthis.page.add_menu_item(__(\"Print\"), function() {\n\t\t\t\t\tme.frm.print_doc();\n\t\t\t\t}, true);\n\t\t\t\tthis.print_icon = this.page.add_action_icon(\"printer\", function() {\n\t\t\t\t\tme.frm.print_doc();\n\t\t\t\t}, '', __(\"Print\"));\n\t\t\t}\n\t\t}\n\n\t\t// email\n\t\tif(frappe.model.can_email(null, me.frm) && me.frm.doc.docstatus < 2) {\n\t\t\tthis.page.add_menu_item(__(\"Email\"), function() {\n\t\t\t\tme.frm.email_doc();\n\t\t\t}, true, {\n\t\t\t\tshortcut: 'Ctrl+E',\n\t\t\t\tcondition: () => !this.frm.is_new()\n\t\t\t});\n\t\t}\n\n\t\t// go to field modal\n\t\tthis.page.add_menu_item(__(\"Jump to field\"), function() {\n\t\t\tme.show_jump_to_field_dialog();\n\t\t}, true, 'Ctrl+J');\n\n\t\t// Linked With\n\t\tif(!me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__('Links'), function() {\n\t\t\t\tme.show_linked_with();\n\t\t\t}, true)\n\t\t}\n\n\t\t// duplicate\n\t\tif(in_list(frappe.boot.user.can_create, me.frm.doctype) && !me.frm.meta.allow_copy) {\n\t\t\tthis.page.add_menu_item(__(\"Duplicate\"), function() {\n\t\t\t\tme.frm.copy_doc();\n\t\t\t}, true);\n\t\t}\n\n\t\t// copy doc to clipboard\n\t\tthis.page.add_menu_item(__(\"Copy to Clipboard\"), function() {\n\t\t\tfrappe.utils.copy_to_clipboard(JSON.stringify(me.frm.doc));\n\t\t}, true);\n\n\t\t// rename\n\t\tif(this.can_rename()) {\n\t\t\tthis.page.add_menu_item(__(\"Rename\"), function() {\n\t\t\t\tme.frm.rename_doc();\n\t\t\t}, true);\n\t\t}\n\n\t\t// reload\n\t\tthis.page.add_menu_item(__(\"Reload\"), function() {\n\t\t\tme.frm.reload_doc();\n\t\t}, true);\n\n\t\t// delete\n\t\tif((cint(me.frm.doc.docstatus) != 1) && !me.frm.doc.__islocal\n\t\t\t&& frappe.model.can_delete(me.frm.doctype)) {\n\t\t\tthis.page.add_menu_item(__(\"Delete\"), function() {\n\t\t\t\tme.frm.savetrash();\n\t\t\t}, true, {\n\t\t\t\tshortcut: 'Shift+Ctrl+D',\n\t\t\t\tcondition: () => !this.frm.is_new()\n\t\t\t});\n\t\t}\n\n\t\tthis.make_customize_buttons();\n\n\t\t// Auto Repeat\n\t\tif(this.can_repeat()) {\n\t\t\tthis.page.add_menu_item(__(\"Repeat\"), function(){\n\t\t\t\tfrappe.utils.new_auto_repeat_prompt(me.frm);\n\t\t\t}, true);\n\t\t}\n\n\t\t// New\n\t\tif (p[CREATE] && !this.frm.meta.issingle && !this.frm.meta.in_create) {\n\t\t\tthis.page.add_menu_item(__(\"New {0}\", [__(me.frm.doctype)]), function() {\n\t\t\t\tfrappe.new_doc(me.frm.doctype, true);\n\t\t\t}, true, {\n\t\t\t\tshortcut: 'Ctrl+B',\n\t\t\t\tcondition: () => !this.frm.is_new()\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_customize_buttons() {\n\t\tlet is_doctype_form = this.frm.doctype === 'DocType';\n\t\tif (frappe.model.can_create(\"Custom Field\")\n\t\t\t&& frappe.model.can_create(\"Property Setter\")) {\n\t\t\tlet doctype = is_doctype_form ? this.frm.docname : this.frm.doctype;\n\t\t\tlet is_doctype_custom = is_doctype_form ? this.frm.doc.custom : false;\n\n\t\t\tif (doctype != 'DocType' && !is_doctype_custom && this.frm.meta.issingle === 0) {\n\t\t\t\tthis.page.add_menu_item(__(\"Customize\"), () => {\n\t\t\t\t\tif (this.frm.meta && this.frm.meta.custom) {\n\t\t\t\t\t\tfrappe.set_route('Form', 'DocType', doctype);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.set_route('Form', 'Customize Form', {\n\t\t\t\t\t\t\tdoc_type: doctype\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}, true);\n\t\t\t}\n\t\t}\n\n\t\tif (frappe.model.can_create(\"DocType\")) {\n\t\t\tif (frappe.boot.developer_mode===1 && !is_doctype_form) {\n\t\t\t\t// edit doctype\n\t\t\t\tthis.page.add_menu_item(__(\"Edit DocType\"), () => {\n\t\t\t\t\tfrappe.set_route('Form', 'DocType', this.frm.doctype);\n\t\t\t\t}, true);\n\t\t\t}\n\t\t}\n\n\t}\n\n\tcan_repeat() {\n\t\treturn this.frm.meta.allow_auto_repeat\n\t\t\t&& !this.frm.is_new()\n\t\t\t&& !this.frm.doc.auto_repeat;\n\t}\n\tcan_save() {\n\t\treturn this.get_docstatus()===0;\n\t}\n\tcan_submit() {\n\t\treturn this.get_docstatus()===0\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& !this.frm.doc.__unsaved\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& !this.has_workflow();\n\t}\n\tcan_update() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& this.frm.doc.__unsaved;\n\t}\n\tcan_cancel() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& this.frm.perm[0].cancel\n\t\t\t&& !this.read_only;\n\t}\n\tcan_amend() {\n\t\treturn this.get_docstatus()===2\n\t\t\t&& this.frm.perm[0].amend\n\t\t\t&& !this.read_only;\n\t}\n\thas_workflow() {\n\t\tif(this._has_workflow === undefined)\n\t\t\tthis._has_workflow = frappe.get_list(\"Workflow\", {document_type: this.frm.doctype}).length;\n\t\treturn this._has_workflow;\n\t}\n\tget_docstatus() {\n\t\treturn cint(this.frm.doc.docstatus);\n\t}\n\tshow_linked_with() {\n\t\tif(!this.frm.linked_with) {\n\t\t\tthis.frm.linked_with = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm\n\t\t\t});\n\t\t}\n\t\tthis.frm.linked_with.show();\n\t}\n\tset_primary_action(dirty) {\n\t\tif (!dirty) {\n\t\t\t// don't clear actions menu if dirty\n\t\t\tthis.page.clear_user_actions();\n\t\t}\n\n\t\tvar status = this.get_action_status();\n\t\tif (status) {\n\t\t\t// When moving from a page with status amend to another page with status amend\n\t\t\t// We need to check if document is already amend specifically and hide\n\t\t\t// or clear the menu actions accordingly\n\n\t\t\tif (status !== this.current_status && status === 'Amend') {\n\t\t\t\tlet doc = this.frm.doc;\n\t\t\t\tfrappe.xcall('frappe.client.is_document_amended', {\n\t\t\t\t\t'doctype': doc.doctype,\n\t\t\t\t\t'docname': doc.name\n\t\t\t\t}).then(is_amended => {\n\t\t\t\t\tif (is_amended) {\n\t\t\t\t\t\tthis.page.clear_actions();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.set_page_actions(status);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.set_page_actions(status);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.page.clear_actions();\n\t\t\tthis.current_status = null;\n\t\t}\n\t}\n\tget_action_status() {\n\t\tvar status = null;\n\t\tif (this.frm.page.current_view_name==='print' || this.frm.hidden) {\n\t\t\tstatus = \"Edit\";\n\t\t} else if (this.can_submit()) {\n\t\t\tstatus = \"Submit\";\n\t\t} else if (this.can_save()) {\n\t\t\tif (!this.frm.save_disabled) {\n\t\t\t\t//Show the save button if there is no workflow or if there is a workflow and there are changes\n\t\t\t\tif (this.has_workflow() ? this.frm.doc.__unsaved : true) {\n\t\t\t\t\tstatus = \"Save\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this.can_update()) {\n\t\t\tstatus = \"Update\";\n\t\t} else if (this.can_cancel()) {\n\t\t\tstatus = \"Cancel\";\n\t\t} else if (this.can_amend()) {\n\t\t\tstatus = \"Amend\";\n\t\t}\n\t\treturn status;\n\t}\n\tset_page_actions(status) {\n\t\tvar me = this;\n\t\tthis.page.clear_actions();\n\n\t\tif(status!== 'Edit') {\n\t\t\tvar perm_to_check = this.frm.action_perm_type_map[status];\n\t\t\tif(!this.frm.perm[0][perm_to_check]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif(status === \"Edit\") {\n\t\t\tthis.page.set_primary_action(__(\"Edit\"), function() {\n\t\t\t\tme.frm.page.set_view('main');\n\t\t\t}, 'edit');\n\t\t} else if(status === \"Cancel\") {\n\t\t\tlet add_cancel_button = () => {\n\t\t\t\tthis.page.set_secondary_action(__(status), function() {\n\t\t\t\t\tme.frm.savecancel(this);\n\t\t\t\t});\n\t\t\t};\n\t\t\tif (this.has_workflow()) {\n\t\t\t\tfrappe.xcall('frappe.model.workflow.can_cancel_document', {\n\t\t\t\t\t'doctype': this.frm.doc.doctype,\n\t\t\t\t}).then((can_cancel) => {\n\t\t\t\t\tif (can_cancel) {\n\t\t\t\t\t\tadd_cancel_button();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tadd_cancel_button();\n\t\t\t}\n\t\t} else {\n\t\t\tvar click = {\n\t\t\t\t\"Save\": function() {\n\t\t\t\t\treturn me.frm.save('Save', null, this);\n\t\t\t\t},\n\t\t\t\t\"Submit\": function() {\n\t\t\t\t\treturn me.frm.savesubmit(this);\n\t\t\t\t},\n\t\t\t\t\"Update\": function() {\n\t\t\t\t\treturn me.frm.save('Update', null, this);\n\t\t\t\t},\n\t\t\t\t\"Amend\": function() {\n\t\t\t\t\treturn me.frm.amend_doc();\n\t\t\t\t}\n\t\t\t}[status];\n\n\t\t\tvar icon = {\n\t\t\t\t\"Update\": \"edit\",\n\t\t\t}[status];\n\n\t\t\tthis.page.set_primary_action(__(status), click, icon);\n\t\t}\n\n\t\tthis.current_status = status;\n\t}\n\tadd_update_button_on_dirty() {\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).on(\"dirty\", function() {\n\t\t\tme.show_title_as_dirty();\n\n\t\t\t// clear workflow actions\n\t\t\tme.frm.page.clear_actions_menu();\n\n\t\t\t// enable save action\n\t\t\tif(!me.frm.save_disabled) {\n\t\t\t\tme.set_primary_action(true);\n\t\t\t}\n\t\t});\n\t}\n\tshow_title_as_dirty() {\n\t\tif (this.frm.save_disabled && !this.frm.set_dirty)\n\t\t\treturn;\n\n\t\tif (this.frm.is_dirty()) {\n\t\t\tthis.page.set_indicator(__(\"Not Saved\"), \"orange\");\n\t\t}\n\n\t\t$(this.frm.wrapper).attr(\"data-state\", this.frm.is_dirty() ? \"dirty\" : \"clean\");\n\t}\n\n\tshow_jump_to_field_dialog() {\n\t\tlet visible_fields_filter = f =>\n\t\t\t!['Section Break', 'Column Break', 'Tab Break'].includes(f.df.fieldtype)\n\t\t\t&& !f.df.hidden\n\t\t\t&& f.disp_status !== 'None';\n\n\t\tlet fields = this.frm.fields\n\t\t\t.filter(visible_fields_filter)\n\t\t\t.map(f => ({ label: __(f.df.label), value: f.df.fieldname }));\n\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Jump to field'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Autocomplete',\n\t\t\t\t\tfieldname: 'fieldname',\n\t\t\t\t\tlabel: __('Select Field'),\n\t\t\t\t\toptions: fields,\n\t\t\t\t\treqd: 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __('Go'),\n\t\t\tprimary_action: ({ fieldname }) => {\n\t\t\t\tdialog.hide();\n\t\t\t\tthis.frm.scroll_to_field(fieldname);\n\t\t\t},\n\t\t\tanimate: false,\n\t\t});\n\n\t\tdialog.show();\n\t}\n};\n", "export default class Section {\n\tconstructor(parent, df, card_layout, layout) {\n\t\tthis.layout = layout;\n\t\tthis.card_layout = card_layout;\n\t\tthis.parent = parent;\n\t\tthis.df = df || {};\n\t\tthis.fields_list = [];\n\t\tthis.fields_dict = {};\n\n\t\tthis.make();\n\n\t\tif (this.df.label && this.df.collapsible && localStorage.getItem(df.css_class + '-closed')) {\n\t\t\tthis.collapse();\n\t\t}\n\n\t\tthis.row = {\n\t\t\twrapper: this.wrapper\n\t\t};\n\n\t\tthis.refresh();\n\t}\n\n\tmake() {\n\t\tlet make_card = this.card_layout;\n\t\tthis.wrapper = $(`<div class=\"row\n\t\t\t\t${this.df.is_dashboard_section ? \"form-dashboard-section\" : \"form-section\"}\n\t\t\t\t${ make_card ? \"card-section\" : \"\" }\">\n\t\t\t`).appendTo(this.parent);\n\t\tthis.layout && this.layout.sections.push(this);\n\n\t\tif (this.df) {\n\t\t\tif (this.df.label) {\n\t\t\t\tthis.make_head();\n\t\t\t}\n\t\t\tif (this.df.description) {\n\t\t\t\tthis.description_wrapper = $(\n\t\t\t\t\t`<div class=\"col-sm-12 form-section-description\">\n\t\t\t\t\t\t${__(this.df.description)}\n\t\t\t\t\t</div>`\n\t\t\t\t);\n\n\t\t\t\tthis.wrapper.append(this.description_wrapper);\n\t\t\t}\n\t\t\tif (this.df.css_class) {\n\t\t\t\tthis.wrapper.addClass(this.df.css_class);\n\t\t\t}\n\t\t\tif (this.df.hide_border) {\n\t\t\t\tthis.wrapper.toggleClass(\"hide-border\", true);\n\t\t\t}\n\t\t}\n\n\t\tthis.body = $('<div class=\"section-body\">').appendTo(this.wrapper);\n\n\t\tif (this.df.body_html) {\n\t\t\tthis.body.append(this.df.body_html);\n\t\t}\n\t}\n\n\tmake_head() {\n\t\tthis.head = $(`\n\t\t\t<div class=\"section-head\">\n\t\t\t\t${__(this.df.label)}\n\t\t\t\t<span class=\"ml-2 collapse-indicator mb-1\"></span>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.head.appendTo(this.wrapper);\n\t\tthis.indicator = this.head.find('.collapse-indicator');\n\t\tthis.indicator.hide();\n\n\t\tif (this.df.collapsible) {\n\t\t\t// show / hide based on status\n\t\t\tthis.collapse_link = this.head.on(\"click\", () => {\n\t\t\t\tthis.collapse();\n\t\t\t});\n\t\t\tthis.set_icon();\n\t\t\tthis.indicator.show();\n\t\t}\n\t}\n\n\trefresh(hide) {\n\t\tif (!this.df) return;\n\t\t// hide if explicitly hidden\n\t\thide = hide || this.df.hidden || this.df.hidden_due_to_dependency;\n\t\tthis.wrapper.toggleClass(\"hide-control\", !!hide);\n\t}\n\n\tcollapse(hide) {\n\t\t// unknown edge case\n\t\tif (!(this.head && this.body)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (hide === undefined) {\n\t\t\thide = !this.body.hasClass(\"hide\");\n\t\t}\n\n\t\tthis.body.toggleClass(\"hide\", hide);\n\t\tthis.head && this.head.toggleClass(\"collapsed\", hide);\n\n\t\tthis.set_icon(hide);\n\n\t\t// refresh signature fields\n\t\tthis.fields_list.forEach((f) => {\n\t\t\tif (f.df.fieldtype == 'Signature') {\n\t\t\t\tf.refresh();\n\t\t\t}\n\t\t});\n\n\t\t// save state for next reload ('' is falsy)\n\t\tif (this.df.css_class)\n\t\t\tlocalStorage.setItem(this.df.css_class + '-closed', hide ? '1' : '');\n\t}\n\n\tset_icon(hide) {\n\t\tlet indicator_icon = hide ? 'down' : 'up-line';\n\t\tthis.indicator && this.indicator.html(frappe.utils.icon(indicator_icon, 'sm', 'mb-1'));\n\t}\n\n\tis_collapsed() {\n\t\treturn this.body.hasClass('hide');\n\t}\n\n\thas_missing_mandatory () {\n\t\tlet missing_mandatory = false;\n\t\tfor (let j = 0, l = this.fields_list.length; j < l; j++) {\n\t\t\tconst section_df = this.fields_list[j].df;\n\t\t\tif (section_df.reqd && this.layout.doc[section_df.fieldname] == null) {\n\t\t\t\tmissing_mandatory = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn missing_mandatory;\n\t}\n\n\thide() {\n\t\tthis.on_section_toggle(false);\n\t}\n\n\tshow() {\n\t\tthis.on_section_toggle(true);\n\t}\n\n\ton_section_toggle(show) {\n\t\tthis.wrapper.toggleClass(\"hide-control\", !show);\n\t\t// this.on_section_toggle && this.on_section_toggle(show);\n\t}\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nimport Section from \"./section.js\";\n\nfrappe.ui.form.Dashboard = class FormDashboard {\n\tconstructor(parent, frm) {\n\t\tthis.parent = parent;\n\t\tthis.frm = frm;\n\t\tthis.setup_dashboard_sections();\n\t}\n\n\tsetup_dashboard_sections() {\n\t\tthis.progress_area = this.make_section({\n\t\t\tcss_class: 'progress-area',\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t});\n\n\t\tthis.heatmap_area = this.make_section({\n\t\t\tlabel: __(\"Activity\"),\n\t\t\tcss_class: 'form-heatmap',\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t\tbody_html: `\n\t\t\t\t<div id=\"heatmap-${frappe.model.scrub(this.frm.doctype)}\" class=\"heatmap\"></div>\n\t\t\t\t<div class=\"text-muted small heatmap-message hidden\"></div>\n\t\t\t`\n\t\t});\n\n\t\tthis.chart_area = this.make_section({\n\t\t\tlabel: __(\"Graph\"),\n\t\t\tcss_class: 'form-graph',\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1\n\t\t});\n\n\t\tthis.stats_area_row = $(`<div class=\"row\"></div>`);\n\t\tthis.stats_area = this.make_section({\n\t\t\tlabel: __(\"Stats\"),\n\t\t\tcss_class: 'form-stats',\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t\tbody_html: this.stats_area_row\n\t\t});\n\n\t\tthis.transactions_area = $(`<div class=\"transactions\"></div`);\n\n\t\tthis.links_area = this.make_section({\n\t\t\tlabel: __(\"Connections\"),\n\t\t\tcss_class: 'form-links',\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t\tbody_html: this.transactions_area\n\t\t});\n\t}\n\n\tmake_section(df) {\n\t\treturn new Section(this.parent, df);\n\t}\n\n\treset() {\n\t\t// clear progress\n\t\tthis.progress_area.body.empty();\n\t\tthis.progress_area.hide();\n\n\t\t// clear links\n\t\tthis.links_area.body.find('.count, .open-notification').addClass('hidden');\n\t\tthis.links_area.hide();\n\n\t\t// clear stats\n\t\tthis.stats_area_row.empty();\n\t\tthis.stats_area.hide();\n\n\t\t// clear custom\n\t\tthis.parent.find('.custom').remove();\n\t\t// this.hide();\n\t}\n\n\tadd_section(body_html, label=null, css_class=\"custom\", hidden=false) {\n\t\tlet options = {\n\t\t\tlabel,\n\t\t\tcss_class,\n\t\t\thidden,\n\t\t\tbody_html,\n\t\t\tmake_card: true,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1\n\t\t};\n\t\treturn new Section(this.parent, options).body;\n\t}\n\n\tadd_progress(title, percent, message) {\n\t\tlet progress_chart = this.make_progress_chart(title);\n\n\t\tif (!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\n\t\tlet progress = $('<div class=\"progress\"></div>').appendTo(progress_chart);\n\n\t\t$.each(percent, function(i, opts) {\n\t\t\t$(`<div class=\"progress-bar ${opts.progress_class}\" style=\"width: ${opts.width}\" title=\"${opts.title}\"></div>`).appendTo(progress);\n\t\t});\n\n\t\tif (!message) message = '';\n\t\t$(`<p class=\"progress-message text-muted small\">${message}</p>`).appendTo(progress_chart);\n\n\t\tthis.show();\n\n\t\treturn progress_chart;\n\t}\n\n\tshow_progress(title, percent, message) {\n\t\tthis._progress_map = this._progress_map || {};\n\t\tlet progress_chart = this._progress_map[title];\n\t\t// create a new progress chart if it doesnt exist\n\t\t// or the previous one got detached from the DOM\n\t\tif (!progress_chart || progress_chart.parent().length == 0) {\n\t\t\tprogress_chart = this.add_progress(title, percent, message);\n\t\t\tthis._progress_map[title] = progress_chart;\n\t\t}\n\n\t\tif (!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\t\tprogress_chart.find('.progress-bar').each((i, progress_bar) => {\n\t\t\tconst { progress_class, width } = percent[i];\n\t\t\t$(progress_bar).css('width', width)\n\t\t\t\t.removeClass('progress-bar-danger progress-bar-success')\n\t\t\t\t.addClass(progress_class);\n\t\t});\n\n\t\tif (!message) message = '';\n\t\tprogress_chart.find('.progress-message').text(message);\n\t}\n\n\thide_progress(title) {\n\t\tif (title) {\n\t\t\tthis._progress_map[title].remove();\n\t\t\tdelete this._progress_map[title];\n\t\t} else {\n\t\t\tthis._progress_map = {};\n\t\t\tthis.progress_area.hide();\n\t\t}\n\t}\n\n\tformat_percent(title, percent) {\n\t\tconst percentage = cint(percent);\n\t\tconst width = percentage < 0 ? 100 : percentage;\n\t\tconst progress_class = percentage < 0 ? \"progress-bar-danger\" : \"progress-bar-success\";\n\n\t\treturn [{\n\t\t\ttitle: title,\n\t\t\twidth: width + '%',\n\t\t\tprogress_class: progress_class\n\t\t}];\n\t}\n\n\tmake_progress_chart(title) {\n\t\tthis.progress_area.show();\n\t\tlet progress_chart = $('<div class=\"progress-chart\" title=\"'+(title || '')+'\"></div>')\n\t\t\t.appendTo(this.progress_area.body);\n\t\treturn progress_chart;\n\t}\n\n\trefresh() {\n\t\tthis.reset();\n\t\tif (this.frm.doc.__islocal || !frappe.boot.desk_settings.dashboard) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tlet show = false;\n\n\t\tif (this.data && ((this.data.transactions || []).length\n\t\t\t|| (this.data.reports || []).length)) {\n\t\t\tif (this.data.docstatus && this.frm.doc.docstatus !== this.data.docstatus) {\n\t\t\t\t// limited docstatus\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render_links();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif (this.data.heatmap) {\n\t\t\tthis.render_heatmap();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif (this.data.graph) {\n\t\t\tthis.setup_graph();\n\t\t\t// show = true;\n\t\t}\n\n\t\tif (show) {\n\t\t\tthis.show();\n\t\t}\n\t}\n\n\tafter_refresh() {\n\t\t// show / hide new buttons (if allowed)\n\t\tthis.links_area.body.find('.btn-new').each((i, el) => {\n\t\t\tif (this.frm.can_create($(el).attr('data-doctype'))) {\n\t\t\t\t$(el).removeClass('hidden');\n\t\t\t}\n\t\t});\n\t\t!this.frm.is_new() && this.set_open_count();\n\t}\n\n\tinit_data() {\n\t\tthis.data = this.frm.meta.__dashboard || {};\n\t\tif (!this.data.transactions) this.data.transactions = [];\n\t\tif (!this.data.internal_links) this.data.internal_links = {};\n\t\tthis.filter_permissions();\n\t}\n\n\tadd_transactions(opts) {\n\t\t// add additional data on dashboard\n\t\tlet group_added = [];\n\n\t\tif (!Array.isArray(opts)) opts=[opts];\n\n\t\tif (!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tif (this.data && (this.data.transactions || []).length) {\n\t\t\t// check if label already exists, add items to it\n\t\t\tthis.data.transactions.map(group => {\n\t\t\t\topts.map(d => {\n\t\t\t\t\tif (d.label == group.label) {\n\t\t\t\t\t\tgroup_added.push(d.label);\n\t\t\t\t\t\tgroup.items.push(...d.items);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// if label not already present, add new label and items under it\n\t\t\topts.map(d => {\n\t\t\t\tif (!group_added.includes(d.label)) {\n\t\t\t\t\tthis.data.transactions.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.filter_permissions();\n\t\t}\n\t}\n\n\tfilter_permissions() {\n\t\t// filter out transactions for which the user\n\t\t// does not have permission\n\t\tlet transactions = [];\n\t\t(this.data.transactions || []).forEach(function(group) {\n\t\t\tlet items = [];\n\t\t\tgroup.items.forEach(function(doctype) {\n\t\t\t\tif (frappe.model.can_read(doctype)) {\n\t\t\t\t\titems.push(doctype);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// only add this group, if there is at-least\n\t\t\t// one item with permission\n\t\t\tif (items.length) {\n\t\t\t\tgroup.items = items;\n\t\t\t\ttransactions.push(group);\n\t\t\t}\n\t\t});\n\t\tthis.data.transactions = transactions;\n\t}\n\n\trender_links() {\n\t\tlet me = this;\n\t\tthis.links_area.show();\n\t\tthis.links_area.body.find('.btn-new').addClass('hidden');\n\t\tif (this.data_rendered) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.data.frm = this.frm;\n\n\t\tlet transactions_area_body = this.transactions_area;\n\n\t\t$(frappe.render_template('form_links', this.data))\n\t\t\t.appendTo(transactions_area_body);\n\n\t\tthis.render_report_links();\n\n\t\t// bind links\n\t\ttransactions_area_body.find(\".badge-link\").on('click', function() {\n\t\t\tme.open_document_list($(this).closest('.document-link'));\n\t\t});\n\n\t\t// bind open notifications\n\t\ttransactions_area_body.find('.open-notification').on('click', function() {\n\t\t\tme.open_document_list($(this).parent(), true);\n\t\t});\n\n\t\t// bind new\n\t\ttransactions_area_body.find('.btn-new').on('click', function() {\n\t\t\tme.frm.make_new($(this).attr('data-doctype'));\n\t\t});\n\n\t\tthis.data_rendered = true;\n\t}\n\n\trender_report_links() {\n\t\tlet parent = this.transactions_area;\n\t\tif (this.data.reports && this.data.reports.length) {\n\t\t\t$(frappe.render_template('report_links', this.data))\n\t\t\t\t.appendTo(parent);\n\t\t\t// bind reports\n\t\t\tparent.find(\".report-link\").on('click', (e) => {\n\t\t\t\tthis.open_report($(e.target).parent());\n\t\t\t});\n\t\t}\n\t}\n\n\topen_report($link) {\n\t\tlet report = $link.attr('data-report');\n\n\t\tlet fieldname = this.data.non_standard_fieldnames\n\t\t\t? (this.data.non_standard_fieldnames[report] || this.data.fieldname)\n\t\t\t: this.data.fieldname;\n\n\t\tfrappe.provide('frappe.route_options');\n\t\tfrappe.route_options[fieldname] = this.frm.doc.name;\n\t\tfrappe.set_route(\"query-report\", report);\n\t}\n\n\topen_document_list($link, show_open) {\n\t\t// show document list with filters\n\t\tlet doctype = $link.attr('data-doctype'),\n\t\t\tnames = $link.attr('data-names') || [];\n\n\t\tif (this.data.internal_links[doctype]) {\n\t\t\tif (names.length) {\n\t\t\t\tfrappe.route_options = {'name': ['in', names]};\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else if (this.data.fieldname) {\n\t\t\tfrappe.route_options = this.get_document_filter(doctype);\n\t\t\tif (show_open && frappe.ui.notifications) {\n\t\t\t\tfrappe.ui.notifications.show_open_count_list(doctype);\n\t\t\t}\n\t\t}\n\n\t\tfrappe.set_route(\"List\", doctype, \"List\");\n\t}\n\n\tget_document_filter(doctype) {\n\t\t// return the default filter for the given document\n\t\t// like {\"customer\": frm.doc.name}\n\t\tlet filter = {};\n\t\tlet fieldname = this.data.non_standard_fieldnames\n\t\t\t? (this.data.non_standard_fieldnames[doctype] || this.data.fieldname)\n\t\t\t: this.data.fieldname;\n\n\t\tif (this.data.dynamic_links && this.data.dynamic_links[fieldname]) {\n\t\t\tlet dynamic_fieldname = this.data.dynamic_links[fieldname][1];\n\t\t\tfilter[dynamic_fieldname] = this.data.dynamic_links[fieldname][0];\n\t\t}\n\n\t\tfilter[fieldname] = this.frm.doc.name;\n\t\treturn filter;\n\t}\n\n\tset_open_count() {\n\t\tif (!this.data || (!this.data.transactions || !this.data.fieldname)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// list all items from the transaction list\n\t\tlet items = [],\n\t\t\tme = this;\n\n\t\tthis.data.transactions.forEach(function(group) {\n\t\t\tgroup.items.forEach(function(item) {\n\t\t\t\titems.push(item);\n\t\t\t});\n\t\t});\n\n\t\tlet method = this.data.method || 'frappe.desk.notifications.get_open_count';\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\titems: items\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message.timeline_data) {\n\t\t\t\t\tme.update_heatmap(r.message.timeline_data);\n\t\t\t\t}\n\n\t\t\t\t// update badges\n\t\t\t\t$.each(r.message.count, function(i, d) {\n\t\t\t\t\tme.frm.dashboard.set_badge_count(d.name, cint(d.open_count), cint(d.count));\n\t\t\t\t});\n\n\t\t\t\t// update from internal links\n\t\t\t\t$.each(me.data.internal_links, (doctype, link) => {\n\t\t\t\t\tlet names = [];\n\t\t\t\t\tif (typeof link === 'string' || link instanceof String) {\n\t\t\t\t\t\t// get internal links in parent document\n\t\t\t\t\t\tlet value = me.frm.doc[link];\n\t\t\t\t\t\tif (value && !names.includes(value)) {\n\t\t\t\t\t\t\tnames.push(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (Array.isArray(link)) {\n\t\t\t\t\t\t// get internal links in child documents\n\t\t\t\t\t\tlet [table_fieldname, link_fieldname] = link;\n\t\t\t\t\t\t(me.frm.doc[table_fieldname] || []).forEach(d => {\n\t\t\t\t\t\t\tlet value = d[link_fieldname];\n\t\t\t\t\t\t\tif (value && !names.includes(value)) {\n\t\t\t\t\t\t\t\tnames.push(value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tme.frm.dashboard.set_badge_count(doctype, 0, names.length, names);\n\t\t\t\t});\n\n\t\t\t\tme.frm.dashboard_data = r.message;\n\t\t\t\tme.frm.trigger('dashboard_update');\n\t\t\t}\n\t\t});\n\n\t}\n\n\tset_badge_count(doctype, open_count, count, names) {\n\t\tlet $link = $(this.transactions_area)\n\t\t\t.find('.document-link[data-doctype=\"'+doctype+'\"]');\n\n\t\tif (open_count) {\n\t\t\t$link.find('.open-notification')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.html((open_count > 99) ? '99+' : open_count);\n\t\t}\n\n\t\tif (count) {\n\t\t\t$link.find('.count')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.text((count > 99) ? '99+' : count);\n\t\t}\n\n\t\tif (this.data.internal_links[doctype]) {\n\t\t\tif (names && names.length) {\n\t\t\t\t$link.attr('data-names', names ? names.join(',') : '');\n\t\t\t} else {\n\t\t\t\t$link.find('a').attr('disabled', true);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdate_heatmap(data) {\n\t\tif (this.heatmap) {\n\t\t\tthis.heatmap.update({dataPoints: data});\n\t\t}\n\t}\n\n\t// heatmap\n\trender_heatmap() {\n\t\tif (!this.heatmap) {\n\t\t\tthis.heatmap = new frappe.Chart(\"#heatmap-\" + frappe.model.scrub(this.frm.doctype), {\n\t\t\t\ttype: 'heatmap',\n\t\t\t\tstart: new Date(moment().subtract(1, 'year').toDate()),\n\t\t\t\tcount_label: \"interactions\",\n\t\t\t\tdiscreteDomains: 1,\n\t\t\t\tradius: 3,\n\t\t\t\tdata: {},\n\t\t\t});\n\n\t\t\t// center the heatmap\n\t\t\tthis.heatmap_area.show();\n\t\t\tthis.heatmap_area.body.find('svg').css({'margin': 'auto'});\n\n\t\t\t// message\n\t\t\tlet heatmap_message = this.heatmap_area.body.find('.heatmap-message');\n\t\t\tif (this.data.heatmap_message) {\n\t\t\t\theatmap_message.removeClass('hidden').html(this.data.heatmap_message);\n\t\t\t} else {\n\t\t\t\theatmap_message.addClass('hidden');\n\t\t\t}\n\t\t}\n\t}\n\n\tadd_indicator(label, color) {\n\t\tthis.show();\n\t\tthis.stats_area.show();\n\n\n\t\t// set colspan\n\t\tlet indicators = this.stats_area_row.find('.indicator-column');\n\t\tlet n_indicators = indicators.length + 1;\n\t\tlet colspan;\n\t\tif (n_indicators > 4) {\n\t\t\tcolspan = 3;\n\t\t} else {\n\t\t\tcolspan = 12 / n_indicators;\n\t\t}\n\n\t\t// reset classes in existing indicators\n\t\tif (indicators.length) {\n\t\t\tindicators.removeClass().addClass('col-sm-'+colspan).addClass('indicator-column');\n\t\t}\n\n\t\tlet indicator = $('<div class=\"col-sm-'+colspan+' indicator-column\"><span class=\"indicator '+color+'\">'\n\t\t\t+label+'</span></div>').appendTo(this.stats_area_row);\n\n\t\treturn indicator;\n\t}\n\n\t// graphs\n\tsetup_graph() {\n\t\tlet me = this;\n\t\tlet method = this.data.graph_method;\n\t\tlet args = {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.doc.name,\n\t\t};\n\t\t$.extend(args, this.data.graph_method_args);\n\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: args,\n\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tme.render_graph(r.message);\n\t\t\t\t\tme.show();\n\t\t\t\t} else {\n\t\t\t\t\tme.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\trender_graph(args) {\n\t\tthis.chart_area.show();\n\t\tthis.chart_area.body.empty();\n\t\t$.extend(args, {\n\t\t\ttype: 'line',\n\t\t\tcolors: ['green'],\n\t\t\ttruncateLegends: 1,\n\t\t\taxisOptions: {\n\t\t\t\tshortenYAxisNumbers: 1,\n\t\t\t\tnumberFormatter: frappe.utils.format_chart_axis_number,\n\t\t\t}\n\t\t});\n\t\tthis.show();\n\n\t\tthis.chart = new frappe.Chart('.form-graph', args);\n\t\tif (!this.chart) {\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tshow() {\n\t\tthis.toggle_visibility(true);\n\t}\n\n\thide() {\n\t\tthis.toggle_visibility(false);\n\t}\n\n\ttoggle_visibility(show) {\n\t\tthis.parent.toggleClass('visible-section', show);\n\t\tthis.parent.toggleClass('empty-section', !show);\n\t}\n\n\t// TODO: Review! code related to headline should be the part of layout/form\n\tset_headline(html, color) {\n\t\tthis.frm.layout.show_message(html, color);\n\t}\n\n\tclear_headline() {\n\t\tthis.frm.layout.show_message();\n\t}\n\n\tadd_comment(text, alert_class, permanent) {\n\t\tthis.set_headline_alert(text, alert_class);\n\t\tif (!permanent) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.clear_headline();\n\t\t\t}, 10000);\n\t\t}\n\t}\n\n\tclear_comment() {\n\t\tthis.clear_headline();\n\t}\n\n\tset_headline_alert(text, color) {\n\t\tif (text) {\n\t\t\tthis.set_headline(`<div>${text}</div>`, color);\n\t\t} else {\n\t\t\tthis.clear_headline();\n\t\t}\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.States = class FormStates {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.frm.doctype);\n\n\t\t// no workflow?\n\t\tif(!this.state_fieldname)\n\t\t\treturn;\n\n\t\tthis.update_fields = frappe.workflow.get_update_fields(this.frm.doctype);\n\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).bind(\"render_complete\", function() {\n\t\t\tme.refresh();\n\t\t});\n\t}\n\n\tsetup_help() {\n\t\tvar me = this;\n\t\tthis.frm.page.add_action_item(__(\"Help\"), function() {\n\t\t\tfrappe.workflow.setup(me.frm.doctype);\n\t\t\tvar state = me.get_state();\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: \"Workflow: \"\n\t\t\t\t\t+ frappe.workflow.workflows[me.frm.doctype].name\n\t\t\t});\n\n\t\t\tfrappe.workflow.get_transitions(me.frm.doc).then((transitions) => {\n\t\t\t\tconst next_actions = $.map(transitions, d => `${d.action.bold()} ${__(\"by Role\")} ${d.allowed}`)\n\t\t\t\t\t.join(\", \") || __(\"None: End of Workflow\").bold();\n\n\t\t\t\tconst document_editable_by = frappe.workflow.get_document_state(me.frm.doctype, state).allow_edit.bold();\n\n\t\t\t\t$(d.body).html(`\n\t\t\t\t\t<p>${__(\"Current status\")}: ${state.bold()}</p>\n\t\t\t\t\t<p>${__(\"Document is only editable by users with role\")}: ${document_editable_by}</p>\n\t\t\t\t\t<p>${__(\"Next actions\")}: ${next_actions}</p>\n\t\t\t\t\t<p>${__(\"{0}: Other permission rules may also apply\", [__('Note').bold()])}</p>\n\t\t\t\t`).css({padding: '15px'});\n\n\t\t\t\td.show();\n\t\t\t});\n\t\t}, true);\n\t}\n\n\trefresh() {\n\t\t// hide if its not yet saved\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.set_default_state();\n\t\t\treturn;\n\t\t}\n\n\t\t// state text\n\t\tconst state = this.get_state();\n\n\t\tif(state) {\n\t\t\t// show actions from that state\n\t\t\tthis.show_actions(state);\n\t\t}\n\t}\n\n\tshow_actions() {\n\t\tvar added = false;\n\t\tvar me = this;\n\n\t\t// if the loaded doc is dirty, don't show workflow buttons\n\t\tif (this.frm.doc.__unsaved===1) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction has_approval_access(transition) {\n\t\t\tlet approval_access = false;\n\t\t\tconst user = frappe.session.user;\n\t\t\tif (user === 'Administrator'\n\t\t\t\t|| transition.allow_self_approval\n\t\t\t\t|| user !== me.frm.doc.owner) {\n\t\t\t\tapproval_access = true;\n\t\t\t}\n\t\t\treturn approval_access;\n\t\t}\n\n\t\tfrappe.workflow.get_transitions(this.frm.doc).then(transitions => {\n\t\t\tthis.frm.page.clear_actions_menu();\n\t\t\ttransitions.forEach(d => {\n\t\t\t\tif (frappe.user_roles.includes(d.allowed) && has_approval_access(d)) {\n\t\t\t\t\tadded = true;\n\t\t\t\t\tme.frm.page.add_action_item(__(d.action), function() {\n\t\t\t\t\t\t// set the workflow_action for use in form scripts\n\t\t\t\t\t\tme.frm.selected_workflow_action = d.action;\n\t\t\t\t\t\tme.frm.script_manager.trigger('before_workflow_action').then(() => {\n\t\t\t\t\t\t\tfrappe.xcall('frappe.model.workflow.apply_workflow',\n\t\t\t\t\t\t\t\t{doc: me.frm.doc, action: d.action})\n\t\t\t\t\t\t\t\t.then((doc) => {\n\t\t\t\t\t\t\t\t\tfrappe.model.sync(doc);\n\t\t\t\t\t\t\t\t\tme.frm.refresh();\n\t\t\t\t\t\t\t\t\tme.frm.selected_workflow_action = null;\n\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger(\"after_workflow_action\");\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.setup_btn(added);\n\t\t});\n\n\t}\n\n\tsetup_btn(action_added) {\n\t\tif(action_added) {\n\t\t\tthis.frm.page.btn_primary.addClass(\"hide\");\n\t\t\tthis.frm.page.btn_secondary.addClass(\"hide\");\n\t\t\tthis.frm.toolbar.current_status = \"\";\n\t\t\tthis.setup_help();\n\t\t}\n\t}\n\n\tset_default_state() {\n\t\tvar default_state = frappe.workflow.get_default_state(this.frm.doctype, this.frm.doc.docstatus);\n\t\tif(default_state) {\n\t\t\tthis.frm.set_value(this.state_fieldname, default_state);\n\t\t}\n\t}\n\n\tget_state() {\n\t\tif(!this.frm.doc[this.state_fieldname]) {\n\t\t\tthis.set_default_state();\n\t\t}\n\t\treturn this.frm.doc[this.state_fieldname];\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n\n\nfrappe.ui.form.save = function (frm, action, callback, btn) {\n\t$(btn).prop(\"disabled\", true);\n\n\t// specified here because there are keyboard shortcuts to save\n\tconst working_label = {\n\t\t\"Save\": __(\"Saving\", null, \"Freeze message while saving a document\"),\n\t\t\"Submit\": __(\"Submitting\", null, \"Freeze message while submitting a document\"),\n\t\t\"Update\": __(\"Updating\", null, \"Freeze message while updating a document\"),\n\t\t\"Amend\": __(\"Amending\", null, \"Freeze message while amending a document\"),\n\t\t\"Cancel\": __(\"Cancelling\", null, \"Freeze message while cancelling a document\"),\n\t}[toTitle(action)];\n\n\tvar freeze_message = working_label ? __(working_label) : \"\";\n\n\tvar save = function () {\n\t\tremove_empty_rows();\n\n\t\t$(frm.wrapper).addClass('validated-form');\n\t\tif ((action !== 'Save' || frm.is_dirty()) && check_mandatory()) {\n\t\t\t_call({\n\t\t\t\tmethod: \"frappe.desk.form.save.savedocs\",\n\t\t\t\targs: { doc: frm.doc, action: action },\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\terror: function (r) {\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\tbtn: btn,\n\t\t\t\tfreeze_message: freeze_message\n\t\t\t});\n\t\t} else {\n\t\t\t!frm.is_dirty() && frappe.show_alert({message: __(\"No changes in document\"), indicator: \"orange\"});\n\t\t\t$(btn).prop(\"disabled\", false);\n\t\t}\n\t};\n\n\tvar remove_empty_rows = function() {\n\t\t/*\n\t\t\tThis function removes empty rows. Note that in this function, a row is considered\n\t\t\tempty if the fields with `in_list_view: 1` are undefined or falsy because that's\n\t\t\twhat users also consider to be an empty row\n\t\t*/\n\t\tconst docs = frappe.model.get_all_docs(frm.doc);\n\n\t\t// we should only worry about table data\n\t\tconst tables = docs.filter(d => {\n\t\t\treturn frappe.model.is_table(d.doctype);\n\t\t});\n\n\t\tlet modified_table_fields = [];\n\n\t\ttables.map(doc => {\n\t\t\tconst cells = frappe.meta.docfield_list[doc.doctype] || [];\n\n\t\t\tconst in_list_view_cells = cells.filter((df) => {\n\t\t\t\treturn cint(df.in_list_view) === 1;\n\t\t\t});\n\n\t\t\tconst is_empty_row = function(cells) {\n\t\t\t\tfor (let i = 0; i < cells.length; i++) {\n\t\t\t\t\tif (locals[doc.doctype][doc.name][cells[i].fieldname]) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\tif (is_empty_row(in_list_view_cells)) {\n\t\t\t\tfrappe.model.clear_doc(doc.doctype, doc.name);\n\t\t\t\tmodified_table_fields.push(doc.parentfield);\n\t\t\t}\n\t\t});\n\n\t\tmodified_table_fields.forEach(field => {\n\t\t\tfrm.refresh_field(field);\n\t\t});\n\t};\n\n\tvar cancel = function () {\n\t\tvar args = {\n\t\t\tdoctype: frm.doc.doctype,\n\t\t\tname: frm.doc.name\n\t\t};\n\n\t\t// update workflow state value if workflow exists\n\t\tvar workflow_state_fieldname = frappe.workflow.get_state_fieldname(frm.doctype);\n\t\tif (workflow_state_fieldname) {\n\t\t\t$.extend(args, {\n\t\t\t\tworkflow_state_fieldname: workflow_state_fieldname,\n\t\t\t\tworkflow_state: frm.doc[workflow_state_fieldname]\n\n\t\t\t});\n\t\t}\n\n\t\t_call({\n\t\t\tmethod: \"frappe.desk.form.save.cancel\",\n\t\t\targs: args,\n\t\t\tcallback: function (r) {\n\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\tcallback(r);\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tfreeze_message: freeze_message\n\t\t});\n\t};\n\n\tvar check_mandatory = function () {\n\t\tvar has_errors = false;\n\t\tfrm.scroll_set = false;\n\n\t\tif (frm.doc.docstatus == 2) return true; // don't check for cancel\n\n\t\t$.each(frappe.model.get_all_docs(frm.doc), function (i, doc) {\n\t\t\tvar error_fields = [];\n\t\t\tvar folded = false;\n\n\t\t\t$.each(frappe.meta.docfield_list[doc.doctype] || [], function (i, docfield) {\n\t\t\t\tif (docfield.fieldname) {\n\t\t\t\t\tconst df = frappe.meta.get_docfield(doc.doctype,\n\t\t\t\t\t\tdocfield.fieldname, doc.name);\n\n\t\t\t\t\tif (df.fieldtype === \"Fold\") {\n\t\t\t\t\t\tfolded = frm.layout.folded;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (is_docfield_mandatory(doc, df) &&\n\t\t\t\t\t\t!frappe.model.has_value(doc.doctype, doc.name, df.fieldname)) {\n\t\t\t\t\t\thas_errors = true;\n\t\t\t\t\t\terror_fields[error_fields.length] = __(df.label);\n\t\t\t\t\t\t// scroll to field\n\t\t\t\t\t\tif (!frm.scroll_set) {\n\t\t\t\t\t\t\tscroll_to(doc.parentfield || df.fieldname);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (folded) {\n\t\t\t\t\t\t\tfrm.layout.unfold();\n\t\t\t\t\t\t\tfolded = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (frm.is_new() && frm.meta.autoname === 'Prompt' && !frm.doc.__newname) {\n\t\t\t\thas_errors = true;\n\t\t\t\terror_fields = [__('Name'), ...error_fields];\n\t\t\t}\n\n\t\t\tif (error_fields.length) {\n\t\t\t\tlet meta = frappe.get_meta(doc.doctype);\n\t\t\t\tif (meta.istable) {\n\t\t\t\t\tconst table_label = __(frappe.meta.docfield_map[doc.parenttype][doc.parentfield].label).bold();\n\t\t\t\t\tvar message = __('Mandatory fields required in table {0}, Row {1}', [table_label, doc.idx]);\n\t\t\t\t} else {\n\t\t\t\t\tvar message = __('Mandatory fields required in {0}', [__(doc.doctype)]);\n\t\t\t\t}\n\t\t\t\tmessage = message + '<br><br><ul><li>' + error_fields.join('</li><li>') + \"</ul>\";\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\ttitle: __('Missing Fields')\n\t\t\t\t});\n\t\t\t\tfrm.refresh();\n\t\t\t}\n\t\t});\n\n\t\treturn !has_errors;\n\t};\n\n\tlet is_docfield_mandatory = function(doc, df) {\n\t\tif (df.reqd) return true;\n\t\tif (!df.mandatory_depends_on || !doc) return;\n\n\t\tlet out = null;\n\t\tlet expression = df.mandatory_depends_on;\n\t\tlet parent = frappe.get_meta(df.parent);\n\n\t\tif (typeof (expression) === 'boolean') {\n\t\t\tout = expression;\n\n\t\t} else if (typeof (expression) === 'function') {\n\t\t\tout = expression(doc);\n\n\t\t} else if (expression.substr(0, 5) == 'eval:') {\n\t\t\ttry {\n\t\t\t\tout = frappe.utils.eval(expression.substr(5), { doc, parent });\n\t\t\t\tif (parent && parent.istable && expression.includes('is_submittable')) {\n\t\t\t\t\tout = true;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tfrappe.throw(__('Invalid \"mandatory_depends_on\" expression'));\n\t\t\t}\n\n\t\t} else {\n\t\t\tvar value = doc[expression];\n\t\t\tif ($.isArray(value)) {\n\t\t\t\tout = !!value.length;\n\t\t\t} else {\n\t\t\t\tout = !!value;\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t};\n\n\tconst scroll_to = (fieldname) => {\n\t\tfrm.scroll_to_field(fieldname);\n\t\tfrm.scroll_set = true;\n\t};\n\n\tvar _call = function (opts) {\n\t\t// opts = {\n\t\t// \tmethod: \"some server method\",\n\t\t// \targs: {args to be passed},\n\t\t// \tcallback: callback,\n\t\t// \tbtn: btn\n\t\t// }\n\n\t\tif (frappe.ui.form.is_saving) {\n\t\t\t// this is likely to happen if the user presses the shortcut cmd+s for a longer duration or uses double click\n\t\t\t// no need to show this to user, as they can see \"Saving\" in freeze message\n\t\t\tconsole.log(\"Already saving. Please wait a few moments.\")\n\t\t\tthrow \"saving\";\n\t\t}\n\n\t\t// ensure we remove new docs routes ONLY\n\t\tif ( frm.is_new() ) {\n\t\t\tfrappe.ui.form.remove_old_form_route();\n\t\t}\n\t\tfrappe.ui.form.is_saving = true;\n\n\t\treturn frappe.call({\n\t\t\tfreeze: true,\n\t\t\t// freeze_message: opts.freeze_message,\n\t\t\tmethod: opts.method,\n\t\t\targs: opts.args,\n\t\t\tbtn: opts.btn,\n\t\t\tcallback: function (r) {\n\t\t\t\topts.callback && opts.callback(r);\n\t\t\t},\n\t\t\terror: opts.error,\n\t\t\talways: function (r) {\n\t\t\t\t$(btn).prop(\"disabled\", false);\n\t\t\t\tfrappe.ui.form.is_saving = false;\n\n\t\t\t\tif (r) {\n\t\t\t\t\tvar doc = r.docs && r.docs[0];\n\t\t\t\t\tif (doc) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(doc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t};\n\n\tif (action === \"cancel\") {\n\t\tcancel();\n\t} else {\n\t\tsave();\n\t}\n}\n\nfrappe.ui.form.remove_old_form_route = () => {\n\tlet current_route = frappe.get_route().join(\"/\");\n\tfrappe.route_history = frappe.route_history\n\t\t.filter((route) => route.join(\"/\") !== current_route);\n}\n\nfrappe.ui.form.update_calling_link = (newdoc) => {\n\tif (!frappe._from_link) return;\n\tvar doc = frappe.get_doc(frappe._from_link.doctype, frappe._from_link.docname);\n\n\tlet is_valid_doctype = () => {\n\t\tif (frappe._from_link.df.fieldtype==='Link') {\n\t\t\treturn newdoc.doctype === frappe._from_link.df.options;\n\t\t} else {\n\t\t\t// dynamic link, type is dynamic\n\t\t\treturn newdoc.doctype === doc[frappe._from_link.df.options];\n\t\t}\n\t};\n\n\tif (is_valid_doctype()) {\n\t\tfrappe.model.with_doctype(newdoc.doctype, () => {\n\t\t\tlet meta = frappe.get_meta(newdoc.doctype);\n\t\t\t// set value\n\t\t\tif (doc && doc.parentfield) {\n\t\t\t\t//update values for child table\n\t\t\t\t$.each(frappe._from_link.frm.fields_dict[doc.parentfield].grid.grid_rows, function (index, field) {\n\t\t\t\t\tif (field.doc && field.doc.name === frappe._from_link.docname) {\n\t\t\t\t\t\tif (meta.title_field && meta.show_title_field_in_link) {\n\t\t\t\t\t\t\tfrappe.utils.add_link_title(newdoc.doctype, newdoc.name, newdoc[meta.title_field]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (meta.title_field && meta.show_title_field_in_link) {\n\t\t\t\t\tfrappe.utils.add_link_title(newdoc.doctype, newdoc.name, newdoc[meta.title_field]);\n\t\t\t\t}\n\t\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t\t}\n\n\t\t\t// refresh field\n\t\t\tfrappe._from_link.refresh();\n\n\t\t\t// if from form, switch\n\t\t\tif (frappe._from_link.frm) {\n\t\t\t\tfrappe.set_route(\"Form\",\n\t\t\t\t\tfrappe._from_link.frm.doctype, frappe._from_link.frm.docname)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tfrappe.utils.scroll_to(frappe._from_link_scrollY);\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tfrappe._from_link = null;\n\t\t});\n\t}\n}\n", "frappe.ui.get_print_settings = function(\n\tpdf,\n\tcallback,\n\tletter_head,\n\tpick_columns\n) {\n\tvar print_settings = locals[\":Print Settings\"][\"Print Settings\"];\n\n\tvar default_letter_head =\n\t\tlocals[\":Company\"] && frappe.defaults.get_default(\"company\")\n\t\t\t? locals[\":Company\"][frappe.defaults.get_default(\"company\")][\"default_letter_head\"]\n\t\t\t: \"\";\n\n\tvar columns = [\n\t\t{\n\t\t\tfieldtype: \"Check\",\n\t\t\tfieldname: \"with_letter_head\",\n\t\t\tlabel: __(\"With Letter head\")\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Select\",\n\t\t\tfieldname: \"letter_head\",\n\t\t\tlabel: __(\"Letter Head\"),\n\t\t\tdepends_on: \"with_letter_head\",\n\t\t\toptions: Object.keys(frappe.boot.letter_heads),\n\t\t\tdefault: letter_head || default_letter_head\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Select\",\n\t\t\tfieldname: \"orientation\",\n\t\t\tlabel: __(\"Orientation\"),\n\t\t\toptions: [\n\t\t\t\t{ value: \"Landscape\", label: __(\"Landscape\") },\n\t\t\t\t{ value: \"Portrait\", label: __(\"Portrait\") }\n\t\t\t],\n\t\t\tdefault: \"Landscape\"\n\t\t}\n\t];\n\n\tif (pick_columns) {\n\t\tcolumns.push(\n\t\t\t{\n\t\t\t\tlabel: __(\"Pick Columns\"),\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tfieldname: \"pick_columns\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Select Columns\"),\n\t\t\t\tfieldtype: \"MultiCheck\",\n\t\t\t\tfieldname: \"columns\",\n\t\t\t\tdepends_on: \"pick_columns\",\n\t\t\t\tcolumns: 2,\n\t\t\t\toptions: pick_columns.map(df => ({\n\t\t\t\t\tlabel: __(df.label),\n\t\t\t\t\tvalue: df.fieldname\n\t\t\t\t}))\n\t\t\t}\n\t\t);\n\t}\n\n\treturn frappe.prompt(\n\t\tcolumns,\n\t\tfunction(data) {\n\t\t\tdata = $.extend(print_settings, data);\n\t\t\tif (!data.with_letter_head) {\n\t\t\t\tdata.letter_head = null;\n\t\t\t}\n\t\t\tif (data.letter_head) {\n\t\t\t\tdata.letter_head =\n\t\t\t\t\tfrappe.boot.letter_heads[print_settings.letter_head];\n\t\t\t}\n\t\t\tcallback(data);\n\t\t},\n\t\t__(\"Print Settings\")\n\t);\n};\n\n// qz tray connection wrapper\n//  - allows active and inactive connections to resolve regardless\n//  - try to connect once before firing the mimetype launcher\n//  - if connection fails, catch the reject, fire the mimetype launcher\n//  - after mimetype launcher is fired, try to connect 3 more times\n//  - display success/fail message to user\nfrappe.ui.form.qz_connect = function() {\n\treturn new Promise(function(resolve, reject) {\n\t\tfrappe.ui.form.qz_init().then(() => {\n\t\t\tif (qz.websocket.isActive()) {\n\t\t\t\t// if already active, resolve immediately\n\t\t\t\t// frappe.show_alert({message: __('QZ Tray Connection Active!'), indicator: 'green'});\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\t// try to connect once before firing the mimetype launcher\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Attempting Connection to QZ Tray...\"),\n\t\t\t\t\tindicator: \"blue\"\n\t\t\t\t});\n\t\t\t\tqz.websocket.connect().then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"Connected to QZ Tray!\"),\n\t\t\t\t\t\t\tindicator: \"green\"\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\tfunction retry(err) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\terr.message ===\n\t\t\t\t\t\t\t\"Unable to establish connection with QZ\"\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// if a connect was not successful, launch the mimetype, try 3 more times\n\t\t\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t\t\t\t\"Attempting to launch QZ Tray...\"\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\tindicator: \"blue\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t14\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\twindow.location.assign(\"qz:launch\");\n\t\t\t\t\t\t\tqz.websocket\n\t\t\t\t\t\t\t\t.connect({\n\t\t\t\t\t\t\t\t\tretries: 3,\n\t\t\t\t\t\t\t\t\tdelay: 1\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\t\t\tmessage: __(\n\t\t\t\t\t\t\t\t\t\t\t\t\"Connected to QZ Tray!\"\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\tindicator: \"green\"\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\t\t\t'Error connecting to QZ Tray Application...<br><br> You need to have QZ Tray application installed and running, to use the Raw Print feature.<br><br><a target=\"_blank\" href=\"https://qz.io/download/\">Click here to Download and install QZ Tray</a>.<br> <a target=\"_blank\" href=\"https://erpnext.com/docs/user/manual/en/setting-up/print/raw-printing\">Click here to learn more about Raw Printing</a>.'\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmessage: \"QZ Tray \" + err.toString(),\n\t\t\t\t\t\t\t\t\tindicator: \"red\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t14\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t});\n};\n\nfrappe.ui.form.qz_init = function() {\n\t// Initializing qz tray library\n\treturn new Promise(resolve => {\n\t\tif (typeof qz === \"object\" && typeof qz.version === \"string\") {\n\t\t\t// resolve immediately if already Initialized\n\t\t\tresolve();\n\t\t} else {\n\t\t\tlet qz_required_assets = [\n\t\t\t\t\"/assets/frappe/node_modules/js-sha256/build/sha256.min.js\",\n\t\t\t\t\"/assets/frappe/node_modules/qz-tray/qz-tray.js\"\n\t\t\t];\n\t\t\tfrappe.require(qz_required_assets, () => {\n\t\t\t\tqz.api.setPromiseType(function promise(resolver) {\n\t\t\t\t\treturn new Promise(resolver);\n\t\t\t\t});\n\t\t\t\tqz.api.setSha256Type(function(data) {\n\t\t\t\t\t// Codacy fix\n\t\t\t\t\t/*global sha256*/\n\t\t\t\t\treturn sha256(data);\n\t\t\t\t});\n\t\t\t\tresolve();\n\t\t\t});\n\t\t\t// note 'frappe.require' does not have callback on fail. Hence, any failure cannot be communicated to the user.\n\t\t}\n\t});\n};\n\nfrappe.ui.form.qz_get_printer_list = function() {\n\t// returns the list of printers that are available to the QZ Tray\n\treturn frappe.ui.form\n\t\t.qz_connect()\n\t\t.then(function() {\n\t\t\treturn qz.printers.find();\n\t\t})\n\t\t.then(data => {\n\t\t\treturn data;\n\t\t})\n\t\t.catch(err => {\n\t\t\tfrappe.ui.form.qz_fail(err);\n\t\t});\n};\n\nfrappe.ui.form.qz_success = function() {\n\t// notify qz successful print\n\tfrappe.show_alert({\n\t\tmessage: __(\"Print Sent to the printer!\"),\n\t\tindicator: \"green\"\n\t});\n};\n\nfrappe.ui.form.qz_fail = function(e) {\n\t// notify qz errors\n\tfrappe.show_alert(\n\t\t{\n\t\t\tmessage: __(\"QZ Tray Failed: \") + e.toString(),\n\t\t\tindicator: \"red\"\n\t\t},\n\t\t20\n\t);\n};\n", "frappe.provide('frappe.ui.form');\nfrappe.provide('frappe.success_action');\n\nfrappe.ui.form.SuccessAction = class SuccessAction {\n\tconstructor(form) {\n\t\tthis.form = form;\n\t\tthis.load_setting();\n\t}\n\n\tload_setting() {\n\t\tthis.setting = frappe.boot.success_action\n\t\t\t.find(setting => setting.ref_doctype === this.form.doctype);\n\t}\n\n\tshow() {\n\t\tif (!this.setting) return;\n\t\tif (this.form.doc.docstatus === 0 && !this.is_first_creation()) return;\n\n\t\tthis.prepare_dom();\n\t\tthis.show_alert();\n\t}\n\n\tprepare_dom() {\n\t\tthis.container = $(document.body).find('.success-container');\n\t\tif (!this.container.length) {\n\t\t\tthis.container = $('<div class=\"success-container\">').appendTo(document.body);\n\t\t}\n\t}\n\n\tshow_alert() {\n\t\tfrappe.db.get_list(this.form.doctype, {limit: 2})\n\t\t\t.then(result => {\n\t\t\t\tconst count = result.length;\n\t\t\t\tconst setting = this.setting;\n\t\t\t\tlet message = count === 1 ?\n\t\t\t\t\tsetting.first_success_message :\n\t\t\t\t\tsetting.message;\n\n\t\t\t\tconst $buttons = this.get_actions().map(action => {\n\t\t\t\t\tconst $btn = $(`<button class=\"next-action\"><span>${__(action.label)}</span></button>`);\n\t\t\t\t\t$btn.click(() => action.action(this.form));\n\t\t\t\t\treturn $btn;\n\t\t\t\t});\n\n\t\t\t\tconst next_action_container = $(`<div class=\"next-action-container\"></div>`);\n\t\t\t\tnext_action_container.append($buttons);\n\t\t\t\tconst html = next_action_container;\n\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tbody: html,\n\t\t\t\t\tindicator: 'green',\n\t\t\t\t}, setting.action_timeout || 7);\n\t\t\t});\n\t}\n\n\tget_actions() {\n\t\tconst actions = [];\n\t\tconst checked_actions = this.setting.next_actions.split(\"\\n\");\n\t\tchecked_actions\n\t\t\t.forEach(action => {\n\t\t\t\tif (typeof action === 'string' && this.default_actions[action]) {\n\t\t\t\t\tactions.push(this.default_actions[action]);\n\t\t\t\t} else if (typeof action === 'object') {\n\t\t\t\t\tactions.push(action);\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn actions;\n\t}\n\n\tget default_actions() {\n\t\treturn {\n\t\t\t'new': {\n\t\t\t\tlabel: __('New'),\n\t\t\t\taction: (frm) => frappe.new_doc(frm.doctype)\n\t\t\t},\n\t\t\t'print': {\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: (frm) => frm.print_doc()\n\t\t\t},\n\t\t\t'email': {\n\t\t\t\tlabel: __('Email'),\n\t\t\t\taction: (frm) => frm.email_doc()\n\t\t\t},\n\t\t\t'list': {\n\t\t\t\tlabel: __('View All'),\n\t\t\t\taction: (frm) => {\n\t\t\t\t\tfrappe.set_route('List', frm.doctype);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tis_first_creation() {\n\t\tlet { modified, creation } = this.form.doc;\n\n\t\t// strip out milliseconds\n\t\tmodified = modified.split('.')[0];\n\t\tcreation = creation.split('.')[0];\n\n\t\treturn modified === creation;\n\t}\n\n};\n", "frappe.provide('frappe.ui.form');\nfrappe.provide('frappe.model.docinfo');\n\nimport './quick_entry';\nimport './toolbar';\nimport './dashboard';\nimport './workflow';\nimport './save';\nimport './print_utils';\nimport './success_action';\nimport './script_manager';\nimport './script_helpers';\nimport './sidebar/form_sidebar';\nimport './footer/footer';\nimport './form_tour';\nimport { UndoManager } from './undo_manager';\n\nfrappe.ui.form.Controller = class FormController {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n};\n\nfrappe.ui.form.Form = class FrappeForm {\n\tconstructor(doctype, parent, in_form, doctype_layout_name) {\n\t\tthis.docname = '';\n\t\tthis.doctype = doctype;\n\t\tthis.doctype_layout_name = doctype_layout_name;\n\t\tthis.in_form = in_form ? true : false;\n\n\t\tthis.hidden = false;\n\t\tthis.refresh_if_stale_for = 120;\n\t\tthis.opendocs = {};\n\t\tthis.custom_buttons = {};\n\t\tthis.sections = [];\n\t\tthis.grids = [];\n\t\tthis.cscript = new frappe.ui.form.Controller({ frm: this });\n\t\tthis.events = {};\n\t\tthis.fetch_dict = {};\n\t\tthis.parent = parent;\n\t\tthis.doctype_layout = frappe.get_doc('DocType Layout', doctype_layout_name);\n\t\tthis.undo_manager = new UndoManager({frm: this});\n\t\tthis.setup_meta(doctype);\n\n\t\tthis.beforeUnloadListener = (event) => {\n\t\t\tevent.preventDefault();\n\t\t\t// A String is returned for compatability with older Browsers. Return Value has to be truthy to trigger \"Leave Site\" Dialog\n\t\t\treturn event.returnValue = 'There are unsaved changes, are you sure you want to exit?';\n\t\t};\n\t}\n\n\tsetup_meta() {\n\t\tthis.meta = frappe.get_doc('DocType', this.doctype);\n\n\t\tif(this.meta.istable) {\n\t\t\tthis.meta.in_dialog = 1;\n\t\t}\n\n\t\tthis.perm = frappe.perm.get_perm(this.doctype); // for create\n\t\tthis.action_perm_type_map = {\n\t\t\t\"Create\": \"create\",\n\t\t\t\"Save\": \"write\",\n\t\t\t\"Submit\": \"submit\",\n\t\t\t\"Update\": \"submit\",\n\t\t\t\"Cancel\": \"cancel\",\n\t\t\t\"Amend\": \"amend\",\n\t\t\t\"Delete\": \"delete\"\n\t\t};\n\t}\n\n\tsetup() {\n\t\tthis.fields = [];\n\t\tthis.fields_dict = {};\n\t\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\n\t\t// wrapper\n\t\tthis.wrapper = this.parent;\n\t\tthis.$wrapper = $(this.wrapper);\n\t\tfrappe.ui.make_app_page({\n\t\t\tparent: this.wrapper,\n\t\t\tsingle_column: this.meta.hide_toolbar\n\t\t});\n\t\tthis.page = this.wrapper.page;\n\t\tthis.layout_main = this.page.main.get(0);\n\n\t\tthis.$wrapper.on(\"hide\", () => {\n\t\t\tthis.script_manager.trigger(\"on_hide\");\n\t\t});\n\n\t\tthis.toolbar = new frappe.ui.form.Toolbar({\n\t\t\tfrm: this,\n\t\t\tpage: this.page\n\t\t});\n\n\t\t// navigate records keyboard shortcuts\n\t\tthis.add_form_keyboard_shortcuts();\n\n\t\t// 2 column layout\n\t\tthis.setup_std_layout();\n\n\t\t// client script must be called after \"setup\" - there are no fields_dict attached to the frm otherwise\n\t\tthis.script_manager = new frappe.ui.form.ScriptManager({\n\t\t\tfrm: this\n\t\t});\n\t\tthis.script_manager.setup();\n\t\tthis.watch_model_updates();\n\n\t\tif (!this.meta.hide_toolbar && frappe.boot.desk_settings.timeline) {\n\t\t\t// this.footer_tab = new frappe.ui.form.Tab(this.layout, {\n\t\t\t// \tlabel: __(\"Activity\"),\n\t\t\t// \tfieldname: 'timeline'\n\t\t\t// });\n\n\t\t\tthis.footer = new frappe.ui.form.Footer({\n\t\t\t\tfrm: this,\n\t\t\t\tparent: $('<div>').appendTo(this.page.main.parent())\n\t\t\t});\n\t\t\t$(\"body\").attr(\"data-sidebar\", 1);\n\t\t}\n\t\tthis.setup_file_drop();\n\t\tthis.setup_doctype_actions();\n\t\tthis.setup_notify_on_rename();\n\n\t\tthis.setup_done = true;\n\t}\n\n\tadd_form_keyboard_shortcuts() {\n\t\t// Navigate to next record\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'shift+ctrl+>',\n\t\t\taction: () => this.navigate_records(0),\n\t\t\tpage: this.page,\n\t\t\tdescription: __('Go to next record'),\n\t\t\tignore_inputs: true,\n\t\t\tcondition: () => !this.is_new()\n\t\t});\n\n\t\t// Navigate to previous record\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'shift+ctrl+<',\n\t\t\taction: () => this.navigate_records(1),\n\t\t\tpage: this.page,\n\t\t\tdescription: __('Go to previous record'),\n\t\t\tignore_inputs: true,\n\t\t\tcondition: () => !this.is_new()\n\t\t});\n\n\t\t// Undo and redo\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'ctrl+z',\n\t\t\taction: () => this.undo_manager.undo(),\n\t\t\tpage: this.page,\n\t\t\tdescription: __('Undo last action'),\n\t\t});\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'shift+ctrl+z',\n\t\t\taction: () => this.undo_manager.redo(),\n\t\t\tpage: this.page,\n\t\t\tdescription: __('Redo last action'),\n\t\t});\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'ctrl+y',\n\t\t\taction: () => this.undo_manager.redo(),\n\t\t\tpage: this.page,\n\t\t\tdescription: __('Redo last action'),\n\t\t});\n\n\t\tlet grid_shortcut_keys = [\n\t\t\t{\n\t\t\t\t'shortcut': 'Up Arrow',\n\t\t\t\t'description': __('Move cursor to above row')\n\t\t\t},\n\t\t\t{\n\t\t\t\t'shortcut': 'Down Arrow',\n\t\t\t\t'description': __('Move cursor to below row')\n\t\t\t},\n\t\t\t{\n\t\t\t\t'shortcut': 'tab',\n\t\t\t\t'description': __('Move cursor to next column')\n\t\t\t},\n\t\t\t{\n\t\t\t\t'shortcut': 'shift+tab',\n\t\t\t\t'description': __('Move cursor to previous column')\n\t\t\t},\n\t\t\t{\n\t\t\t\t'shortcut': 'Ctrl+up',\n\t\t\t\t'description': __('Add a row above the current row')\n\t\t\t},\n\t\t\t{\n\t\t\t\t'shortcut': 'Ctrl+down',\n\t\t\t\t'description': __('Add a row below the current row')\n\t\t\t},\n\t\t\t{\n\t\t\t\t'shortcut': 'Ctrl+shift+up',\n\t\t\t\t'description': __('Add a row at the top')\n\t\t\t},\n\t\t\t{\n\t\t\t\t'shortcut': 'Ctrl+shift+down',\n\t\t\t\t'description': __('Add a row at the bottom')\n\t\t\t},\n\t\t\t{\n\t\t\t\t'shortcut': 'shift+alt+down',\n\t\t\t\t'description': __('To duplcate current row')\n\t\t\t}\n\t\t];\n\n\t\tgrid_shortcut_keys.forEach(row => {\n\t\t\tfrappe.ui.keys.add_shortcut({\n\t\t\t\tshortcut: row.shortcut,\n\t\t\t\tpage: this.page,\n\t\t\t\tdescription: __(row.description),\n\t\t\t\tignore_inputs: true,\n\t\t\t\tcondition: () => !this.is_new()\n\t\t\t});\n\t\t});\n\n\t}\n\n\tsetup_std_layout() {\n\t\tthis.form_wrapper = $('<div></div>').appendTo(this.layout_main);\n\t\tthis.body = $('<div class=\"std-form-layout\"></div>').appendTo(this.form_wrapper);\n\n\t\t// only tray\n\t\tthis.meta.section_style='Simple'; // always simple!\n\n\t\t// layout\n\t\tthis.layout = new frappe.ui.form.Layout({\n\t\t\tparent: this.body,\n\t\t\tdoctype: this.doctype,\n\t\t\tdoctype_layout: this.doctype_layout,\n\t\t\tfrm: this,\n\t\t\twith_dashboard: true,\n\t\t\tcard_layout: true\n\t\t});\n\n\t\tthis.layout.make();\n\n\t\tthis.fields_dict = this.layout.fields_dict;\n\t\tthis.fields = this.layout.fields_list;\n\n\t\tlet dashboard_parent = $('<div class=\"form-dashboard\">');\n\t\tlet dashboard_added = false;\n\n\t\tif (this.layout.tabs.length) {\n\t\t\tthis.layout.tabs.every(tab => {\n\t\t\t\tif (tab.df.show_dashboard) {\n\t\t\t\t\ttab.wrapper.prepend(dashboard_parent);\n\t\t\t\t\tdashboard_added = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\t\t\tif (!dashboard_added) {\n\t\t\t\tthis.layout.tabs[0].wrapper.prepend(dashboard_parent);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.layout.wrapper.find('.form-page').prepend(dashboard_parent);\n\t\t}\n\n\t\tthis.dashboard = new frappe.ui.form.Dashboard(dashboard_parent, this);\n\n\t\tthis.tour = new frappe.ui.form.FormTour({\n\t\t\tfrm: this\n\t\t});\n\n\t\t// workflow state\n\t\tthis.states = new frappe.ui.form.States({\n\t\t\tfrm: this\n\t\t});\n\t}\n\n\twatch_model_updates() {\n\t\t// watch model updates\n\t\tvar me = this;\n\n\t\t// on main doc\n\t\tfrappe.model.on(me.doctype, \"*\", function(fieldname, value, doc, skip_dirty_trigger=false) {\n\t\t\t// set input\n\t\t\tif (doc.name == me.docname) {\n\t\t\t\tif (!skip_dirty_trigger) {\n\t\t\t\t\tme.dirty();\n\t\t\t\t}\n\n\t\t\t\tlet field = me.fields_dict[fieldname];\n\t\t\t\tfield && field.refresh(fieldname);\n\n\t\t\t\t// Validate value for link field explicitly\n\t\t\t\tfield && [\"Link\", \"Dynamic Link\"].includes(field.df.fieldtype) && field.validate && field.validate(value);\n\n\t\t\t\tme.layout.refresh_dependency();\n\t\t\t\tme.layout.refresh_sections();\n\t\t\t\treturn me.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\t}\n\t\t});\n\n\t\t// on table fields\n\t\tvar table_fields = frappe.get_children(\"DocType\", me.doctype, \"fields\", {\n\t\t\tfieldtype: [\"in\", frappe.model.table_fields]\n\t\t});\n\n\t\t// using $.each to preserve df via closure\n\t\t$.each(table_fields, function(i, df) {\n\t\t\tfrappe.model.on(df.options, \"*\", function(fieldname, value, doc) {\n\t\t\t\tif (doc.parent == me.docname && doc.parentfield === df.fieldname) {\n\t\t\t\t\tme.dirty();\n\t\t\t\t\tme.fields_dict[df.fieldname].grid.set_value(fieldname, value, doc);\n\t\t\t\t\treturn me.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup_notify_on_rename() {\n\t\t$(document).on('rename', (ev, dt, old_name, new_name) => {\n\t\t\tif (dt==this.doctype)\n\t\t\t\tthis.rename_notify(dt, old_name, new_name);\n\t\t});\n\t}\n\n\tsetup_file_drop() {\n\t\tvar me = this;\n\t\tthis.$wrapper.on('dragenter dragover', false)\n\t\t\t.on('drop', function(e) {\n\t\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\n\t\t\t\tif(me.doc.__islocal) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please save before attaching.\"));\n\t\t\t\t\tthrow \"attach error\";\n\t\t\t\t}\n\n\t\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\t\tdoctype: me.doctype,\n\t\t\t\t\tdocname: me.docname,\n\t\t\t\t\tfrm: me,\n\t\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\t\tfolder: 'Home/Attachments',\n\t\t\t\t\ton_success(file_doc) {\n\t\t\t\t\t\tme.attachments.attachment_uploaded(file_doc);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tsetup_image_autocompletions_in_markdown() {\n\t\tthis.fields.map(field => {\n\t\t\tif (field.df.fieldtype === 'Markdown Editor') {\n\t\t\t\tthis.set_df_property(field.df.fieldname, 'autocompletions', () => {\n\t\t\t\t\tlet attachments = this.attachments.get_attachments();\n\t\t\t\t\treturn attachments\n\t\t\t\t\t\t.filter(file => frappe.utils.is_image_file(file.file_url))\n\t\t\t\t\t\t.map(file => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tcaption: 'image: ' + file.file_name,\n\t\t\t\t\t\t\t\tvalue: `![](${file.file_url})`,\n\t\t\t\t\t\t\t\tmeta: 'image'\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t// REFRESH\n\n\trefresh(docname) {\n\t\tvar switched = docname ? true : false;\n\n\t\tremoveEventListener(\"beforeunload\", this.beforeUnloadListener, {capture: true});\n\n\t\tif(docname) {\n\t\t\tthis.switch_doc(docname);\n\t\t}\n\n\t\tcur_frm = this;\n\n\t\tthis.undo_manager.erase_history();\n\n\t\tif(this.docname) { // document to show\n\t\t\tthis.save_disabled = false;\n\t\t\t// set the doc\n\t\t\tthis.doc = frappe.get_doc(this.doctype, this.docname);\n\n\t\t\t// check permissions\n\t\t\tif (!this.has_read_permission()) {\n\t\t\t\tfrappe.show_not_permitted(__(this.doctype) + \" \" + __(cstr(this.docname)));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// read only (workflow)\n\t\t\tthis.read_only = frappe.workflow.is_read_only(this.doctype, this.docname);\n\t\t\tif (this.read_only) this.set_read_only(true);\n\n\t\t\t// check if doctype is already open\n\t\t\tif (!this.opendocs[this.docname]) {\n\t\t\t\tthis.check_doctype_conflict(this.docname);\n\t\t\t} else {\n\t\t\t\tif (this.check_reload()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// do setup\n\t\t\tif(!this.setup_done) {\n\t\t\t\tthis.setup();\n\t\t\t}\n\n\t\t\t// load the record for the first time, if not loaded (call 'onload')\n\t\t\tthis.trigger_onload(switched);\n\n\t\t\t// if print format is shown, refresh the format\n\t\t\t// if(this.print_preview.wrapper.is(\":visible\")) {\n\t\t\t// \tthis.print_preview.preview();\n\t\t\t// }\n\n\t\t\tif(switched) {\n\t\t\t\tif(this.show_print_first && this.doc.docstatus===1) {\n\t\t\t\t\t// show print view\n\t\t\t\t\tthis.print_doc();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set status classes\n\t\t\tthis.$wrapper.removeClass('validated-form')\n\t\t\t\t.toggleClass('editable-form', this.doc.docstatus===0)\n\t\t\t\t.toggleClass('submitted-form', this.doc.docstatus===1)\n\t\t\t\t.toggleClass('cancelled-form', this.doc.docstatus===2);\n\n\t\t\tthis.show_conflict_message();\n\t\t}\n\t}\n\n\t// sets up the refresh event for custom buttons\n\t// added via configuration\n\tsetup_doctype_actions() {\n\t\tif (this.meta.actions) {\n\t\t\tfor (let action of this.meta.actions) {\n\t\t\t\tfrappe.ui.form.on(this.doctype, 'refresh', () => {\n\t\t\t\t\tif (!this.is_new()) {\n\t\t\t\t\t\tif (!action.hidden) {\n\t\t\t\t\t\t\tthis.add_custom_button(action.label, () => {\n\t\t\t\t\t\t\t\tthis.execute_action(action);\n\t\t\t\t\t\t\t}, action.group);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\texecute_action(action) {\n\t\tif (typeof action === 'string') {\n\t\t\t// called by label - maybe via custom script\n\t\t\t// frm.execute_action('Action')\n\t\t\tfor (let _action of this.meta.actions) {\n\t\t\t\tif (_action.label === action) {\n\t\t\t\t\taction = _action;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof action === 'string') {\n\t\t\t\tfrappe.throw(`Action ${action} not found`);\n\t\t\t}\n\t\t}\n\t\tif (action.action_type==='Server Action') {\n\t\t\treturn frappe.xcall(action.action, {'doc': this.doc}).then((doc) => {\n\t\t\t\tif (doc.doctype) {\n\t\t\t\t\t// document is returned by the method,\n\t\t\t\t\t// apply the changes locally and refresh\n\t\t\t\t\tfrappe.model.sync(doc);\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\n\t\t\t\t// feedback\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\tmessage: __('{} Complete', [action.label]),\n\t\t\t\t\talert: true\n\t\t\t\t});\n\t\t\t});\n\t\t} else if (action.action_type==='Route') {\n\t\t\treturn frappe.set_route(action.action);\n\t\t}\n\t}\n\n\tswitch_doc(docname) {\n\t\t// reset visible columns, since column headings can change in different docs\n\t\tthis.grids.forEach(grid_obj => {\n\t\t\tgrid_obj.grid.visible_columns = null\n\t\t\t// reset page number to 1\n\t\t\tgrid_obj.grid.grid_pagination.go_to_page(1, true);\n\t\t});\n\t\tfrappe.ui.form.close_grid_form();\n\t\tthis.viewers && this.viewers.parent.empty();\n\t\tthis.docname = docname;\n\t\tthis.setup_docinfo_change_listener();\n\t}\n\n\tcheck_reload() {\n\t\tif(this.doc && (!this.doc.__unsaved) && this.doc.__last_sync_on &&\n\t\t\t(new Date() - this.doc.__last_sync_on) > (this.refresh_if_stale_for * 1000)) {\n\t\t\tthis.reload_doc();\n\t\t\treturn true;\n\t\t}\n\t}\n\n\ttrigger_onload(switched) {\n\t\tthis.cscript.is_onload = false;\n\t\tif(!this.opendocs[this.docname]) {\n\t\t\tvar me = this;\n\t\t\tthis.cscript.is_onload = true;\n\t\t\tthis.initialize_new_doc();\n\t\t\t$(document).trigger(\"form-load\", [this]);\n\t\t\t$(this.page.wrapper).on('hide',  function() {\n\t\t\t\t$(document).trigger(\"form-unload\", [me]);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.render_form(switched);\n\t\t\tif (this.doc.localname) {\n\t\t\t\t// trigger form-rename and remove .localname\n\t\t\t\tdelete this.doc.localname;\n\t\t\t\t$(document).trigger(\"form-rename\", [this]);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitialize_new_doc() {\n\t\tvar me = this;\n\n\t\t// hide any open grid\n\t\tthis.script_manager.trigger(\"before_load\", this.doctype, this.docname)\n\t\t\t.then(() => {\n\t\t\t\tme.script_manager.trigger(\"onload\");\n\t\t\t\tme.opendocs[me.docname] = true;\n\t\t\t\tme.render_form();\n\n\t\t\t\tfrappe.after_ajax(function() {\n\t\t\t\t\tme.trigger_link_fields();\n\t\t\t\t});\n\n\t\t\t\tfrappe.breadcrumbs.add(me.meta.module, me.doctype);\n\t\t\t});\n\n\t\t// update seen\n\t\tif(this.meta.track_seen) {\n\t\t\t$('.list-id[data-name=\"'+ me.docname +'\"]').addClass('seen');\n\t\t}\n\t}\n\n\trender_form(switched) {\n\t\tif(!this.meta.istable) {\n\t\t\tthis.layout.doc = this.doc;\n\t\t\tthis.layout.attach_doc_and_docfields();\n\n\t\t\tif (frappe.boot.desk_settings.form_sidebar) {\n\t\t\t\tthis.sidebar = new frappe.ui.form.Sidebar({\n\t\t\t\t\tfrm: this,\n\t\t\t\t\tpage: this.page\n\t\t\t\t});\n\t\t\t\tthis.sidebar.make();\n\t\t\t}\n\n\t\t\t// clear layout message\n\t\t\tthis.layout.show_message();\n\n\t\t\tfrappe.run_serially([\n\t\t\t\t// header must be refreshed before client methods\n\t\t\t\t// because add_custom_button\n\t\t\t\t() => this.refresh_header(switched),\n\t\t\t\t// trigger global trigger\n\t\t\t\t// to use this\n\t\t\t\t() => $(document).trigger('form-refresh', [this]),\n\t\t\t\t// fields\n\t\t\t\t() => this.refresh_fields(),\n\t\t\t\t// call trigger\n\t\t\t\t() => this.script_manager.trigger(\"refresh\"),\n\t\t\t\t// call onload post render for callbacks to be fired\n\t\t\t\t() => {\n\t\t\t\t\tif(this.cscript.is_onload) {\n\t\t\t\t\t\tthis.onload_post_render();\n\t\t\t\t\t\treturn this.script_manager.trigger(\"onload_post_render\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t() => this.cscript.is_onload && this.is_new() && this.focus_on_first_input(),\n\t\t\t\t() => this.run_after_load_hook(),\n\t\t\t\t() => this.dashboard.after_refresh(),\n\t\t\t]);\n\n\t\t} else {\n\t\t\tthis.refresh_header(switched);\n\t\t}\n\n\t\tthis.$wrapper.trigger('render_complete');\n\n\t\tif(!this.hidden) {\n\t\t\tthis.layout.show_empty_form_message();\n\t\t}\n\n\t\tfrappe.after_ajax(() => {\n\t\t\t$(document).ready(() => {\n\t\t\t\tthis.scroll_to_element();\n\t\t\t});\n\t\t});\n\t}\n\n\tonload_post_render() {\n\t\tthis.setup_image_autocompletions_in_markdown();\n\t}\n\n\tfocus_on_first_input() {\n\t\tlet first = this.form_wrapper.find('.form-layout :input:visible:first');\n\t\tif (!in_list([\"Date\", \"Datetime\"], first.attr(\"data-fieldtype\"))) {\n\t\t\tfirst.focus();\n\t\t}\n\t}\n\n\trun_after_load_hook() {\n\t\tif (frappe.route_hooks.after_load) {\n\t\t\tlet route_callback = frappe.route_hooks.after_load;\n\t\t\tdelete frappe.route_hooks.after_load;\n\n\t\t\troute_callback(this);\n\t\t}\n\t}\n\n\trefresh_fields() {\n\t\tthis.layout.refresh(this.doc);\n\t\tthis.layout.primary_button = this.$wrapper.find(\".btn-primary\");\n\n\t\t// cleanup activities after refresh\n\t\tthis.cleanup_refresh(this);\n\t}\n\n\tcleanup_refresh() {\n\t\tif(this.fields_dict['amended_from']) {\n\t\t\tif (this.doc.amended_from) {\n\t\t\t\tunhide_field('amended_from');\n\t\t\t\tif (this.fields_dict['amendment_date']) unhide_field('amendment_date');\n\t\t\t} else {\n\t\t\t\thide_field('amended_from');\n\t\t\t\tif (this.fields_dict['amendment_date']) hide_field('amendment_date');\n\t\t\t}\n\t\t}\n\n\t\tif(this.fields_dict['trash_reason']) {\n\t\t\tif(this.doc.trash_reason && this.doc.docstatus == 2) {\n\t\t\t\tunhide_field('trash_reason');\n\t\t\t} else {\n\t\t\t\thide_field('trash_reason');\n\t\t\t}\n\t\t}\n\n\t\tif(this.meta.autoname && this.meta.autoname.substr(0,6)=='field:' && !this.doc.__islocal) {\n\t\t\tvar fn = this.meta.autoname.substr(6);\n\n\t\t\tif (this.doc[fn]) {\n\t\t\t\tthis.toggle_display(fn, false);\n\t\t\t}\n\t\t}\n\n\t\tif(this.meta.autoname==\"naming_series:\" && !this.doc.__islocal) {\n\t\t\tthis.toggle_display(\"naming_series\", false);\n\t\t}\n\t}\n\n\trefresh_header(switched) {\n\t\t// set title\n\t\t// main title\n\t\tif(!this.meta.in_dialog || this.in_form) {\n\t\t\tfrappe.utils.set_title(this.meta.issingle ? this.doctype : this.docname);\n\t\t}\n\n\t\t// show / hide buttons\n\t\tif(this.toolbar) {\n\t\t\tif (switched) {\n\t\t\t\tthis.toolbar.current_status = undefined;\n\t\t\t}\n\t\t\tthis.toolbar.refresh();\n\t\t}\n\n\t\tthis.dashboard.refresh();\n\t\tfrappe.breadcrumbs.update();\n\n\t\tthis.show_submit_message();\n\t\tthis.clear_custom_buttons();\n\t\tthis.show_web_link();\n\t}\n\n\t// SAVE\n\n\tsave_or_update() {\n\t\tif(this.save_disabled) return;\n\n\t\tif(this.doc.docstatus===0) {\n\t\t\tthis.save();\n\t\t} else if(this.doc.docstatus===1 && this.doc.__unsaved) {\n\t\t\tthis.save(\"Update\");\n\t\t}\n\t}\n\n\tsave(save_action, callback, btn, on_error) {\n\t\tlet me = this;\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tbtn && $(btn).prop(\"disabled\", true);\n\t\t\tfrappe.ui.form.close_grid_form();\n\t\t\tme.validate_and_save(save_action, callback, btn, on_error, resolve, reject);\n\t\t}).then(() => {\n\t\t\tme.show_success_action();\n\t\t}).catch((e) => {\n\t\t\tconsole.error(e); // eslint-disable-line\n\t\t});\n\t}\n\n\tvalidate_and_save(save_action, callback, btn, on_error, resolve, reject) {\n\t\tvar me = this;\n\t\tif(!save_action) save_action = \"Save\";\n\t\tthis.validate_form_action(save_action, resolve);\n\n\t\tvar after_save = function(r) {\n\t\t\t// to remove hash from URL to avoid scroll after save\n\t\t\thistory.replaceState(null, null, ' ');\n\t\t\tif(!r.exc) {\n\t\t\t\tif ([\"Save\", \"Update\", \"Amend\"].indexOf(save_action)!==-1) {\n\t\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t\t}\n\n\t\t\t\tme.script_manager.trigger(\"after_save\");\n\n\t\t\t\tif (frappe.route_hooks.after_save) {\n\t\t\t\t\tlet route_callback = frappe.route_hooks.after_save;\n\t\t\t\t\tdelete frappe.route_hooks.after_save;\n\n\t\t\t\t\troute_callback(me);\n\t\t\t\t}\n\t\t\t\t// submit comment if entered\n\t\t\t\tif (me.comment_box) {\n\t\t\t\t\tme.comment_box.submit();\n\t\t\t\t}\n\t\t\t\tme.refresh();\n\t\t\t} else {\n\t\t\t\tif(on_error) {\n\t\t\t\t\ton_error();\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t}\n\t\t\tcallback && callback(r);\n\t\t\tresolve();\n\t\t};\n\n\t\tvar fail = (e) => {\n\t\t\tif (e) {\n\t\t\t\tconsole.error(e)\n\t\t\t}\n\t\t\tbtn && $(btn).prop(\"disabled\", false);\n\t\t\tif(on_error) {\n\t\t\t\ton_error();\n\t\t\t\treject();\n\t\t\t}\n\t\t};\n\n\t\tif(save_action != \"Update\") {\n\t\t\t// validate\n\t\t\tfrappe.validated = true;\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.script_manager.trigger(\"validate\"),\n\t\t\t\t() => this.script_manager.trigger(\"before_save\"),\n\t\t\t\t() => {\n\t\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\t\tfail();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t\t\t\t}\n\t\t\t]).catch(fail);\n\t\t} else {\n\t\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t\t}\n\t}\n\n\tsavesubmit(btn, callback, on_error) {\n\t\tvar me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tthis.validate_form_action(\"Submit\");\n\t\t\tfrappe.confirm(__(\"Permanently Submit {0}?\", [this.docname]), function() {\n\t\t\t\tfrappe.validated = true;\n\t\t\t\tme.script_manager.trigger(\"before_submit\").then(function() {\n\t\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\t\treturn me.handle_save_fail(btn, on_error);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.save('Submit', function(r) {\n\t\t\t\t\t\tif(r.exc) {\n\t\t\t\t\t\t\tme.handle_save_fail(btn, on_error);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\t\tcallback && callback();\n\t\t\t\t\t\t\tme.script_manager.trigger(\"on_submit\")\n\t\t\t\t\t\t\t\t.then(() => resolve(me))\n\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\tif (frappe.route_hooks.after_submit) {\n\t\t\t\t\t\t\t\t\t\tlet route_callback = frappe.route_hooks.after_submit;\n\t\t\t\t\t\t\t\t\t\tdelete frappe.route_hooks.after_submit;\n\t\t\t\t\t\t\t\t\t\troute_callback(me);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}, btn, () => me.handle_save_fail(btn, on_error), resolve);\n\t\t\t\t});\n\t\t\t}, () => me.handle_save_fail(btn, on_error) );\n\t\t});\n\t}\n\n\tsavecancel(btn, callback, on_error) {\n\t\tconst me = this;\n\t\tthis.validate_form_action('Cancel');\n\t\tme.ignore_doctypes_on_cancel_all = me.ignore_doctypes_on_cancel_all || [];\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.desk.form.linked_with.get_submitted_linked_docs\",\n\t\t\targs: {\n\t\t\t\tdoctype: me.doc.doctype,\n\t\t\t\tname: me.doc.name\n\t\t\t},\n\t\t\tfreeze: true\n\t\t}).then(r => {\n\t\t\tif (!r.exc) {\n\t\t\t\tlet doctypes_to_cancel = (r.message.docs || []).map(value => {\n\t\t\t\t\treturn value.doctype;\n\t\t\t\t}).filter(value => {\n\t\t\t\t\treturn !me.ignore_doctypes_on_cancel_all.includes(value);\n\t\t\t\t});\n\n\t\t\t\tif (doctypes_to_cancel.length) {\n\t\t\t\t\treturn me._cancel_all(r, btn, callback, on_error);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn me._cancel(btn, callback, on_error, false);\n\t\t}\n\t\t);\n\t}\n\n\t_cancel_all(r, btn, callback, on_error) {\n\t\tconst me = this;\n\n\t\t// add confirmation message for cancelling all linked docs\n\t\tlet links_text = \"\";\n\t\tlet links = r.message.docs;\n\t\tconst doctypes = Array.from(new Set(links.map(link => link.doctype)));\n\n\t\tme.ignore_doctypes_on_cancel_all = me.ignore_doctypes_on_cancel_all || [];\n\n\t\tfor (let doctype of doctypes) {\n\t\t\tif (!me.ignore_doctypes_on_cancel_all.includes(doctype)) {\n\t\t\t\tlet docnames = links\n\t\t\t\t\t.filter((link) => link.doctype == doctype)\n\t\t\t\t\t.map((link) => frappe.utils.get_form_link(link.doctype, link.name, true))\n\t\t\t\t\t.join(\", \");\n\t\t\t\tlinks_text += `<li><strong>${doctype}</strong>: ${docnames}</li>`;\n\t\t\t}\n\t\t}\n\t\tlinks_text = `<ul>${links_text}</ul>`;\n\n\t\tlet confirm_message = __('{0} {1} is linked with the following submitted documents: {2}',\n\t\t\t[(me.doc.doctype).bold(), me.doc.name, links_text]);\n\n\t\tlet can_cancel = links.every((link) => frappe.model.can_cancel(link.doctype));\n\t\tif (can_cancel) {\n\t\t\tconfirm_message += __('Do you want to cancel all linked documents?');\n\t\t} else {\n\t\t\tconfirm_message += __('You do not have permissions to cancel all linked documents.');\n\t\t}\n\n\t\t// generate dialog box to cancel all linked docs\n\t\tlet d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Cancel All Documents\"),\n\t\t\tfields: [{\n\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\toptions: `<p class=\"frappe-confirm-message\">${confirm_message}</p>`\n\t\t\t}]\n\t\t}, () => me.handle_save_fail(btn, on_error));\n\n\t\t// if user can cancel all linked docs, add action to the dialog\n\t\tif (can_cancel) {\n\t\t\td.set_primary_action(\"Cancel All\", () => {\n\t\t\t\td.hide();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.desk.form.linked_with.cancel_all_linked_docs\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdocs: links,\n\t\t\t\t\t\tignore_doctypes_on_cancel_all: me.ignore_doctypes_on_cancel_all || []\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tcallback: (resp) => {\n\t\t\t\t\t\tif (!resp.exc) {\n\t\t\t\t\t\t\tme.reload_doc();\n\t\t\t\t\t\t\tme._cancel(btn, callback, on_error, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\td.show();\n\t}\n\n\t_cancel(btn, callback, on_error, skip_confirm) {\n\t\tconst me = this;\n\t\tconst cancel_doc = () => {\n\t\t\tfrappe.validated = true;\n\t\t\tme.script_manager.trigger(\"before_cancel\").then(() => {\n\t\t\t\tif (!frappe.validated) {\n\t\t\t\t\treturn me.handle_save_fail(btn, on_error);\n\t\t\t\t}\n\n\t\t\t\tvar after_cancel = function(r) {\n\t\t\t\t\tif (r.exc) {\n\t\t\t\t\t\tme.handle_save_fail(btn, on_error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t\tcallback && callback();\n\t\t\t\t\t\tme.script_manager.trigger(\"after_cancel\");\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tfrappe.ui.form.save(me, \"cancel\", after_cancel, btn);\n\t\t\t});\n\t\t}\n\n\t\tif (skip_confirm) {\n\t\t\tcancel_doc();\n\t\t} else {\n\t\t\tfrappe.confirm(__(\"Permanently Cancel {0}?\", [this.docname]), cancel_doc, me.handle_save_fail(btn, on_error));\n\t\t}\n\t}\n\n\tsavetrash() {\n\t\tthis.validate_form_action(\"Delete\");\n\t\tfrappe.model.delete_doc(this.doctype, this.docname, function() {\n\t\t\twindow.history.back();\n\t\t});\n\t}\n\n\tamend_doc() {\n\t\tif (!this.fields_dict['amended_from']) {\n\t\t\tfrappe.msgprint(__('\"amended_from\" field must be present to do an amendment.'));\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.xcall('frappe.client.is_document_amended', {\n\t\t\t'doctype': this.doc.doctype,\n\t\t\t'docname': this.doc.name\n\t\t}).then(is_amended => {\n\t\t\tif (is_amended) {\n\t\t\t\tfrappe.throw(__('This document is already amended, you cannot ammend it again'));\n\t\t\t}\n\t\t\tthis.validate_form_action(\"Amend\");\n\t\t\tvar me = this;\n\t\t\tvar fn = function(newdoc) {\n\t\t\t\tnewdoc.amended_from = me.docname;\n\t\t\t\tif (me.fields_dict && me.fields_dict['amendment_date'])\n\t\t\t\t\tnewdoc.amendment_date = frappe.datetime.obj_to_str(new Date());\n\t\t\t};\n\t\t\tthis.copy_doc(fn, 1);\n\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t});\n\t}\n\n\tvalidate_form_action(action, resolve) {\n\t\tvar perm_to_check = this.action_perm_type_map[action];\n\t\tvar allowed_for_workflow = false;\n\t\tvar perms = frappe.perm.get_perm(this.doc.doctype)[0];\n\n\t\t// Allow submit, write, cancel and create permissions for read only documents that are assigned by\n\t\t// workflows if the user already have those permissions. This is to allow for users to\n\t\t// continue through the workflow states and to allow execution of functions like Duplicate.\n\t\tif ((frappe.workflow.is_read_only(this.doctype, this.docname) && (perms[\"write\"] ||\n\t\t\tperms[\"create\"] || perms[\"submit\"] || perms[\"cancel\"])) || !frappe.workflow.is_read_only(this.doctype, this.docname)) {\n\t\t\tallowed_for_workflow = true;\n\t\t}\n\n\t\tif (!this.perm[0][perm_to_check] && !allowed_for_workflow) {\n\t\t\tif(resolve) {\n\t\t\t\t// re-enable buttons\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tfrappe.throw(\n\t\t\t\t__(\"No permission to '{0}' {1}\", [__(action), __(this.doc.doctype)], \"{0} = verb, {1} = object\")\n\t\t\t);\n\t\t}\n\t}\n\n\t// HELPERS\n\n\tenable_save() {\n\t\tthis.save_disabled = false;\n\t\tthis.toolbar.set_primary_action();\n\t}\n\n\tdisable_save(set_dirty=false) {\n\t\t// IMPORTANT: this function should be called in refresh event\n\t\tthis.save_disabled = true;\n\t\tthis.toolbar.current_status = null;\n\t\t// field changes should make form dirty\n\t\tthis.set_dirty = set_dirty;\n\t\tthis.page.clear_primary_action();\n\t}\n\n\tdisable_form() {\n\t\tthis.set_read_only();\n\t\tthis.fields\n\t\t\t.forEach((field) => {\n\t\t\t\tthis.set_df_property(field.df.fieldname, \"read_only\", \"1\");\n\t\t\t});\n\t\tthis.disable_save();\n\t}\n\n\thandle_save_fail(btn, on_error) {\n\t\t$(btn).prop('disabled', false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t}\n\n\ttrigger_link_fields() {\n\t\t// trigger link fields which have default values set\n\t\tif (this.is_new() && this.doc.__run_link_triggers) {\n\t\t\t$.each(this.fields_dict, function(fieldname, field) {\n\t\t\t\tif (field.df.fieldtype==\"Link\" && this.doc[fieldname]) {\n\t\t\t\t\t// triggers add fetch, sets value in model and runs triggers\n\t\t\t\t\tfield.set_value(this.doc[fieldname], true);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete this.doc.__run_link_triggers;\n\t\t}\n\t}\n\n\tshow_conflict_message() {\n\t\tif(this.doc.__needs_refresh) {\n\t\t\tif(this.doc.__unsaved) {\n\t\t\t\tthis.dashboard.clear_headline();\n\t\t\t\tthis.dashboard.set_headline_alert(__(\"This form has been modified after you have loaded it\")\n\t\t\t\t\t+ '<button class=\"btn btn-xs btn-primary pull-right\" onclick=\"cur_frm.reload_doc()\">'\n\t\t\t\t\t+ __(\"Refresh\") + '</button>', \"alert-warning\");\n\t\t\t} else {\n\t\t\t\tthis.reload_doc();\n\t\t\t}\n\t\t}\n\t}\n\n\tshow_submit_message() {\n\t\tif(this.meta.is_submittable\n\t\t\t&& this.perm[0] && this.perm[0].submit\n\t\t\t&& !this.is_dirty()\n\t\t\t&& !this.is_new()\n\t\t\t&& !frappe.model.has_workflow(this.doctype) // show only if no workflow\n\t\t\t&& this.doc.docstatus===0) {\n\t\t\tthis.dashboard.add_comment(__('Submit this document to confirm'), 'blue', true);\n\t\t}\n\t}\n\n\tshow_web_link() {\n\t\tif(!this.doc.__islocal && this.doc.__onload && this.doc.__onload.is_website_generator) {\n\t\t\tthis.web_link && this.web_link.remove();\n\t\t\tif(this.doc.__onload.published) {\n\t\t\t\tthis.add_web_link(\"/\" + this.doc.route);\n\t\t\t}\n\t\t}\n\t}\n\n\tadd_web_link(path, label) {\n\t\tlabel = __(label) || __(\"See on Website\");\n\t\tthis.web_link = this.sidebar.add_user_action(__(label),\n\t\t\tfunction() {}).attr(\"href\", path || this.doc.route).attr(\"target\", \"_blank\");\n\t}\n\n\thas_read_permission() {\n\t\t// get perm\n\t\tvar dt = this.parent_doctype ? this.parent_doctype : this.doctype;\n\t\tthis.perm = frappe.perm.get_perm(dt, this.doc);\n\n\t\tif(!this.perm[0].read) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn 1;\n\t}\n\n\tcheck_doctype_conflict(docname) {\n\t\tif(this.doctype=='DocType' && docname=='DocType') {\n\t\t\tfrappe.msgprint(__('Allowing DocType, DocType. Be careful!'));\n\t\t} else if(this.doctype=='DocType') {\n\t\t\tif (frappe.views.formview[docname] || frappe.pages['List/'+docname]) {\n\t\t\t\twindow.location.reload();\n\t\t\t\t//\tfrappe.msgprint(__(\"Cannot open {0} when its instance is open\", ['DocType']))\n\t\t\t\t// throw 'doctype open conflict'\n\t\t\t}\n\t\t} else {\n\t\t\tif (frappe.views.formview.DocType && frappe.views.formview.DocType.frm.opendocs[this.doctype]) {\n\t\t\t\twindow.location.reload();\n\t\t\t\t//\tfrappe.msgprint(__(\"Cannot open instance when its {0} is open\", ['DocType']))\n\t\t\t\t// throw 'doctype open conflict'\n\t\t\t}\n\t\t}\n\t}\n\n\t// rename the form\n\t// notify this form of renamed records\n\trename_notify(dt, old, name) {\n\t\t// from form\n\t\tif(this.meta.istable)\n\t\t\treturn;\n\n\t\tif(this.docname == old)\n\t\t\tthis.docname = name;\n\t\telse\n\t\t\treturn;\n\n\t\t// cleanup\n\t\tif(this && this.opendocs[old] && frappe.meta.docfield_copy[dt]) {\n\t\t\t// delete docfield copy\n\t\t\tfrappe.meta.docfield_copy[dt][name] = frappe.meta.docfield_copy[dt][old];\n\t\t\tdelete frappe.meta.docfield_copy[dt][old];\n\t\t}\n\n\t\tdelete this.opendocs[old];\n\t\tthis.opendocs[name] = true;\n\n\t\tif(this.meta.in_dialog || !this.in_form) {\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.re_route[frappe.router.get_sub_path()] = `${encodeURIComponent(frappe.router.slug(this.doctype))}/${encodeURIComponent(name)}`;\n\t\t!frappe._from_link && frappe.set_route('Form', this.doctype, name);\n\t}\n\n\t// ACTIONS\n\n\tprint_doc() {\n\t\tfrappe.route_options = {\n\t\t\tfrm: this,\n\t\t};\n\t\tfrappe.set_route('print', this.doctype, this.doc.name);\n\t}\n\n\tnavigate_records(prev) {\n\t\tlet filters, sort_field, sort_order;\n\t\tlet list_view = frappe.get_list_view(this.doctype);\n\t\tif (list_view) {\n\t\t\tfilters = list_view.get_filters_for_args();\n\t\t\tsort_field = list_view.sort_by;\n\t\t\tsort_order = list_view.sort_order;\n\t\t} else {\n\t\t\tlet list_settings = frappe.get_user_settings(this.doctype)['List'];\n\t\t\tif (list_settings) {\n\t\t\t\tfilters = list_settings.filters;\n\t\t\t\tsort_field = list_settings.sort_by;\n\t\t\t\tsort_order = list_settings.sort_order;\n\t\t\t}\n\t\t}\n\n\t\tlet args = {\n\t\t\tdoctype: this.doctype,\n\t\t\tvalue: this.docname,\n\t\t\tfilters,\n\t\t\tsort_order,\n\t\t\tsort_field,\n\t\t\tprev,\n\t\t};\n\n\t\tfrappe.call('frappe.desk.form.utils.get_next', args).then(r => {\n\t\t\tif (r.message) {\n\t\t\t\tfrappe.set_route('Form', this.doctype, r.message);\n\t\t\t\tthis.focus_on_first_input();\n\t\t\t}\n\t\t});\n\t}\n\n\trename_doc() {\n\t\tfrappe.model.rename_doc(this.doctype, this.docname, () => this.refresh_header());\n\t}\n\n\tshare_doc() {\n\t\tthis.shared.show();\n\t}\n\n\temail_doc(message) {\n\t\tnew frappe.views.CommunicationComposer({\n\t\t\tdoc: this.doc,\n\t\t\tfrm: this,\n\t\t\tsubject: __(this.meta.name) + ': ' + this.docname,\n\t\t\trecipients: this.doc.email || this.doc.email_id || this.doc.contact_email,\n\t\t\tattach_document_print: true,\n\t\t\tmessage: message\n\t\t});\n\t}\n\n\tcopy_doc(onload, from_amend) {\n\t\tthis.validate_form_action(\"Create\");\n\t\tvar newdoc = frappe.model.copy_doc(this.doc, from_amend);\n\n\t\tnewdoc.idx = null;\n\t\tnewdoc.__run_link_triggers = false;\n\t\tif(onload) {\n\t\t\tonload(newdoc);\n\t\t}\n\t\tfrappe.set_route('Form', newdoc.doctype, newdoc.name);\n\t}\n\n\treload_doc() {\n\t\tthis.check_doctype_conflict(this.docname);\n\n\t\tif(!this.doc.__islocal) {\n\t\t\tfrappe.model.remove_from_locals(this.doctype, this.docname);\n\t\t\treturn frappe.model.with_doc(this.doctype, this.docname, () => {\n\t\t\t\tthis.refresh();\n\t\t\t});\n\t\t}\n\t}\n\n\trefresh_field(fname) {\n\t\tif (this.fields_dict[fname] && this.fields_dict[fname].refresh) {\n\t\t\tthis.fields_dict[fname].refresh();\n\t\t\tthis.layout.refresh_dependency();\n\t\t\tthis.layout.refresh_sections();\n\t\t}\n\t}\n\n\t// UTILITIES\n\tadd_fetch(link_field, source_field, target_field, target_doctype) {\n\t\t/*\n\t\tExample fetch dict to get sender_email from email_id field in sender:\n\t\t\t{\n\t\t\t\t\"Notification\": {\n\t\t\t\t\t\"sender\": {\n\t\t\t\t\t\t\"sender_email\": \"email_id\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t*/\n\n\t\tif (!target_doctype) target_doctype = \"*\";\n\n\t\t// Target field kept as key because source field could be non-unique\n\t\tthis.fetch_dict\n\t\t\t.setDefault(target_doctype, {})\n\t\t\t.setDefault(link_field, {})[target_field] = source_field;\n\t}\n\n\thas_perm(ptype) {\n\t\treturn frappe.perm.has_perm(this.doctype, 0, ptype, this.doc);\n\t}\n\n\tdirty() {\n\t\tthis.doc.__unsaved = 1;\n\t\tthis.$wrapper.trigger('dirty');\n\t\tif (!frappe.boot.developer_mode) {\n\t\t\taddEventListener(\"beforeunload\", this.beforeUnloadListener, {capture: true});\n\t\t}\n\t}\n\n\tget_docinfo() {\n\t\treturn frappe.model.docinfo[this.doctype][this.docname];\n\t}\n\n\tis_dirty() {\n\t\treturn !!this.doc.__unsaved;\n\t}\n\n\tis_new() {\n\t\treturn this.doc.__islocal;\n\t}\n\n\tget_perm(permlevel, access_type) {\n\t\treturn this.perm[permlevel] ? this.perm[permlevel][access_type] : null;\n\t}\n\n\tset_intro(txt, color) {\n\t\tthis.dashboard.set_headline_alert(txt, color);\n\t}\n\n\tset_footnote(txt) {\n\t\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.body, txt);\n\t}\n\n\tadd_custom_button(label, fn, group) {\n\t\t// temp! old parameter used to be icon\n\t\tif (group && group.indexOf(\"fa fa-\") !== -1)\n\t\t\tgroup = null;\n\n\t\tlet btn = this.page.add_inner_button(label, fn, group);\n\n\t\tif (btn) {\n\t\t\t// Add actions as menu item in Mobile View\n\t\t\tlet menu_item_label = group ? `${group} > ${label}` : label;\n\t\t\tlet menu_item = this.page.add_menu_item(menu_item_label, fn, false);\n\t\t\tmenu_item.parent().addClass(\"hidden-xl\");\n\n\t\t\tthis.custom_buttons[label] = btn;\n\t\t}\n\t\treturn btn;\n\t}\n\n\tchange_custom_button_type(label, group, type) {\n\t\tthis.page.change_inner_button_type(label, group, type);\n\t}\n\n\tclear_custom_buttons() {\n\t\tthis.page.clear_inner_toolbar();\n\t\tthis.page.clear_user_actions();\n\t\tthis.custom_buttons = {};\n\t}\n\n\t//Remove specific custom button by button Label\n\tremove_custom_button(label, group) {\n\t\tthis.page.remove_inner_button(label, group);\n\t}\n\n\tscroll_to_element() {\n\t\tif (frappe.route_options && frappe.route_options.scroll_to) {\n\t\t\tvar scroll_to = frappe.route_options.scroll_to;\n\t\t\tdelete frappe.route_options.scroll_to;\n\n\t\t\tvar selector = [];\n\t\t\tfor (var key in scroll_to) {\n\t\t\t\tvar value = scroll_to[key];\n\t\t\t\tselector.push(repl('[data-%(key)s=\"%(value)s\"]', {key: key, value: value}));\n\t\t\t}\n\n\t\t\tselector = $(selector.join(\" \"));\n\t\t\tif (selector.length) {\n\t\t\t\tfrappe.utils.scroll_to(selector);\n\t\t\t}\n\t\t} else if (window.location.hash && $(window.location.hash).length) {\n\t\t\tfrappe.utils.scroll_to(window.location.hash, true, 200, null, null, true);\n\t\t}\n\t}\n\n\tshow_success_action() {\n\t\tconst route = frappe.get_route();\n\t\tif (route[0] !== 'Form') return;\n\t\tif (this.meta.is_submittable && this.doc.docstatus !== 1) return;\n\n\t\tconst success_action = new frappe.ui.form.SuccessAction(this);\n\t\tsuccess_action.show();\n\t}\n\n\tget_doc() {\n\t\treturn locals[this.doctype][this.docname];\n\t}\n\n\tset_currency_labels(fields_list, currency, parentfield) {\n\t\t// To set the currency in the label\n\t\t// For example Total Cost(INR), Total Cost(USD)\n\t\tif (!currency) return;\n\t\tvar me = this;\n\t\tvar doctype = parentfield ? this.fields_dict[parentfield].grid.doctype : this.doc.doctype;\n\t\tvar field_label_map = {};\n\t\tvar grid_field_label_map = {};\n\n\t\t$.each(fields_list, function(i, fname) {\n\t\t\tvar docfield = frappe.meta.docfield_map[doctype][fname];\n\t\t\tif(docfield) {\n\t\t\t\tvar label = __(docfield.label || \"\").replace(/\\([^\\)]*\\)/g, \"\"); // eslint-disable-line\n\t\t\t\tif(parentfield) {\n\t\t\t\t\tgrid_field_label_map[doctype + \"-\" + fname] =\n\t\t\t\t\t\tlabel.trim() + \" (\" + __(currency) + \")\";\n\t\t\t\t} else {\n\t\t\t\t\tfield_label_map[fname] = label.trim() + \" (\" + currency + \")\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$.each(field_label_map, function(fname, label) {\n\t\t\tme.fields_dict[fname].set_label(label);\n\t\t});\n\n\t\t$.each(grid_field_label_map, function(fname, label) {\n\t\t\tfname = fname.split(\"-\");\n\t\t\tme.fields_dict[parentfield].grid.update_docfield_property(fname[1], 'label', label);\n\t\t});\n\t}\n\n\tfield_map(fnames, fn) {\n\t\tif(typeof fnames==='string') {\n\t\t\tif(fnames == '*') {\n\t\t\t\tfnames = Object.keys(this.fields_dict);\n\t\t\t} else {\n\t\t\t\tfnames = [fnames];\n\t\t\t}\n\t\t}\n\t\tfor (var i=0, l=fnames.length; i<l; i++) {\n\t\t\tvar fieldname = fnames[i];\n\t\t\tvar field = frappe.meta.get_docfield(this.doctype, fieldname, this.docname);\n\t\t\tif(field) {\n\t\t\t\tfn(field);\n\t\t\t\tthis.refresh_field(fieldname);\n\t\t\t}\n\t\t}\n\t}\n\n\tget_docfield(fieldname1, fieldname2) {\n\t\tif(fieldname2) {\n\t\t\t// for child\n\t\t\tvar doctype = this.get_docfield(fieldname1).options;\n\t\t\treturn frappe.meta.get_docfield(doctype, fieldname2, this.docname);\n\t\t} else {\n\t\t\t// for parent\n\t\t\treturn frappe.meta.get_docfield(this.doctype, fieldname1, this.docname);\n\t\t}\n\t}\n\n\tset_df_property(fieldname, property, value, docname, table_field, table_row_name=null) {\n\t\tlet df;\n\n\t\tif (!docname || !table_field) {\n\t\t\tdf = this.get_docfield(fieldname);\n\t\t} else {\n\t\t\tconst grid = this.fields_dict[fieldname].grid;\n\t\t\tconst filtered_fields = frappe.utils.filter_dict(grid.docfields, {'fieldname': table_field});\n\t\t\tif (filtered_fields.length) {\n\t\t\t\tdf = frappe.meta.get_docfield(filtered_fields[0].parent, table_field, table_row_name);\n\t\t\t}\n\t\t}\n\n\t\tif (df && df[property] != value) {\n\t\t\tdf[property] = value;\n\n\t\t\tif (table_field && table_row_name) {\n\t\t\t\tif (this.fields_dict[fieldname].grid.grid_rows_by_docname[table_row_name]) {\n\t\t\t\t\tthis.fields_dict[fieldname].grid.grid_rows_by_docname[table_row_name].refresh_field(fieldname);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.refresh_field(fieldname);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggle_enable(fnames, enable) {\n\t\tthis.field_map(fnames, function(field) {\n\t\t\tfield.read_only = enable ? 0 : 1;\n\t\t});\n\t}\n\n\ttoggle_reqd(fnames, mandatory) {\n\t\tthis.field_map(fnames, function(field) {\n\t\t\tfield.reqd = mandatory ? true : false;\n\t\t});\n\t}\n\n\ttoggle_display(fnames, show) {\n\t\tthis.field_map(fnames, function(field) {\n\t\t\tfield.hidden = show ? 0 : 1;\n\t\t});\n\t}\n\n\tget_files() {\n\t\treturn this.attachments\n\t\t\t? frappe.utils.sort(this.attachments.get_attachments(), \"file_name\", \"string\")\n\t\t\t: [] ;\n\t}\n\n\tset_query(fieldname, opt1, opt2) {\n\t\tif(opt2) {\n\t\t\t// on child table\n\t\t\t// set_query(fieldname, parent fieldname, query)\n\t\t\tthis.fields_dict[opt1].grid.get_field(fieldname).get_query = opt2;\n\t\t} else {\n\t\t\t// on parent table\n\t\t\t// set_query(fieldname, query)\n\t\t\tif(this.fields_dict[fieldname]) {\n\t\t\t\tthis.fields_dict[fieldname].get_query = opt1;\n\t\t\t}\n\t\t}\n\t}\n\n\tclear_table(fieldname) {\n\t\tfrappe.model.clear_table(this.doc, fieldname);\n\t}\n\n\tadd_child(fieldname, values) {\n\t\tvar doc = frappe.model.add_child(this.doc, frappe.meta.get_docfield(this.doctype, fieldname).options, fieldname);\n\t\tif(values) {\n\t\t\t// Values of unique keys should not be overridden\n\t\t\tvar d = {};\n\t\t\tvar unique_keys = [\"idx\", \"name\"];\n\n\t\t\tObject.keys(values).map((key) => {\n\t\t\t\tif(!unique_keys.includes(key)) {\n\t\t\t\t\td[key] = values[key];\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.extend(doc, d);\n\t\t}\n\t\treturn doc;\n\t}\n\n\tset_value(field, value, if_missing, skip_dirty_trigger=false) {\n\t\tvar me = this;\n\t\tvar _set = function(f, v) {\n\t\t\tvar fieldobj = me.fields_dict[f];\n\t\t\tif(fieldobj) {\n\t\t\t\tif(!if_missing || !frappe.model.has_value(me.doctype, me.doc.name, f)) {\n\t\t\t\t\tif(frappe.model.table_fields.includes(fieldobj.df.fieldtype) && $.isArray(v)) {\n\t\t\t\t\t\t// set entire child table from specified array as value\n\t\t\t\t\t\tfrappe.model.clear_table(me.doc, fieldobj.df.fieldname);\n\n\t\t\t\t\t\tconst standard_fields = [...frappe.model.std_fields_list, ...frappe.model.child_table_field_list];\n\t\t\t\t\t\tv.forEach((d, idx) => {\n\t\t\t\t\t\t\tlet child = frappe.model.add_child(me.doc, fieldobj.df.options,\n\t\t\t\t\t\t\t\tfieldobj.df.fieldname, idx+1);\n\n\t\t\t\t\t\t\t// Don't set standard field, avoid mutating input too.\n\t\t\t\t\t\t\tlet doc_copy = {...d};\n\t\t\t\t\t\t\tstandard_fields.forEach(field => {\n\t\t\t\t\t\t\t\tdelete doc_copy[field];\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$.extend(child, doc_copy);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tme.refresh_field(f);\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn frappe.model.set_value(me.doctype, me.doc.name, f, v, me.fieldtype, skip_dirty_trigger);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfrappe.msgprint(__(\"Field {0} not found.\",[f]));\n\t\t\t\tthrow \"frm.set_value\";\n\t\t\t}\n\t\t};\n\n\t\tif(typeof field==\"string\") {\n\t\t\treturn _set(field, value);\n\t\t} else if($.isPlainObject(field)) {\n\t\t\tlet tasks = [];\n\t\t\tfor (let f in field) {\n\t\t\t\tlet v = field[f];\n\t\t\t\tif(me.get_field(f)) {\n\t\t\t\t\ttasks.push(() => _set(f, v));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn frappe.run_serially(tasks);\n\t\t}\n\t}\n\n\tcall(opts, args, callback) {\n\t\tvar me = this;\n\t\tif(typeof opts==='string') {\n\t\t\t// called as frm.call('do_this', {with_arg: 'arg'});\n\t\t\topts = {\n\t\t\t\tmethod: opts,\n\t\t\t\tdoc: this.doc,\n\t\t\t\targs: args,\n\t\t\t\tcallback: callback\n\t\t\t};\n\t\t}\n\t\tif(!opts.doc) {\n\t\t\tif(opts.method.indexOf(\".\")===-1)\n\t\t\t\topts.method = frappe.model.get_server_module_name(me.doctype) + \".\" + opts.method;\n\t\t\topts.original_callback = opts.callback;\n\t\t\topts.callback = function(r) {\n\t\t\t\tif($.isPlainObject(r.message)) {\n\t\t\t\t\tif(opts.child) {\n\t\t\t\t\t\t// update child doc\n\t\t\t\t\t\topts.child = locals[opts.child.doctype][opts.child.name];\n\n\t\t\t\t\t\tvar std_field_list = [\"doctype\"]\n\t\t\t\t\t\t\t.concat(frappe.model.std_fields_list)\n\t\t\t\t\t\t\t.concat(frappe.model.child_table_field_list);\n\t\t\t\t\t\tfor (var key in r.message) {\n\t\t\t\t\t\t\tif (std_field_list.indexOf(key)===-1) {\n\t\t\t\t\t\t\t\topts.child[key] = r.message[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.fields_dict[opts.child.parentfield].refresh();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// update parent doc\n\t\t\t\t\t\tme.set_value(r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\topts.original_callback && opts.original_callback(r);\n\t\t\t};\n\t\t} else {\n\t\t\topts.original_callback = opts.callback;\n\t\t\topts.callback = function(r) {\n\t\t\t\tif(!r.exc) me.refresh_fields();\n\n\t\t\t\topts.original_callback && opts.original_callback(r);\n\t\t\t};\n\n\t\t}\n\t\treturn frappe.call(opts);\n\t}\n\n\tget_field(field) {\n\t\treturn this.fields_dict[field];\n\t}\n\n\tset_read_only() {\n\t\tconst docperms = frappe.perm.get_perm(this.doc.doctype);\n\t\tthis.perm = docperms.map(p => {\n\t\t\treturn {\n\t\t\t\tread: p.read,\n\t\t\t\tcancel: p.cancel,\n\t\t\t\tshare: p.share,\n\t\t\t\tprint: p.print,\n\t\t\t\temail: p.email\n\t\t\t};\n\t\t});\n\t}\n\n\ttrigger(event, doctype, docname) {\n\t\treturn this.script_manager.trigger(event, doctype, docname);\n\t}\n\n\tget_formatted(fieldname) {\n\t\treturn frappe.format(this.doc[fieldname],\n\t\t\tfrappe.meta.get_docfield(this.doctype, fieldname, this.docname),\n\t\t\t{no_icon:true}, this.doc);\n\t}\n\n\topen_grid_row() {\n\t\treturn frappe.ui.form.get_open_grid_form();\n\t}\n\n\tget_title() {\n\t\tif(this.meta.title_field) {\n\t\t\treturn this.doc[this.meta.title_field];\n\t\t} else {\n\t\t\treturn this.doc.name;\n\t\t}\n\t}\n\n\tget_selected() {\n\t\t// returns list of children that are selected. returns [parentfield, name] for each\n\t\tvar selected = {}, me = this;\n\t\tfrappe.meta.get_table_fields(this.doctype).forEach(function(df) {\n\t\t\t// handle TableMultiselect child fields\n\t\t\tlet _selected = [];\n\n\t\t\tif(me.fields_dict[df.fieldname].grid) {\n\t\t\t\t_selected = me.fields_dict[df.fieldname].grid.get_selected();\n\t\t\t}\n\n\t\t\tif(_selected.length) {\n\t\t\t\tselected[df.fieldname] = _selected;\n\t\t\t}\n\t\t});\n\t\treturn selected;\n\t}\n\n\tset_indicator_formatter(fieldname, get_color, get_text) {\n\t\t// get doctype from parent\n\t\tvar doctype;\n\t\tif (frappe.meta.docfield_map[this.doctype][fieldname]) {\n\t\t\tdoctype = this.doctype;\n\t\t} else {\n\t\t\tfrappe.meta.get_table_fields(this.doctype).every(function(df) {\n\t\t\t\tif (frappe.meta.docfield_map[df.options][fieldname]) {\n\t\t\t\t\tdoctype = df.options;\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfrappe.meta.docfield_map[doctype][fieldname].formatter =\n\t\t\tfunction(value, df, options, doc) {\n\t\t\t\tif (value) {\n\t\t\t\t\tvar label;\n\t\t\t\t\tif (get_text) {\n\t\t\t\t\t\tlabel = get_text(doc);\n\t\t\t\t\t} else if (frappe.form.link_formatters[df.options]) {\n\t\t\t\t\t\tlabel = frappe.form.link_formatters[df.options](value, doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlabel = value;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst escaped_name = encodeURIComponent(value);\n\n\t\t\t\t\treturn `\n\t\t\t\t\t\t<a class=\"indicator ${get_color(doc || {})}\"\n\t\t\t\t\t\t\thref=\"/app/${frappe.router.slug(df.options)}/${escaped_name}\"\n\t\t\t\t\t\t\tdata-doctype=\"${df.options}\"\n\t\t\t\t\t\t\tdata-name=\"${value}\">\n\t\t\t\t\t\t\t${label}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t`;\n\t\t\t\t} else {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t};\n\t}\n\n\tcan_create(doctype) {\n\t\t// return true or false if the user can make a particlar doctype\n\t\t// will check permission, `can_make_methods` if exists, or will decided on\n\t\t// basis of whether the document is submittable\n\t\tif(!frappe.model.can_create(doctype)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\t\t// custom buttons are translated and so are the keys\n\t\t\tconst key = __(this.custom_make_buttons[doctype]);\n\t\t\t// if the button is present, then show make\n\t\t\treturn !!this.custom_buttons[key];\n\t\t}\n\n\t\tif(this.can_make_methods && this.can_make_methods[doctype]) {\n\t\t\treturn this.can_make_methods[doctype](this);\n\t\t} else {\n\t\t\tif(this.meta.is_submittable && !this.doc.docstatus==1) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\tmake_new(doctype) {\n\t\t// make new doctype from the current form\n\t\t// will handover to `make_methods` if defined\n\t\t// or will create and match link fields\n\t\tlet me = this;\n\t\tif(this.make_methods && this.make_methods[doctype]) {\n\t\t\treturn this.make_methods[doctype](this);\n\t\t} else if(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\t\tthis.custom_buttons[__(this.custom_make_buttons[doctype])].trigger('click');\n\t\t} else {\n\t\t\tfrappe.model.with_doctype(doctype, function() {\n\t\t\t\tlet new_doc = frappe.model.get_new_doc(doctype, null, null, true);\n\n\t\t\t\t// set link fields (if found)\n\t\t\t\tme.set_link_field(doctype, new_doc);\n\n\t\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t\t\t// frappe.set_route('Form', doctype, new_doc.name);\n\t\t\t});\n\t\t}\n\t}\n\n\tset_link_field(doctype, new_doc) {\n\t\tlet me = this;\n\t\tfrappe.get_meta(doctype).fields.forEach(function(df) {\n\t\t\tif (df.fieldtype === 'Link' && df.options === me.doctype) {\n\t\t\t\tnew_doc[df.fieldname] = me.doc.name;\n\t\t\t} else if (['Link', 'Dynamic Link'].includes(df.fieldtype) && me.doc[df.fieldname]) {\n\t\t\t\tnew_doc[df.fieldname] = me.doc[df.fieldname];\n\t\t\t} else if (df.fieldtype === 'Table' && df.options && df.reqd) {\n\t\t\t\tlet row = new_doc[df.fieldname][0];\n\t\t\t\tme.set_link_field(df.options, row);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdate_in_all_rows(table_fieldname, fieldname, value) {\n\t\t// Update the `value` of the field named `fieldname` in all rows of the\n\t\t// child table named `table_fieldname`.\n\t\t// Do not overwrite existing values.\n\t\tif (value === undefined) return;\n\n\t\tfrappe.model\n\t\t\t.get_children(this.doc, table_fieldname)\n\t\t\t.filter(child => !frappe.model.has_value(child.doctype, child.name, fieldname))\n\t\t\t.forEach(child =>\n\t\t\t\tfrappe.model.set_value(child.doctype, child.name, fieldname, value)\n\t\t\t);\n\t}\n\n\tget_sum(table_fieldname, fieldname) {\n\t\tlet sum = 0;\n\t\tfor (let d of (this.doc[table_fieldname] || [])) {\n\t\t\tsum += d[fieldname];\n\t\t}\n\t\treturn sum;\n\t}\n\n\tscroll_to_field(fieldname, focus=true) {\n\t\tlet field = this.get_field(fieldname);\n\t\tif (!field) return;\n\n\t\tlet $el = field.$wrapper;\n\n\t\t// set tab as active\n\t\tif (field.tab && !field.tab.is_active()) {\n\t\t\tfield.tab.set_active();\n\t\t}\n\n\t\t// uncollapse section\n\t\tif (field.section.is_collapsed()) {\n\t\t\tfield.section.collapse(false);\n\t\t}\n\n\t\t// scroll to input\n\t\tfrappe.utils.scroll_to($el, true, 15);\n\n\t\t// focus if text field\n\t\tif (focus) {\n\t\t\t$el.find('input, select, textarea').focus();\n\t\t}\n\n\t\t// highlight control inside field\n\t\tlet control_element = $el.find('.form-control')\n\t\tcontrol_element.addClass('highlight');\n\t\tsetTimeout(() => {\n\t\t\tcontrol_element.removeClass('highlight');\n\t\t}, 2000);\n\t}\n\n\tsetup_docinfo_change_listener() {\n\t\tlet doctype = this.doctype;\n\t\tlet docname = this.docname;\n\t\tlet listener_name = `update_docinfo_for_${doctype}_${docname}`;\n\t\t// to avoid duplicates\n\t\tfrappe.realtime.off(listener_name);\n\t\tfrappe.realtime.on(listener_name, ({doc, key, action='update'}) => {\n\t\t\tlet doc_list = (frappe.model.docinfo[doctype][docname][key] || []);\n\t\t\tif (action === 'add') {\n\t\t\t\tfrappe.model.docinfo[doctype][docname][key].push(doc);\n\t\t\t}\n\n\t\t\tlet docindex = doc_list.findIndex(old_doc => {\n\t\t\t\treturn old_doc.name === doc.name;\n\t\t\t});\n\n\t\t\tif (docindex > -1) {\n\t\t\t\tif (action === 'update') {\n\t\t\t\t\tfrappe.model.docinfo[doctype][docname][key].splice(docindex, 1, doc);\n\t\t\t\t}\n\t\t\t\tif (action === 'delete') {\n\t\t\t\t\tfrappe.model.docinfo[doctype][docname][key].splice(docindex, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// no need to update timeline of owner of comment\n\t\t\t// gets handled via comment submit code\n\t\t\tif (!(['add', 'update'].includes(action) && doc.doctype === 'Comment' && doc.owner === frappe.session.user)) {\n\t\t\t\tthis.timeline && this.timeline.refresh();\n\t\t\t}\n\t\t});\n\t}\n\n\t// Filters fields from the reference doctype and sets them as options for a Select field\n\tset_fields_as_options(fieldname, reference_doctype, filter_function, default_options=[], table_fieldname) {\n\t\tif (!reference_doctype) return Promise.resolve();\n\t\tlet options = default_options || [];\n\t\tif (!filter_function) filter_function = (f) => f;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.model.with_doctype(reference_doctype, () => {\n\t\t\t\tfrappe.get_meta(reference_doctype).fields.map(df => {\n\t\t\t\t\tfilter_function(df) && options.push({ label: df.label, value: df.fieldname });\n\t\t\t\t});\n\t\t\t\toptions && this.set_df_property(fieldname, 'options', options, this.doc.name, table_fieldname);\n\t\t\t\tresolve(options);\n\t\t\t});\n\t\t});\n\t}\n\tset_active_tab(tab) {\n\t\tif (!this.active_tab_map) {\n\t\t\tthis.active_tab_map = {};\n\t\t}\n\t\tthis.active_tab_map[this.docname] = tab;\n\t}\n\tget_active_tab() {\n\t\treturn this.active_tab_map && this.active_tab_map[this.docname];\n\t}\n};\n\nfrappe.validated = 0;\n// Proxy for frappe.validated\nObject.defineProperty(window, 'validated', {\n\tget: function() {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.'); // eslint-disable-line\n\t\treturn frappe.validated;\n\t},\n\tset: function(value) {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.'); // eslint-disable-line\n\t\tfrappe.validated = value;\n\t\treturn frappe.validated;\n\t}\n});\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n/* eslint-disable no-console */\n\nwindow.refresh_many = function(flist, dn, table_field) {\n\tfor(var i in flist) {\n\t\tif (table_field)\n\t\t\trefresh_field(flist[i], dn, table_field);\n\t\telse\n\t\t\trefresh_field(flist[i]);\n\t}\n};\n\nwindow.refresh_field = function(n, docname, table_field) {\n\t// multiple\n\tif(typeof n==typeof [])\n\t\trefresh_many(n, docname, table_field);\n\n\tif (n && typeof n==='string' && table_field) {\n\t\tvar grid = cur_frm.fields_dict[table_field].grid,\n\t\t\tfield = frappe.utils.filter_dict(grid.docfields, {fieldname: n}),\n\t\t\tgrid_row = grid.grid_rows_by_docname[docname];\n\n\t\tif (field && field.length) {\n\t\t\tfield = field[0];\n\t\t\tvar meta = frappe.meta.get_docfield(field.parent, field.fieldname, docname);\n\t\t\t$.extend(field, meta);\n\t\t\tif (grid_row) {\n\t\t\t\tgrid_row.refresh_field(n);\n\t\t\t} else {\n\t\t\t\tgrid.refresh();\n\t\t\t}\n\t\t}\n\t} else if(cur_frm) {\n\t\tcur_frm.refresh_field(n);\n\t}\n};\n\nwindow.set_field_options = function(n, txt) {\n\tcur_frm.set_df_property(n, 'options', txt);\n};\n\nwindow.toggle_field = function(n, hidden) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif(df) {\n\t\tdf.hidden = hidden;\n\t\trefresh_field(n);\n\t} else {\n\t\tconsole.log((hidden ? \"hide_field\" : \"unhide_field\") + \" cannot find field \" + n);\n\t}\n};\n\nwindow.hide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 1);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 1);\n\t\t}\n\t}\n};\n\nwindow.unhide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 0);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 0);\n\t\t}\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n\n\nfrappe.ui.form.AssignTo = class AssignTo {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.btn = this.parent.find(\".add-assignment-btn\").on(\"click\", () => this.add());\n\t\tthis.btn_wrapper = this.btn.parent();\n\n\t\tthis.refresh();\n\t}\n\trefresh() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.render(this.frm.get_docinfo().assignments);\n\t}\n\trender(assignments) {\n\t\tthis.frm.get_docinfo().assignments = assignments;\n\n\t\tlet assignments_wrapper = this.parent.find('.assignments');\n\n\t\tassignments_wrapper.empty();\n\t\tlet assigned_users = assignments.map(d => d.owner);\n\n\t\tif (!assigned_users.length) {\n\t\t\tassignments_wrapper.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tlet avatar_group = frappe.avatar_group(assigned_users, 5, {'align': 'left', 'overlap': true});\n\n\t\tassignments_wrapper.show();\n\t\tassignments_wrapper.append(avatar_group);\n\t\tavatar_group.click(() => {\n\t\t\tnew frappe.ui.form.AssignmentDialog({\n\t\t\t\tassignments: assigned_users,\n\t\t\t\tfrm: this.frm\n\t\t\t});\n\t\t});\n\t}\n\tadd() {\n\t\tvar me = this;\n\n\t\tif (this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif (!me.assign_to) {\n\t\t\tme.assign_to = new frappe.ui.form.AssignToDialog({\n\t\t\t\tmethod: \"frappe.desk.form.assign_to.add\",\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tdocname: me.frm.docname,\n\t\t\t\tfrm: me.frm,\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tme.render(r.message);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tme.assign_to.dialog.clear();\n\t\tme.assign_to.dialog.show();\n\t}\n\tremove(owner) {\n\t\tif (this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before removing assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\treturn frappe.xcall('frappe.desk.form.assign_to.remove', {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tname: this.frm.docname,\n\t\t\tassign_to: owner\n\t\t}).then((assignments) => {\n\t\t\tthis.render(assignments);\n\t\t});\n\t}\n};\n\n\nfrappe.ui.form.AssignToDialog = class AssignToDialog {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\n\t\tthis.make();\n\t\tthis.set_description_from_doc();\n\t}\n\tmake() {\n\t\tlet me = this;\n\n\t\tme.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add to ToDo'),\n\t\t\tfields: me.get_fields(),\n\t\t\tprimary_action_label: __(\"Add\"),\n\t\t\tprimary_action: function() {\n\t\t\t\tlet args = me.dialog.get_values();\n\n\t\t\t\tif (args && args.assign_to) {\n\t\t\t\t\tme.dialog.set_message(\"Assigning...\");\n\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: me.method,\n\t\t\t\t\t\targs: $.extend(args, {\n\t\t\t\t\t\t\tdoctype: me.doctype,\n\t\t\t\t\t\t\tname: me.docname,\n\t\t\t\t\t\t\tassign_to: args.assign_to,\n\t\t\t\t\t\t\tbulk_assign: me.bulk_assign || false,\n\t\t\t\t\t\t\tre_assign: me.re_assign || false\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tbtn: me.dialog.get_primary_btn(),\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\tif (me.callback) {\n\t\t\t\t\t\t\t\t\tme.callback(r);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tme.dialog && me.dialog.hide();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.dialog.clear_message();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\tassign_to_me() {\n\t\tlet me = this;\n\t\tlet assign_to = [];\n\n\t\tif (me.dialog.get_value(\"assign_to_me\")) {\n\t\t\tassign_to.push(frappe.session.user);\n\t\t}\n\n\t\tme.dialog.set_value(\"assign_to\", assign_to);\n\t}\n\tset_description_from_doc() {\n\t\tlet me = this;\n\n\t\tif (me.frm && me.frm.meta.title_field) {\n\t\t\tme.dialog.set_value(\"description\", me.frm.doc[me.frm.meta.title_field]);\n\t\t}\n\t}\n\tget_fields() {\n\t\tlet me = this;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tlabel: __(\"Assign to me\"),\n\t\t\t\tfieldtype: 'Check',\n\t\t\t\tfieldname: 'assign_to_me',\n\t\t\t\tdefault: 0,\n\t\t\t\tonchange: () => me.assign_to_me()\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: 'MultiSelectPills',\n\t\t\t\tfieldname: 'assign_to',\n\t\t\t\tlabel: __(\"Assign To\"),\n\t\t\t\treqd: true,\n\t\t\t\tget_data: function(txt) {\n\t\t\t\t\treturn frappe.db.get_link_options(\"User\", txt, {user_type: \"System User\", enabled: 1});\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: 'Section Break'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Complete By\"),\n\t\t\t\tfieldtype: 'Date',\n\t\t\t\tfieldname: 'date'\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: 'Column Break'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Priority\"),\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\tfieldname: 'priority',\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'Low',\n\t\t\t\t\t\tlabel: __('Low')\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'Medium',\n\t\t\t\t\t\tlabel: __('Medium')\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'High',\n\t\t\t\t\t\tlabel: __('High')\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\t// Pick up priority from the source document, if it exists and is available in ToDo\n\t\t\t\tdefault: [\"Low\", \"Medium\", \"High\"].includes(me.frm && me.frm.doc.priority ? me.frm.doc.priority : 'Medium')\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: 'Section Break'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Comment\"),\n\t\t\t\tfieldtype: 'Small Text',\n\t\t\t\tfieldname: 'description'\n\t\t\t}\n\t\t];\n\t}\n};\n\n\nfrappe.ui.form.AssignmentDialog = class {\n\tconstructor(opts) {\n\t\tthis.frm = opts.frm;\n\t\tthis.assignments = opts.assignments;\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Assignments'),\n\t\t\tsize: 'small',\n\t\t\tno_focus: true,\n\t\t\tfields: [{\n\t\t\t\t'label': __('Assign a user'),\n\t\t\t\t'fieldname': 'user',\n\t\t\t\t'fieldtype': 'Link',\n\t\t\t\t'options': 'User',\n\t\t\t\t'change': () => {\n\t\t\t\t\tlet value = this.dialog.get_value('user');\n\t\t\t\t\tif (value && !this.assigning) {\n\t\t\t\t\t\tthis.assigning = true;\n\t\t\t\t\t\tthis.dialog.set_df_property('user', 'read_only', 1);\n\t\t\t\t\t\tthis.dialog.set_df_property('user', 'description', __('Assigning...'));\n\t\t\t\t\t\tthis.add_assignment(value).then(() => {\n\t\t\t\t\t\t\tthis.dialog.set_value('user', null);\n\t\t\t\t\t\t}).finally(() => {\n\t\t\t\t\t\t\tthis.dialog.set_df_property('user', 'description', null);\n\t\t\t\t\t\t\tthis.dialog.set_df_property('user', 'read_only', 0);\n\t\t\t\t\t\t\tthis.assigning = false;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'HTML',\n\t\t\t\t'fieldname': 'assignment_list'\n\t\t\t}]\n\t\t});\n\n\t\tthis.assignment_list = $(this.dialog.get_field('assignment_list').wrapper);\n\t\tthis.assignment_list.removeClass('frappe-control');\n\n\t\tthis.assignments.forEach(assignment => {\n\t\t\tthis.update_assignment(assignment);\n\t\t});\n\t\tthis.dialog.show();\n\t}\n\trender(assignments) {\n\t\tthis.frm && this.frm.assign_to.render(assignments);\n\t}\n\tadd_assignment(assignment) {\n\t\treturn frappe.xcall('frappe.desk.form.assign_to.add', {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tname: this.frm.docname,\n\t\t\tassign_to: [assignment],\n\t\t}).then((assignments) => {\n\t\t\tthis.update_assignment(assignment);\n\t\t\tthis.render(assignments);\n\t\t});\n\t}\n\tremove_assignment(assignment) {\n\t\treturn frappe.xcall('frappe.desk.form.assign_to.remove', {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tname: this.frm.docname,\n\t\t\tassign_to: assignment,\n\t\t});\n\t}\n\tupdate_assignment(assignment) {\n\t\tconst in_the_list = this.assignment_list.find(`[data-user=\"${assignment}\"]`).length;\n\t\tif (!in_the_list) {\n\t\t\tthis.assignment_list.append(this.get_assignment_row(assignment));\n\t\t}\n\t}\n\tget_assignment_row(assignment) {\n\t\tlet row = $(`\n\t\t\t<div class=\"dialog-assignment-row\" data-user=\"${assignment}\">\n\t\t\t\t<span>\n\t\t\t\t\t${frappe.avatar(assignment)}\n\t\t\t\t\t${frappe.user.full_name(assignment)}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t`);\n\n\t\tif (assignment === frappe.session.user || this.frm.perm[0].write) {\n\t\t\trow.append(`\n\t\t\t\t<span class=\"remove-btn cursor-pointer\">\n\t\t\t\t\t${frappe.utils.icon('close')}\n\t\t\t\t</span>\n\t\t\t`);\n\t\t\trow.find('.remove-btn').click(() => {\n\t\t\t\tthis.remove_assignment(assignment).then((assignments) => {\n\t\t\t\t\trow.remove();\n\t\t\t\t\tthis.render(assignments);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn row;\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Attachments = class Attachments {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t}\n\tmake() {\n\t\tvar me = this;\n\t\tthis.parent.find(\".add-attachment-btn\").click(function() {\n\t\t\tme.new_attachment();\n\t\t});\n\t\tthis.add_attachment_wrapper = this.parent.find(\".add-attachment-btn\");\n\t\tthis.attachments_label = this.parent.find(\".attachments-label\");\n\t}\n\tmax_reached(raise_exception=false) {\n\t\tconst attachment_count = Object.keys(this.get_attachments()).length;\n\t\tconst attachment_limit = this.frm.meta.max_attachments;\n\t\tif (attachment_limit && attachment_count >= attachment_limit) {\n\t\t\tif (raise_exception) {\n\t\t\t\tfrappe.throw({\n\t\t\t\t\ttitle: __(\"Attachment Limit Reached\"),\n\t\t\t\t\tmessage: __(\"Maximum attachment limit of {0} has been reached.\", [cstr(attachment_limit).bold()]),\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\trefresh() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.parent.find(\".attachment-row\").remove();\n\n\t\tvar max_reached = this.max_reached();\n\t\tthis.add_attachment_wrapper.toggle(!max_reached);\n\n\t\t// add attachment objects\n\t\tvar attachments = this.get_attachments();\n\t\tif(attachments.length) {\n\t\t\tlet exists = {};\n\t\t\tlet unique_attachments = attachments.filter(attachment => {\n\t\t\t\treturn Object.prototype.hasOwnProperty.call(\n\t\t\t\t\texists,\n\t\t\t\t\tattachment.file_name\n\t\t\t\t)\n\t\t\t\t\t? false\n\t\t\t\t\t: (exists[attachment.file_name] = true);\n\t\t\t});\n\t\t\tunique_attachments.forEach(attachment => {\n\t\t\t\tme.add_attachment(attachment);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.attachments_label.removeClass(\"has-attachments\");\n\t\t}\n\n\t}\n\tget_attachments() {\n\t\treturn this.frm.get_docinfo().attachments || [];\n\t}\n\tadd_attachment(attachment) {\n\t\tvar file_name = attachment.file_name;\n\t\tvar file_url = this.get_file_url(attachment);\n\t\tvar fileid = attachment.name;\n\t\tif (!file_name) {\n\t\t\tfile_name = file_url;\n\t\t}\n\n\t\tvar me = this;\n\n\t\tlet file_label = `\n\t\t\t<a href=\"${file_url}\" target=\"_blank\" title=\"${file_name}\" class=\"ellipsis\" style=\"max-width: calc(100% - 43px);\">\n\t\t\t\t<span>${file_name}</span>\n\t\t\t</a>`;\n\n\t\tlet remove_action = null;\n\t\tif (frappe.model.can_write(this.frm.doctype, this.frm.name)) {\n\t\t\tremove_action = function(target_id) {\n\t\t\t\tfrappe.confirm(__(\"Are you sure you want to delete the attachment?\"),\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tlet target_attachment = me\n\t\t\t\t\t\t\t.get_attachments()\n\t\t\t\t\t\t\t.find(attachment => attachment.name === target_id);\n\t\t\t\t\t\tlet to_be_removed = me\n\t\t\t\t\t\t\t.get_attachments()\n\t\t\t\t\t\t\t.filter(\n\t\t\t\t\t\t\t\tattachment =>\n\t\t\t\t\t\t\t\t\tattachment.file_name ===\n\t\t\t\t\t\t\t\t\ttarget_attachment.file_name\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tto_be_removed.forEach(attachment =>\n\t\t\t\t\t\t\tme.remove_attachment(attachment.name)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tconst icon = `<a href=\"/app/file/${fileid}\">\n\t\t\t\t${frappe.utils.icon(attachment.is_private ? 'lock' : 'unlock', 'sm ml-0')}\n\t\t\t</a>`;\n\n\t\t$(`<li class=\"attachment-row\">`)\n\t\t\t.append(frappe.get_data_pill(\n\t\t\t\tfile_label,\n\t\t\t\tfileid,\n\t\t\t\tremove_action,\n\t\t\t\ticon\n\t\t\t))\n\t\t\t.insertAfter(this.attachments_label.addClass(\"has-attachments\"));\n\n\t}\n\tget_file_url(attachment) {\n\t\tvar file_url = attachment.file_url;\n\t\tif (!file_url) {\n\t\t\tif (attachment.file_name.indexOf('files/') === 0) {\n\t\t\t\tfile_url = '/' + attachment.file_name;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfile_url = '/files/' + attachment.file_name;\n\t\t\t}\n\t\t}\n\t\t// hash is not escaped, https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI\n\t\treturn encodeURI(file_url).replace(/#/g, '%23');\n\t}\n\tget_file_id_from_file_url(file_url) {\n\t\tvar fid;\n\t\t$.each(this.get_attachments(), function(i, attachment) {\n\t\t\tif (attachment.file_url === file_url) {\n\t\t\t\tfid = attachment.name;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn fid;\n\t}\n\tremove_attachment_by_filename(filename, callback) {\n\t\tthis.remove_attachment(this.get_file_id_from_file_url(filename), callback);\n\t}\n\tremove_attachment(fileid, callback) {\n\t\tif (!fileid) {\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.form.utils.remove_attach',\n\t\t\ttype: 'DELETE',\n\t\t\targs: {\n\t\t\t\tfid: fileid,\n\t\t\t\tdt: me.frm.doctype,\n\t\t\t\tdn: me.frm.docname\n\t\t\t},\n\t\t\tcallback: function(r,rt) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\tif(!r._server_messages)\n\t\t\t\t\t\tfrappe.msgprint(__(\"There were errors\"));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tme.remove_fileid(fileid);\n\t\t\t\tme.frm.sidebar.reload_docinfo();\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t});\n\t}\n\tnew_attachment(fieldname) {\n\t\tif (this.dialog) {\n\t\t\t// remove upload dialog\n\t\t\tthis.dialog.$wrapper.remove();\n\t\t}\n\n\t\tnew frappe.ui.FileUploader({\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t\tfrm: this.frm,\n\t\t\tfolder: 'Home/Attachments',\n\t\t\ton_success: (file_doc) => {\n\t\t\t\tthis.attachment_uploaded(file_doc);\n\t\t\t},\n\t\t\trestrictions: {\n\t\t\t\tmax_number_of_files: this.frm.meta.max_attachments - this.frm.attachments.get_attachments().length,\n\t\t\t}\n\t\t});\n\t}\n\tget_args() {\n\t\treturn {\n\t\t\tfrom_form: 1,\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t}\n\t}\n\tattachment_uploaded(attachment) {\n\t\tthis.dialog && this.dialog.hide();\n\t\tthis.update_attachment(attachment);\n\t\tthis.frm.sidebar.reload_docinfo();\n\n\t\tif(this.fieldname) {\n\t\t\tthis.frm.set_value(this.fieldname, attachment.file_url);\n\t\t}\n\t}\n\tupdate_attachment(attachment) {\n\t\tif(attachment.name) {\n\t\t\tthis.add_to_attachments(attachment);\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\tadd_to_attachments (attachment) {\n\t\tvar form_attachments = this.get_attachments();\n\t\tfor(var i in form_attachments) {\n\t\t\t// prevent duplicate\n\t\t\tif(form_attachments[i][\"name\"] === attachment.name) return;\n\t\t}\n\t\tform_attachments.push(attachment);\n\t}\n\tremove_fileid(fileid) {\n\t\tvar attachments = this.get_attachments();\n\t\tvar new_attachments = [];\n\t\t$.each(attachments, function(i, attachment) {\n\t\t\tif(attachment.name!=fileid) {\n\t\t\t\tnew_attachments.push(attachment);\n\t\t\t}\n\t\t});\n\t\tthis.frm.get_docinfo().attachments = new_attachments;\n\t\tthis.refresh();\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n\n\nfrappe.ui.form.Share = class Share {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.shares = this.parent.find('.shares');\n\t}\n\trefresh() {\n\t\tthis.render_sidebar();\n\t}\n\trender_sidebar() {\n\t\tconst shared = this.shared || this.frm.get_docinfo().shared;\n\t\tconst shared_users = shared.filter(Boolean).map(s => s.user);\n\n\t\tif (this.frm.is_new()) {\n\t\t\tthis.parent.find(\".share-doc-btn\").hide();\n\t\t}\n\n\t\tthis.parent.find(\".share-doc-btn\").on(\"click\", () => {\n\t\t\tthis.frm.share_doc();\n\t\t});\n\n\t\tthis.shares.empty();\n\n\t\tif (!shared_users.length) {\n\t\t\tthis.shares.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.shares.show();\n\t\t// REDESIGN-TODO: handle \"shared with everyone\"\n\t\tthis.shares.append(frappe.avatar_group(shared_users, 5, {'align': 'left', 'overlap': true}));\n\t}\n\tshow() {\n\t\tvar me = this;\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Share {0} with\", [this.frm.doc.name]),\n\t\t});\n\n\t\tthis.dialog = d;\n\t\tthis.dirty = false;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.share.get_users\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.render_shared(r.message || []);\n\t\t\t}\n\t\t});\n\n\t\t$(d.body).html('<p class=\"text-muted\">' + __(\"Loading...\") + '</p>');\n\n\t\td.onhide = function() {\n\t\t\t// reload comments\n\t\t\tif(me.dirty) me.frm.sidebar.reload_docinfo();\n\t\t}\n\n\t\td.show();\n\t}\n\trender_shared(shared) {\n\t\tif(shared)\n\t\t\tthis.shared = shared;\n\t\tvar d = this.dialog;\n\t\t$(d.body).empty();\n\n\t\tvar everyone = {};\n\t\t$.each(this.shared, function(i, s) {\n\t\t\t// pullout everyone record from shared list\n\t\t\tif (s && s.everyone) {\n\t\t\t\teveryone = s;\n\t\t\t}\n\t\t});\n\n\t\t$(frappe.render_template(\"set_sharing\", {frm: this.frm, shared: this.shared, everyone: everyone}))\n\t\t\t.appendTo(d.body);\n\n\t\tif(frappe.model.can_share(null, this.frm)) {\n\t\t\tthis.make_user_input();\n\t\t\tthis.add_share_button();\n\t\t\tthis.set_edit_share_events();\n\t\t} else {\n\t\t\t// if cannot share, disable sharing settings.\n\t\t\t$(d.body).find(\".edit-share\").prop(\"disabled\", true);\n\t\t}\n\t}\n\tmake_user_input() {\n\t\t// make add-user input\n\t\tthis.dialog.share_with = frappe.ui.form.make_control({\n\t\t\tparent: $(this.dialog.body).find(\".input-wrapper-add-share\"),\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: __(\"Share With\"),\n\t\t\t\tfieldname: \"share_with\",\n\t\t\t\toptions: \"User\",\n\t\t\t\tfilters: {\n\t\t\t\t\t\"user_type\": \"System User\",\n\t\t\t\t\t\"name\": [\"!=\", frappe.session.user]\n\t\t\t\t}\n\t\t\t},\n\t\t\tonly_input: true,\n\t\t\trender_input: true\n\t\t});\n\n\t}\n\tadd_share_button() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".btn-add-share\").on(\"click\", function() {\n\t\t\tvar user = d.share_with.get_value();\n\t\t\tif(!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.add\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tread: $(d.body).find(\".add-share-read\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\twrite: $(d.body).find(\".add-share-write\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tsubmit: $(d.body).find(\".add-share-submit\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tshare: $(d.body).find(\".add-share-share\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tnotify: 1,\n\t\t\t\t},\n\t\t\t\tbtn: this,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\tif(s && s.user===r.message.user) {\n\t\t\t\t\t\t\t// re-adding / remove the old share rule.\n\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tset_edit_share_events() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".edit-share\").on(\"click\", function() {\n\t\t\tvar user = $(this).parents(\".shared-user:first\").attr(\"data-user\") || \"\",\n\t\t\t\tvalue = $(this).prop(\"checked\") ? 1 : 0,\n\t\t\t\tproperty = $(this).attr(\"name\"),\n\t\t\t\teveryone = cint($(this).parents(\".shared-user:first\").attr(\"data-everyone\"));\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.set_permission\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tpermission_to: property,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\teveryone: everyone\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tvar found = null;\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\t// update shared object\n\t\t\t\t\t\tif(s && (s.user===user || (everyone && s.everyone===1))) {\n\t\t\t\t\t\t\tif(!r.message) {\n\t\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.shared[i] = $.extend(s, r.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!found) {\n\t\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n};\n", "// Copyright (c) 2019, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n\n\nfrappe.ui.form.Review = class Review {\n\tconstructor({ parent, frm }) {\n\t\tthis.parent = parent;\n\t\tthis.frm = frm;\n\t\tthis.points = frappe.boot.points;\n\t\tthis.reviews = this.parent.find('.reviews');\n\t\tthis.setup_add_review_button();\n\t\tthis.update_reviewers();\n\t}\n\tupdate_points() {\n\t\treturn frappe.xcall('frappe.social.doctype.energy_point_log.energy_point_log.get_energy_points', {\n\t\t\tuser: frappe.session.user\n\t\t}).then(data => {\n\t\t\tfrappe.boot.points = data;\n\t\t\tthis.points = data;\n\t\t});\n\t}\n\tsetup_add_review_button() {\n\t\tconst review_button = this.reviews.find('.add-review-btn');\n\n\t\tif (!this.points.review_points) {\n\t\t\treview_button.click(false);\n\t\t\treview_button.popover({\n\t\t\t\ttrigger: 'hover',\n\t\t\t\tcontent: () => {\n\t\t\t\t\treturn `<div class=\"text-medium\">\n\t\t\t\t\t\t${__('You do not have enough review points')}\n\t\t\t\t\t</div>`;\n\t\t\t\t},\n\t\t\t\thtml: true\n\t\t\t});\n\t\t} else {\n\t\t\treview_button.click(() => this.show_review_dialog());\n\t\t}\n\t}\n\tget_involved_users() {\n\t\tconst user_fields = this.frm.meta.fields\n\t\t\t.filter(d => d.fieldtype === 'Link' && d.options === 'User')\n\t\t\t.map(d => d.fieldname);\n\n\t\tuser_fields.push('owner');\n\t\tlet involved_users = user_fields.map(field => this.frm.doc[field]);\n\n\t\tconst docinfo = this.frm.get_docinfo();\n\n\t\tinvolved_users = involved_users.concat(\n\t\t\tdocinfo.communications.map(d => d.sender && d.delivery_status === 'sent'),\n\t\t\tdocinfo.comments.map(d => d.owner),\n\t\t\tdocinfo.versions.map(d => d.owner),\n\t\t\tdocinfo.assignments.map(d => d.owner)\n\t\t);\n\n\t\treturn involved_users\n\t\t\t.uniqBy(u => u)\n\t\t\t.filter(user => !['Administrator', frappe.session.user].includes(user))\n\t\t\t.filter(Boolean);\n\t}\n\tshow_review_dialog() {\n\t\tconst user_options = this.get_involved_users();\n\t\tconst review_dialog = new frappe.ui.Dialog({\n\t\t\t'title': __('Add Review'),\n\t\t\t'fields': [{\n\t\t\t\tfieldname: 'to_user',\n\t\t\t\tfieldtype: 'Autocomplete',\n\t\t\t\tlabel: __('To User'),\n\t\t\t\treqd: 1,\n\t\t\t\toptions: user_options,\n\t\t\t\tignore_validation: 1,\n\t\t\t\tdescription: __('Only users involved in the document are listed')\n\t\t\t}, {\n\t\t\t\tfieldname: 'review_type',\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\tlabel: __('Action'),\n\t\t\t\toptions: [{\n\t\t\t\t\t'label': __('Appreciate'),\n\t\t\t\t\t'value': 'Appreciation'\n\t\t\t\t}, {\n\t\t\t\t\t'label': __('Criticize'),\n\t\t\t\t\t'value': 'Criticism'\n\t\t\t\t}],\n\t\t\t\tdefault: 'Appreciation'\n\t\t\t}, {\n\t\t\t\tfieldname: 'points',\n\t\t\t\tfieldtype: 'Int',\n\t\t\t\tlabel: __('Points'),\n\t\t\t\treqd: 1,\n\t\t\t\tdescription: __(\"Currently you have {0} review points\", [this.points.review_points])\n\t\t\t}, {\n\t\t\t\tfieldtype: 'Small Text',\n\t\t\t\tfieldname: 'reason',\n\t\t\t\treqd: 1,\n\t\t\t\tlabel: __('Reason')\n\t\t\t}],\n\t\t\tprimary_action: (values) => {\n\t\t\t\treview_dialog.disable_primary_action();\n\t\t\t\tif (values.points > this.points.review_points) {\n\t\t\t\t\treturn frappe.msgprint(__('You do not have enough points'));\n\t\t\t\t}\n\t\t\t\tfrappe.xcall('frappe.social.doctype.energy_point_log.energy_point_log.review', {\n\t\t\t\t\tdoc: {\n\t\t\t\t\t\tdoctype: this.frm.doc.doctype,\n\t\t\t\t\t\tname: this.frm.doc.name,\n\t\t\t\t\t},\n\t\t\t\t\tto_user: values.to_user,\n\t\t\t\t\tpoints: values.points,\n\t\t\t\t\treview_type: values.review_type,\n\t\t\t\t\treason: values.reason\n\t\t\t\t}).then(review => {\n\t\t\t\t\treview_dialog.hide();\n\t\t\t\t\treview_dialog.clear();\n\t\t\t\t\tthis.frm.get_docinfo().energy_point_logs.unshift(review);\n\t\t\t\t\tthis.frm.timeline.refresh();\n\t\t\t\t\tthis.update_reviewers();\n\t\t\t\t\tthis.update_points();\n\t\t\t\t}).finally(() => {\n\t\t\t\t\treview_dialog.enable_primary_action();\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Submit')\n\t\t});\n\t\treview_dialog.show();\n\t}\n\tupdate_reviewers() {\n\t\tconst review_logs = this.frm.get_docinfo().energy_point_logs\n\t\t\t.filter(log => ['Appreciation', 'Criticism'].includes(log.type));\n\n\t\tthis.reviews.find('.review').remove();\n\t\treview_logs.forEach(log => {\n\t\t\tlet review_pill = $(`\n\t\t\t\t<div class=\"review ${log.points < 0 ? 'criticism' : 'appreciation'} cursor-pointer\">\n\t\t\t\t\t${frappe.avatar(log.owner)}\n\t\t\t\t\t<span class=\"review-points\">\n\t\t\t\t\t\t${log.points > 0 ? '+': ''}${log.points}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.reviews.prepend(review_pill);\n\t\t\tthis.setup_detail_popover(review_pill, log);\n\t\t});\n\t}\n\tsetup_detail_popover(el, data) {\n\t\tlet subject = '';\n\t\tlet fullname = frappe.user.full_name(data.user);\n\t\tlet timestamp = `<span class=\"text-muted\">${frappe.datetime.comment_when(data.creation)}</span>`;\n\t\tlet message_parts = [Math.abs(data.points), fullname, timestamp];\n\t\tif (data.type === 'Appreciation') {\n\t\t\tif (data.points == 1) {\n\t\t\t\tsubject = __('{0} appreciation point for {1}', message_parts);\n\t\t\t} else {\n\t\t\t\tsubject = __('{0} appreciation points for {1}', message_parts);\n\t\t\t}\n\t\t} else {\n\t\t\tif (data.points == -1) {\n\t\t\t\tsubject = __('{0} criticism point for {1}', message_parts);\n\t\t\t} else {\n\t\t\t\tsubject = __('{0} criticism points for {1}', message_parts);\n\t\t\t}\n\t\t}\n\n\t\tel.popover({\n\t\t\tanimation: true,\n\t\t\ttrigger: 'hover',\n\t\t\tdelay: 500,\n\t\t\tplacement: 'top',\n\t\t\ttemplate: `\n\t\t\t\t<div class=\"review-popover popover\" role=\"tooltip\">\n\t\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t\t<h3 class=\"popover-header\"></h3>\n\t\t\t\t\t<div class=\"popover-body\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>'\n\t\t\t`,\n\t\t\tcontent: () => {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"text-medium\">\n\t\t\t\t\t\t<div class=\"body\">\n\t\t\t\t\t\t\t<div>${data.reason}</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"subject\">\n\t\t\t\t\t\t\t${frappe.utils.icon('review')}\n\t\t\t\t\t\t\t${subject}\n\n\t\t\t\t\t\t\t<p class=\"mt-1\">\n\t\t\t\t\t\t\t\t<!-- ${frappe.avatar(\"shivam@example.com\", \"avatar-xs\")} -->\n\t\t\t\t\t\t\t\t<span>${frappe.user.full_name(data.owner)}</span> - ${timestamp}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t},\n\t\t\thtml: true,\n\t\t\tcontainer: 'body'\n\t\t});\n\n\n\t\treturn el;\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.ui.form');\n\nfrappe.ui.form.DocumentFollow = class DocumentFollow {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tif (!frappe.boot.user.document_follow_notify) {\n\t\t\tthis.hide_follow_section();\n\t\t\treturn;\n\t\t}\n\t\tthis.follow_document_link = this.parent.find('.follow-document-link');\n\t\tthis.unfollow_document_link = this.parent.find('.unfollow-document-link');\n\t\tthis.follow_span = this.parent.find('.anchor-document-follow > span');\n\t\tthis.followed_by = this.parent.find('.followed-by');\n\t\tthis.followed_by_label = this.parent.find('.followed-by-label');\n\t}\n\n\trefresh() {\n\t\tthis.set_followers();\n\t\tthis.render_sidebar();\n\t}\n\n\trender_sidebar() {\n\t\tconst docinfo = this.frm.get_docinfo();\n\t\tconst document_follow_enabled = frappe.boot.user.document_follow_notify;\n\t\tconst document_can_be_followed = frappe.get_meta(this.frm.doctype).track_changes;\n\t\tif (frappe.session.user === 'Administrator'\n\t\t\t|| !document_follow_enabled\n\t\t\t|| !document_can_be_followed\n\t\t) {\n\t\t\tthis.hide_follow_section();\n\t\t\treturn;\n\t\t}\n\t\tthis.bind_events();\n\n\t\tconst is_followed = docinfo && docinfo.is_document_followed;\n\n\t\tif(is_followed > 0) {\n\t\t\tthis.unfollow_document_link.removeClass('hidden');\n\t\t\tthis.follow_document_link.addClass('hidden');\n\t\t} else {\n\t\t\tthis.followed_by_label.addClass('hidden');\n\t\t\tthis.followed_by.addClass('hidden');\n\t\t\tthis.unfollow_document_link.addClass('hidden');\n\t\t\tthis.follow_document_link.removeClass('hidden');\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tthis.follow_document_link.on('click', () => {\n\t\t\tthis.follow_document_link.addClass('text-muted disable-click');\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.desk.form.document_follow.follow_document',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': this.frm.doctype,\n\t\t\t\t\t'doc_name': this.frm.doc.name,\n\t\t\t\t\t'user': frappe.session.user,\n\t\t\t\t\t'force': true\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tthis.follow_action();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis.unfollow_document_link.on('click', () => {\n\t\t\tthis.unfollow_document_link.addClass('text-muted disable-click');\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.desk.form.document_follow.unfollow_document',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': this.frm.doctype,\n\t\t\t\t\t'doc_name': this.frm.doc.name,\n\t\t\t\t\t'user': frappe.session.user\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\tthis.unfollow_action();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\thide_follow_section() {\n\t\tthis.parent.hide();\n\t}\n\n\tset_followers() {\n\t\tthis.followed_by.removeClass('hidden');\n\t\tthis.followed_by_label.removeClass('hidden');\n\t\tthis.followed_by.empty();\n\t\tthis.get_followed_user().then(user => {\n\t\t\t$(user).appendTo(this.followed_by);\n\t\t});\n\t}\n\n\tget_followed_user() {\n\t\tvar html = '';\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.desk.form.document_follow.get_follow_users',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': this.frm.doctype,\n\t\t\t\t\t'doc_name': this.frm.doc.name,\n\t\t\t\t},\n\t\t\t}).then(r => {\n\t\t\t\tthis.count_others = 0;\n\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\tthis.count_others++;\n\t\t\t\t\tif(this.count_others < 4){\n\t\t\t\t\t\thtml += frappe.avatar(r.message[d].user, 'avatar-small');\n\t\t\t\t\t}\n\t\t\t\t\tif(this.count_others === 0){\n\t\t\t\t\t\tthis.followed_by.addClass('hidden');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve(html);\n\t\t\t});\n\t\t});\n\t}\n\n\tfollow_action() {\n\t\tfrappe.show_alert({\n\t\t\tmessage: __('You are now following this document. You will receive daily updates via email. You can change this in User Settings.'),\n\t\t\tindicator: 'orange'\n\t\t});\n\t\tthis.follow_document_link.removeClass('text-muted disable-click');\n\t\tthis.follow_document_link.addClass('hidden');\n\t\tthis.unfollow_document_link.removeClass('hidden');\n\t\tthis.set_followers();\n\t}\n\n\tunfollow_action() {\n\t\tfrappe.show_alert({\n\t\t\tmessage: __('You unfollowed this document'),\n\t\t\tindicator: 'red'\n\t\t});\n\t\tthis.unfollow_document_link.removeClass('text-muted disable-click');\n\t\tthis.unfollow_document_link.addClass('hidden');\n\t\tthis.follow_document_link.removeClass('hidden');\n\t\tthis.followed_by.addClass('hidden');\n\t\tthis.followed_by_label.addClass('hidden');\n\t}\n};\n", "frappe.ui.form.set_user_image = function(frm) {\n\n\tvar image_section = frm.sidebar.image_section;\n\tvar image_field = frm.meta.image_field;\n\tvar image = frm.doc[image_field];\n\tvar title_image = frm.page.$title_area.find('.title-image');\n\tvar image_actions = frm.sidebar.image_wrapper.find('.sidebar-image-actions');\n\n\n\timage_section.toggleClass('hide', image_field ? false : true);\n\ttitle_image.toggleClass('hide', image_field ? false : true);\n\n\tif(!image_field) {\n\t\treturn;\n\t}\n\n\t// if image field has value\n\tif (image) {\n\t\timage = (window.cordova && image.indexOf('http')===-1) ?\n\t\t\tfrappe.base_url + image : image;\n\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.attr(\"src\", image)\n\t\t\t.removeClass(\"hide\");\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.addClass('hide');\n\n\t\ttitle_image\n\t\t\t.css(\"background-image\", `url(\"${image}\")`)\n\t\t\t.html('');\n\n\t\timage_actions.find('.sidebar-image-change, .sidebar-image-remove').show();\n\n\t} else {\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.attr(\"src\", null)\n\t\t\t.addClass(\"hide\");\n\n\t\tvar title = frm.get_title();\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.removeClass('hide')\n\t\t\t.find('.standard-image')\n\t\t\t.html(frappe.get_abbr(title));\n\n\t\ttitle_image.css(\"background-image\", '')\n\t\t\t.html(frappe.get_abbr(title));\n\n\t\timage_actions.find('.sidebar-image-change').show();\n\t\timage_actions.find('.sidebar-image-remove').hide();\n\t}\n\n}\n\nfrappe.ui.form.setup_user_image_event = function(frm) {\n\t// re-draw image on change of user image\n\tif(frm.meta.image_field) {\n\t\tfrappe.ui.form.on(frm.doctype, frm.meta.image_field, function(frm) {\n\t\t\tfrappe.ui.form.set_user_image(frm);\n\t\t});\n\t}\n\n\tif (frm.meta.image_field && !frm.fields_dict[frm.meta.image_field].df.read_only) {\n\t\tfrm.sidebar.image_wrapper.on('click', ':not(.sidebar-image-actions)', (e) => {\n\t\t\tlet $target = $(e.currentTarget);\n\t\t\tif ($target.is('a.dropdown-toggle, .dropdown')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet dropdown = frm.sidebar.image_wrapper.find('.sidebar-image-actions .dropdown');\n\t\t\tdropdown.toggleClass('open');\n\t\t\te.stopPropagation();\n\t\t});\n\t}\n\n\t// bind click on image_wrapper\n\tfrm.sidebar.image_wrapper.on('click', '.sidebar-image-change, .sidebar-image-remove', function(e) {\n\t\tlet $target = $(e.currentTarget);\n\t\tvar field = frm.get_field(frm.meta.image_field);\n\t\tif ($target.is('.sidebar-image-change')) {\n\t\t\tif(!field.$input) {\n\t\t\t\tfield.make_input();\n\t\t\t}\n\t\t\tfield.$input.trigger('attach_doc_image');\n\t\t} else {\n\t\t\t/// on remove event for a sidebar image wrapper remove attach file.\n\t\t\tfrm.attachments.remove_attachment_by_filename(frm.doc[frm.meta.image_field], function() {\n\t\t\t\tfield.set_value('').then(() => frm.save());\n\t\t\t});\n\t\t}\n\t});\n}\n", "frappe.ui.form.SidebarUsers = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tget_users(type) {\n\t\tlet docinfo = this.frm.get_docinfo();\n\t\treturn docinfo ? docinfo[type] || null: null;\n\t}\n\n\trefresh(data_updated, type) {\n\t\tthis.parent = type == 'viewers'? this.$wrapper.find('.form-viewers'): this.$wrapper.find('.form-typers');\n\t\tthis.parent.empty();\n\n\t\tconst users = this.get_users(type);\n\t\tusers && this.show_in_sidebar(users, type, data_updated);\n\t}\n\n\tshow_in_sidebar(users, type, show_alert) {\n\t\tlet sidebar_users = [];\n\t\tlet new_users = [];\n\t\tlet current_users = [];\n\n\t\tconst message = type == 'viewers' ? 'viewing this document': 'composing an email';\n\n\t\tusers.current.forEach(username => {\n\t\t\tif (username === frappe.session.user) {\n\t\t\t\t// current user\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar user_info = frappe.user_info(username);\n\t\t\tsidebar_users.push({\n\t\t\t\timage: user_info.image,\n\t\t\t\tfullname: user_info.fullname,\n\t\t\t\tabbr: user_info.abbr,\n\t\t\t\tcolor: user_info.color,\n\t\t\t\ttitle: __(\"{0} is currently {1}\", [user_info.fullname, message])\n\t\t\t});\n\n\t\t\tif (users.new.indexOf(username) !== -1) {\n\t\t\t\tnew_users.push(user_info.fullname);\n\t\t\t}\n\n\t\t\tcurrent_users.push(user_info.fullname);\n\t\t});\n\n\t\tif (sidebar_users.length) {\n\t\t\tthis.parent.parent().removeClass('hidden');\n\t\t\tthis.parent.append(frappe.render_template('users_in_sidebar', {'users': sidebar_users}));\n\t\t} else {\n\t\t\tthis.parent.parent().addClass('hidden');\n\t\t}\n\n\t\t// For typers always show the alert\n\t\t// For viewers show the alert to new user viewing this document\n\t\tconst alert_users = type == 'viewers' ? new_users : current_users;\n\t\tshow_alert && this.show_alert(alert_users, message);\n\t}\n\n\tshow_alert(users, message) {\n\t\tif (users.length) {\n\t\t\tif (users.length===1) {\n\t\t\t\tfrappe.show_alert(__('{0} is currently {1}', [users[0], message]));\n\t\t\t} else {\n\t\t\t\tfrappe.show_alert(__('{0} are currently {1}', [frappe.utils.comma_and(users), message]));\n\t\t\t}\n\t\t}\n\t}\n};\n", "\n\nimport './assign_to';\nimport './attachments';\nimport './share';\nimport './review';\nimport './document_follow';\nimport './user_image';\nimport './form_sidebar_users';\n\nfrappe.ui.form.Sidebar = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tmake () {\n\t\tvar sidebar_content = frappe.render_template(\"form_sidebar\", {doctype: this.frm.doctype, frm:this.frm});\n\n\t\tthis.sidebar = $('<div class=\"form-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.comments = this.sidebar.find(\".form-sidebar-stats .comments\");\n\t\tthis.user_actions = this.sidebar.find(\".user-actions\");\n\t\tthis.image_section = this.sidebar.find(\".sidebar-image-section\");\n\t\tthis.image_wrapper = this.image_section.find('.sidebar-image-wrapper');\n\t\tthis.make_assignments();\n\t\tthis.make_attachments();\n\t\tthis.make_review();\n\t\tthis.make_shared();\n\n\t\tthis.make_tags();\n\t\tthis.make_like();\n\t\tthis.make_follow();\n\n\t\tthis.bind_events();\n\t\tthis.setup_keyboard_shortcuts();\n\t\tthis.show_auto_repeat_status();\n\t\tfrappe.ui.form.setup_user_image_event(this.frm);\n\n\t\tthis.refresh();\n\n\t}\n\n\tbind_events () {\n\t\tvar me = this;\n\n\t\t// scroll to comments\n\t\tthis.comments.on(\"click\", function() {\n\t\t\tfrappe.utils.scroll_to(me.frm.footer.wrapper.find(\".comment-box\"), true);\n\t\t});\n\n\t\tthis.like_icon.on(\"click\", function() {\n\t\t\tfrappe.ui.toggle_like(me.like_wrapper, me.frm.doctype, me.frm.doc.name, function() {\n\t\t\t\tme.refresh_like();\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup_keyboard_shortcuts() {\n\t\t// add assignment shortcut\n\t\tlet assignment_link = this.sidebar.find('.add-assignment');\n\t\tfrappe.ui.keys\n\t\t\t.get_shortcut_group(this.page)\n\t\t\t.add(assignment_link);\n\t}\n\n\trefresh () {\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.sidebar.toggle(false);\n\t\t} else {\n\t\t\tthis.sidebar.toggle(true);\n\t\t\tthis.frm.assign_to.refresh();\n\t\t\tthis.frm.attachments.refresh();\n\t\t\tthis.frm.shared.refresh();\n\n\t\t\tthis.frm.tags && this.frm.tags.refresh(this.frm.get_docinfo().tags);\n\n\t\t\tif (this.frm.doc.route && cint(frappe.boot.website_tracking_enabled)) {\n\t\t\t\tlet route = this.frm.doc.route;\n\t\t\t\tfrappe.utils.get_page_view_count(route).then((res) => {\n\t\t\t\t\tthis.sidebar\n\t\t\t\t\t\t.find(\".pageview-count\")\n\t\t\t\t\t\t.html(\n\t\t\t\t\t\t\t__(\"{0} Page Views\", [String(res.message).bold()])\n\t\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.sidebar\n\t\t\t\t.find(\".modified-by\")\n\t\t\t\t.html(\n\t\t\t\t\t__(\"{0} edited this {1}\", [\n\t\t\t\t\t\tfrappe.user.full_name(this.frm.doc.modified_by).bold(),\n\t\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.modified),\n\t\t\t\t\t], \"For example, 'Jon Doe edited this 5 minutes ago'.\")\n\t\t\t\t);\n\t\t\tthis.sidebar\n\t\t\t\t.find(\".created-by\")\n\t\t\t\t.html(\n\t\t\t\t\t__(\"{0} created this {1}\", [\n\t\t\t\t\t\tfrappe.user.full_name(this.frm.doc.owner).bold(),\n\t\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.creation),\n\t\t\t\t\t], \"For example, 'Jon Doe created this 5 minutes ago'.\")\n\t\t\t\t);\n\n\t\t\tthis.refresh_like();\n\t\t\tthis.refresh_follow();\n\t\t\tthis.refresh_comments_count();\n\t\t\tfrappe.ui.form.set_user_image(this.frm);\n\t\t}\n\t}\n\n\tshow_auto_repeat_status() {\n\t\tif (this.frm.meta.allow_auto_repeat && this.frm.doc.auto_repeat) {\n\t\t\tconst me = this;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\targs:{\n\t\t\t\t\tdoctype: \"Auto Repeat\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\tname: this.frm.doc.auto_repeat\n\t\t\t\t\t},\n\t\t\t\t\tfieldname: [\"frequency\"]\n\t\t\t\t},\n\t\t\t\tcallback: function(res) {\n\t\t\t\t\tme.sidebar.find(\".auto-repeat-status\").html(__(\"Repeats {0}\", [res.message.frequency]));\n\t\t\t\t\tme.sidebar.find(\".auto-repeat-status\").on(\"click\", function(){\n\t\t\t\t\t\tfrappe.set_route(\"Form\", \"Auto Repeat\", me.frm.doc.auto_repeat);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_tags() {\n\t\tif (this.frm.meta.issingle) {\n\t\t\tthis.sidebar.find(\".form-tags\").toggle(false);\n\t\t\treturn;\n\t\t}\n\n\t\tlet tags_parent = this.sidebar.find(\".form-tags\");\n\n\t\tthis.frm.tags = new frappe.ui.TagEditor({\n\t\t\tparent: tags_parent,\n\t\t\tadd_button: tags_parent.find(\".add-tags-btn\"),\n\t\t\tfrm: this.frm,\n\t\t\ton_change: function(user_tags) {\n\t\t\t\tthis.frm.tags && this.frm.tags.refresh(user_tags);\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_attachments() {\n\t\tvar me = this;\n\t\tthis.frm.attachments = new frappe.ui.form.Attachments({\n\t\t\tparent: me.sidebar.find(\".form-attachments\"),\n\t\t\tfrm: me.frm\n\t\t});\n\t}\n\n\tmake_assignments() {\n\t\tthis.frm.assign_to = new frappe.ui.form.AssignTo({\n\t\t\tparent: this.sidebar.find(\".form-assignments\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t}\n\n\tmake_shared() {\n\t\tthis.frm.shared = new frappe.ui.form.Share({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-shared\")\n\t\t});\n\t}\n\n\tadd_user_action(label, click) {\n\t\treturn $('<a>').html(label).appendTo($('<li class=\"user-action-row\">')\n\t\t\t.appendTo(this.user_actions.removeClass(\"hidden\"))).on(\"click\", click);\n\t}\n\n\tclear_user_actions() {\n\t\tthis.user_actions.addClass(\"hidden\")\n\t\tthis.user_actions.find(\".user-action-row\").remove();\n\t}\n\n\tmake_like() {\n\t\tthis.like_wrapper = this.sidebar.find(\".liked-by\");\n\t\tthis.like_icon = this.sidebar.find(\".liked-by .like-icon\");\n\t\tthis.like_count = this.sidebar.find(\".liked-by .like-count\");\n\t\tfrappe.ui.setup_like_popover(this.sidebar.find(\".form-stats-likes\"), \".like-icon\");\n\t}\n\n\tmake_follow() {\n\t\tthis.follow_button = this.sidebar.find(\".form-sidebar-stats .form-follow\");\n\n\t\tthis.follow_button.on('click', () => {\n\t\t\tlet is_followed = this.frm.get_docinfo().is_document_followed;\n\t\t\tfrappe.call('frappe.desk.form.document_follow.update_follow', {\n\t\t\t\t'doctype': this.frm.doctype,\n\t\t\t\t'doc_name': this.frm.doc.name,\n\t\t\t\t'following': !is_followed\n\t\t\t}).then(() => {\n\t\t\t\tfrappe.model.set_docinfo(this.frm.doctype, this.frm.doc.name, \"is_document_followed\", !is_followed);\n\t\t\t\tthis.refresh_follow(!is_followed);\n\t\t\t});\n\t\t});\n\t}\n\n\trefresh_follow(follow) {\n\t\tif (follow == null) {\n\t\t\tfollow = this.frm.get_docinfo().is_document_followed;\n\t\t}\n\t\tthis.follow_button.text(follow ? __(\"Unfollow\") : __(\"Follow\"));\n\t}\n\n\trefresh_like() {\n\t\tif (!this.like_icon) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.like_wrapper.attr(\"data-liked-by\", this.frm.doc._liked_by);\n\t\tconst liked = frappe.ui.is_liked(this.frm.doc);\n\t\tthis.like_wrapper\n\t\t\t.toggleClass(\"not-liked\", !liked)\n\t\t\t.toggleClass(\"liked\", liked)\n\t\t\t.attr(\"data-doctype\", this.frm.doctype)\n\t\t\t.attr(\"data-name\", this.frm.doc.name);\n\n\t\tthis.like_count && this.like_count.text(JSON.parse(this.frm.doc._liked_by || \"[]\").length);\n\t}\n\n\trefresh_comments_count() {\n\t\tlet count = (this.frm.get_docinfo().comments || []).length;\n\t\tthis.comments.find(\".comments-count\").html(count);\n\t}\n\n\trefresh_image() {\n\t}\n\n\tmake_review() {\n\t\tconst review_wrapper = this.sidebar.find(\".form-reviews\");\n\t\tif (frappe.boot.energy_points_enabled && !this.frm.is_new()) {\n\t\t\tthis.frm.reviews = new frappe.ui.form.Review({\n\t\t\t\tparent: review_wrapper,\n\t\t\t\tfrm: this.frm\n\t\t\t});\n\t\t} else {\n\t\t\treview_wrapper.remove();\n\t\t}\n\t}\n\n\treload_docinfo(callback) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.desk.form.load.get_docinfo\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\t// docinfo will be synced\n\t\t\t\tif(callback) callback(r.docinfo);\n\t\t\t\tthis.frm.timeline && this.frm.timeline.refresh();\n\t\t\t\tthis.frm.assign_to.refresh();\n\t\t\t\tthis.frm.attachments.refresh();\n\t\t\t}\n\t\t});\n\t}\n\n};\n", "// Copyright (c) 2020, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nclass BaseTimeline {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.timeline_wrapper = $(`<div class=\"new-timeline\">`);\n\t\tthis.wrapper = this.timeline_wrapper;\n\t\tthis.timeline_items_wrapper = $(`<div class=\"timeline-items\">`);\n\t\tthis.timeline_actions_wrapper = $(`\n\t\t\t<div class=\"timeline-items timeline-actions\">\n\t\t\t\t<div class=\"timeline-item\">\n\t\t\t\t\t<div class=\"timeline-dot\"></div>\n\t\t\t\t\t<div class=\"timeline-content action-buttons\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.timeline_wrapper.append(this.timeline_actions_wrapper);\n\t\tthis.timeline_actions_wrapper.hide();\n\t\tthis.timeline_wrapper.append(this.timeline_items_wrapper);\n\n\t\tthis.parent.replaceWith(this.timeline_wrapper);\n\t\tthis.timeline_items = [];\n\t}\n\n\trefresh() {\n\t\tthis.render_timeline_items();\n\t}\n\n\tadd_action_button(label, action, icon=null, btn_class=null) {\n\t\tlet icon_element = icon ? frappe.utils.icon(icon, 'xs') : null;\n\t\tthis.timeline_actions_wrapper.show();\n\t\tlet action_btn = $(`<button class=\"btn btn-xs ${btn_class || 'btn-default'} action-btn\">\n\t\t\t${icon_element}\n\t\t\t${label}\n\t\t</button>`);\n\t\taction_btn.click(action);\n\t\tthis.timeline_actions_wrapper.find('.action-buttons').append(action_btn);\n\t\treturn action_btn;\n\t}\n\n\trender_timeline_items() {\n\t\tthis.timeline_items_wrapper.empty();\n\t\tthis.timeline_items = [];\n\t\tthis.doc_info = this.frm && this.frm.get_docinfo() || {};\n\t\tlet response = this.prepare_timeline_contents();\n\t\tif (response instanceof Promise) {\n\t\t\tresponse.then(() => {\n\t\t\t\tthis.timeline_items.sort((item1, item2) =>  new Date(item2.creation) - new Date(item1.creation));\n\t\t\t\tthis.timeline_items.forEach(this.add_timeline_item.bind(this));\n\t\t\t});\n\t\t} else {\n\t\t\tthis.timeline_items.sort((item1, item2) =>  new Date(item2.creation) - new Date(item1.creation));\n\t\t\tthis.timeline_items.forEach(this.add_timeline_item.bind(this));\n\t\t}\n\t}\n\n\tprepare_timeline_contents() {\n\t\t//\n\t}\n\n\tadd_timeline_item(item, append_at_the_end=false) {\n\t\tlet timeline_item = this.get_timeline_item(item);\n\t\tif (append_at_the_end) {\n\t\t\tthis.timeline_items_wrapper.append(timeline_item);\n\t\t} else {\n\t\t\tthis.timeline_items_wrapper.prepend(timeline_item);\n\t\t}\n\t\treturn timeline_item;\n\t}\n\n\tadd_timeline_items(items, append_at_the_end=false) {\n\t\titems.forEach((item) => this.add_timeline_item(item, append_at_the_end));\n\t}\n\n\tget_timeline_item(item) {\n\t\t// item can have content*, creation*,\n\t\t// timeline_badge, icon, icon_size,\n\t\t// hide_timestamp, is_card\n\t\tconst timeline_item = $(`<div class=\"timeline-item\">`);\n\t\ttimeline_item.attr({\n\t\t\t\"data-doctype\": item.doctype,\n\t\t\t\"data-name\": item.name,\n\t\t});\n\t\tif (item.icon) {\n\t\t\ttimeline_item.append(`\n\t\t\t\t<div class=\"timeline-badge\" title='${item.title || frappe.utils.to_title_case(item.icon)}'>\n\t\t\t\t\t${frappe.utils.icon(item.icon, item.icon_size || 'md')}\n\t\t\t\t</div>\n\t\t\t`);\n\t\t} else if (item.timeline_badge) {\n\t\t\ttimeline_item.append(item.timeline_badge);\n\t\t} else {\n\t\t\ttimeline_item.append(`<div class=\"timeline-dot\">`);\n\t\t}\n\n\t\ttimeline_item.append(`<div class=\"timeline-content ${item.is_card ? 'frappe-card' : ''}\">`);\n\t\tlet timeline_content = timeline_item.find('.timeline-content');\n\t\ttimeline_content.append(item.content);\n\t\tif (!item.hide_timestamp && !item.is_card) {\n\t\t\ttimeline_content.append(`<span> - ${comment_when(item.creation)}</span>`);\n\t\t}\n\t\tif (item.id) {\n\t\t\ttimeline_content.attr(\"id\", item.id);\n\t\t}\n\t\treturn timeline_item;\n\t}\n}\n\nexport default BaseTimeline;", "// REDESIGN-TODO: Review\n\nfunction get_version_timeline_content(version_doc, frm) {\n\tif (!version_doc.data) return [];\n\tconst data = JSON.parse(version_doc.data);\n\n\t// comment\n\tif (data.comment) {\n\t\treturn [get_version_comment(version_doc, data.comment)];\n\t}\n\n\tlet out = [];\n\n\tlet updater_reference_link = null;\n\tlet updater_reference = data.updater_reference;\n\tif (!$.isEmptyObject(updater_reference)) {\n\t\tlet label = updater_reference.label || __('via {0}', [updater_reference.doctype]);\n\t\tlet { doctype, docname } = updater_reference;\n\t\tif (doctype && docname) {\n\t\t\tupdater_reference_link = frappe.utils.get_form_link(\n\t\t\t\tdoctype, docname, true, label);\n\t\t} else {\n\t\t\tupdater_reference_link = label;\n\t\t}\n\t}\n\n\t// value changed in parent\n\tif (data.changed && data.changed.length) {\n\t\tvar parts = [];\n\t\tdata.changed.every(function(p) {\n\t\t\tif (p[0] === 'docstatus') {\n\t\t\t\tif (p[2] === 1) {\n\t\t\t\t\tlet message = updater_reference_link\n\t\t\t\t\t\t? __('{0} submitted this document {1}', [get_user_link(version_doc), updater_reference_link])\n\t\t\t\t\t\t: __('{0} submitted this document', [get_user_link(version_doc)]);\n\t\t\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t\t\t} else if (p[2] === 2) {\n\t\t\t\t\tlet message = updater_reference_link\n\t\t\t\t\t\t? __('{0} cancelled this document {1}', [get_user_link(version_doc), updater_reference_link])\n\t\t\t\t\t\t: __('{0} cancelled this document', [get_user_link(version_doc)]);\n\t\t\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst df = frappe.meta.get_docfield(frm.doctype, p[0], frm.docname);\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tconst field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\tfrm.perm);\n\t\t\t\t\tif (field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\tparts.push(__('{0} from {1} to {2}', [\n\t\t\t\t\t\t\t__(df.label),\n\t\t\t\t\t\t\tformat_content_for_timeline(p[1]),\n\t\t\t\t\t\t\tformat_content_for_timeline(p[2])\n\t\t\t\t\t\t]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn parts.length < 3;\n\t\t});\n\t\tif (parts.length) {\n\t\t\tlet message;\n\t\t\tif (updater_reference_link) {\n\t\t\t\tmessage = __(\"{0} changed value of {1} {2}\", [get_user_link(version_doc), parts.join(', '), updater_reference_link]);\n\t\t\t} else {\n\t\t\t\tmessage = __(\"{0} changed value of {1}\", [get_user_link(version_doc), parts.join(', ')]);\n\t\t\t}\n\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t}\n\t}\n\n\t// value changed in table field\n\tif (data.row_changed && data.row_changed.length) {\n\t\tlet parts = [];\n\t\tdata.row_changed.every(function(row) {\n\t\t\trow[3].every(function(p) {\n\t\t\t\tvar df = frm.fields_dict[row[0]] &&\n\t\t\t\t\tfrappe.meta.get_docfield(frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\tp[0], frm.docname);\n\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df,\n\t\t\t\t\t\tnull, frm.perm);\n\n\t\t\t\t\tif (field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\tparts.push(__('{0} from {1} to {2} in row #{3}', [\n\t\t\t\t\t\t\tfrappe.meta.get_label(frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\t\t\tp[0]),\n\t\t\t\t\t\t\tformat_content_for_timeline(p[1]),\n\t\t\t\t\t\t\tformat_content_for_timeline(p[2]),\n\t\t\t\t\t\t\trow[1]\n\t\t\t\t\t\t]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn parts.length < 3;\n\t\t\t});\n\t\t\treturn parts.length < 3;\n\t\t});\n\t\tif (parts.length) {\n\t\t\tlet message;\n\t\t\tif (updater_reference_link) {\n\t\t\t\tmessage = __(\"{0} changed values for {1} {2}\", [get_user_link(version_doc), parts.join(', '), updater_reference_link]);\n\t\t\t} else {\n\t\t\t\tmessage = __(\"{0} changed values for {1}\", [get_user_link(version_doc), parts.join(', ')]);\n\t\t\t}\n\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t}\n\t}\n\n\t// rows added / removed\n\t// __('added'), __('removed') # for translation, don't remove\n\t['added', 'removed'].forEach(function(key) {\n\t\tif (data[key] && data[key].length) {\n\t\t\tlet parts = (data[key] || []).map(function(p) {\n\t\t\t\tvar df = frappe.meta.get_docfield(frm.doctype, p[0], frm.docname);\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\tfrm.perm);\n\n\t\t\t\t\tif (field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\treturn __(frappe.meta.get_label(frm.doctype, p[0]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tparts = parts.filter(function(p) {\n\t\t\t\treturn p;\n\t\t\t});\n\t\t\tif (parts.length) {\n\t\t\t\tlet message = '';\n\n\t\t\t\tif (key === 'added') {\n\t\t\t\t\tmessage = __(\"added rows for {0}\", [parts.join(', ')]);\n\t\t\t\t} else if (key === 'removed') {\n\t\t\t\t\tmessage = __(\"removed rows for {0}\", [parts.join(', ')]);\n\t\t\t\t}\n\n\t\t\t\tlet version_comment = get_version_comment(version_doc, message);\n\t\t\t\tlet user_link = get_user_link(version_doc);\n\t\t\t\tout.push(`${user_link} ${version_comment}`);\n\t\t\t}\n\t\t}\n\t});\n\n\treturn out;\n}\n\n\nfunction get_version_comment(version_doc, text) {\n\t// TODO: Replace with a better solution\n\tif (text.includes(\"<a\")) {\n\t\t// if text already has linked content in it\n\t\t// then just add a version link to unlinked content\n\t\tlet version_comment = \"\";\n\t\tlet unlinked_content = \"\";\n\n\t\ttry {\n\t\t\ttext += '</>';\n\t\t\tArray.from($(text)).forEach(element => {\n\t\t\t\tif ($(element).is('a')) {\n\t\t\t\t\tversion_comment += unlinked_content ? frappe.utils.get_form_link('Version', version_doc.name, true, unlinked_content) : \"\";\n\t\t\t\t\tunlinked_content = \"\";\n\t\t\t\t\tversion_comment += element.outerHTML;\n\t\t\t\t} else {\n\t\t\t\t\tunlinked_content += element.outerHTML || element.textContent;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (unlinked_content) {\n\t\t\t\tversion_comment += frappe.utils.get_form_link('Version', version_doc.name, true, unlinked_content);\n\t\t\t}\n\t\t\treturn version_comment;\n\t\t} catch (e) {\n\t\t\t// pass\n\t\t}\n\t}\n\treturn frappe.utils.get_form_link('Version', version_doc.name, true, text);\n}\n\nfunction format_content_for_timeline(content) {\n\t// text to HTML\n\t// limits content to 40 characters\n\t// escapes HTML\n\t// and makes it bold\n\tcontent = frappe.utils.html2text(content);\n\tcontent = frappe.ellipsis(content, 40) || '\"\"';\n\tcontent = frappe.utils.escape_html(content);\n\treturn content.bold();\n}\n\nfunction get_user_link(doc) {\n\tconst user = doc.owner;\n\tconst user_display_text = (frappe.user_info(user).fullname || '').bold();\n\treturn frappe.utils.get_form_link('User', user, true, user_display_text);\n}\n\nexport { get_version_timeline_content };\n\n", "// Copyright (c) 2020, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport BaseTimeline from \"./base_timeline\";\nimport { get_version_timeline_content } from \"./version_timeline_content_builder\";\n\nclass FormTimeline extends BaseTimeline {\n\n\tmake() {\n\t\tsuper.make();\n\t\tthis.setup_timeline_actions();\n\t\tthis.render_timeline_items();\n\t\tthis.setup_activity_toggle();\n\t}\n\n\trefresh() {\n\t\tsuper.refresh();\n\t\tthis.frm.trigger('timeline_refresh');\n\t\tthis.setup_document_email_link();\n\t}\n\n\tsetup_timeline_actions() {\n\t\tthis.add_action_button(__('New Email'), () => this.compose_mail(), 'mail', 'btn-secondary-dark');\n\t\tthis.setup_new_event_button();\n\t}\n\n\tsetup_new_event_button() {\n\t\tif (this.frm.meta.allow_events_in_timeline) {\n\t\t\tlet create_event = () => {\n\t\t\t\tconst args = {\n\t\t\t\t\tdoc: this.frm.doc,\n\t\t\t\t\tfrm: this.frm,\n\t\t\t\t\trecipients: this.get_recipient(),\n\t\t\t\t\ttxt: frappe.markdown(this.frm.comment_box.get_value())\n\t\t\t\t};\n\t\t\t\treturn new frappe.views.InteractionComposer(args);\n\t\t\t};\n\t\t\tthis.add_action_button(__('New Event'), create_event, 'calendar');\n\t\t}\n\t}\n\n\tsetup_activity_toggle() {\n\t\tlet doc_info = this.doc_info || this.frm.get_docinfo();\n\t\tlet has_communications = () => {\n\t\t\tlet communications = doc_info.communications;\n\t\t\tlet comments = doc_info.comments;\n\t\t\treturn (communications || []).length || (comments || []).length;\n\t\t};\n\t\tlet me = this;\n\t\tif (has_communications()) {\n\t\t\tthis.timeline_wrapper.prepend(`\n\t\t\t\t<div class=\"timeline-item activity-toggle\">\n\t\t\t\t\t<div class=\"timeline-dot\"></div>\n\t\t\t\t\t<div class=\"timeline-content flex align-center\">\n\t\t\t\t\t\t<h4>${__('Activity')}</h4>\n\t\t\t\t\t\t<nav class=\"nav nav-pills flex-row\">\n\t\t\t\t\t\t\t<a class=\"flex-sm-fill text-sm-center nav-link\" data-only-communication=\"true\">${__('Communication')}</a>\n\t\t\t\t\t\t\t<a class=\"flex-sm-fill text-sm-center nav-link active\">${__('All')}</a>\n\t\t\t\t\t\t</nav>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`).find('a').on('click', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tme.only_communication = $(this).data().onlyCommunication;\n\t\t\t\tme.render_timeline_items();\n\t\t\t\t$(this).tab('show');\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_document_email_link() {\n\t\tlet doc_info = this.doc_info || this.frm.get_docinfo();\n\n\t\tthis.document_email_link_wrapper && this.document_email_link_wrapper.remove();\n\n\t\tif (doc_info.document_email) {\n\t\t\tconst link = `<a class=\"document-email-link\">${doc_info.document_email}</a>`;\n\t\t\tconst message = __(\"Add to this activity by mailing to {0}\", [link.bold()]);\n\n\t\t\tthis.document_email_link_wrapper = $(`\n\t\t\t\t<div class=\"timeline-item\">\n\t\t\t\t\t<div class=\"timeline-dot\"></div>\n\t\t\t\t\t<div class=\"timeline-content\">\n\t\t\t\t\t\t<span>${message}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.timeline_actions_wrapper.append(this.document_email_link_wrapper);\n\n\t\t\tthis.document_email_link_wrapper\n\t\t\t\t.find('.document-email-link')\n\t\t\t\t.on(\"click\", e => {\n\t\t\t\t\tlet text = $(e.target).text();\n\t\t\t\t\tfrappe.utils.copy_to_clipboard(text);\n\t\t\t\t});\n\t\t}\n\t}\n\n\trender_timeline_items() {\n\t\tsuper.render_timeline_items();\n\t\tthis.set_document_info();\n\t\tfrappe.utils.bind_actions_with_object(this.timeline_items_wrapper, this);\n\t}\n\n\tset_document_info() {\n\t\t// TODO: handle creation via automation\n\t\tconst creation = comment_when(this.frm.doc.creation);\n\t\tlet creation_message =\n\t\t\tfrappe.utils.is_current_user(this.frm.doc.owner)\n\t\t\t\t? __(\"You created this {0}\", [creation], \"Form timeline\")\n\t\t\t\t: __(\"{0} created this {1}\",\n\t\t\t\t\t[\n\t\t\t\t\t\tthis.get_user_link(this.frm.doc.owner),\n\t\t\t\t\t\tcreation\n\t\t\t\t\t],\n\t\t\t\t\t\"Form timeline\"\n\t\t\t\t);\n\n\t\tconst modified = comment_when(this.frm.doc.modified);\n\t\tlet modified_message =\n\t\t\tfrappe.utils.is_current_user(this.frm.doc.modified_by)\n\t\t\t\t? __(\"You edited this {0}\", [modified], \"Form timeline\")\n\t\t\t\t: __(\"{0} edited this {1}\",\n\t\t\t\t\t[\n\t\t\t\t\t\tthis.get_user_link(this.frm.doc.modified_by),\n\t\t\t\t\t\tmodified\n\t\t\t\t\t],\n\t\t\t\t\t\"Form timeline\"\n\t\t\t\t);\n\n\t\tif (this.frm.doc.route && cint(frappe.boot.website_tracking_enabled)) {\n\t\t\tlet route = this.frm.doc.route;\n\t\t\tfrappe.utils.get_page_view_count(route).then((res) => {\n\t\t\t\tlet page_view_count_message = __('{0} Page views', [res.message], \"Form timeline\");\n\t\t\t\tthis.add_timeline_item({\n\t\t\t\t\tcontent: `${creation_message} \u2022 ${modified_message} \u2022 \t${page_view_count_message}`,\n\t\t\t\t\thide_timestamp: true\n\t\t\t\t}, true);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.add_timeline_item({\n\t\t\t\tcontent: `${creation_message} \u2022 ${modified_message}`,\n\t\t\t\thide_timestamp: true\n\t\t\t}, true);\n\t\t}\n\t}\n\n\tprepare_timeline_contents() {\n\t\tthis.timeline_items.push(...this.get_communication_timeline_contents());\n\t\tthis.timeline_items.push(...this.get_auto_messages_timeline_contents());\n\t\tthis.timeline_items.push(...this.get_comment_timeline_contents());\n\t\tif (!this.only_communication) {\n\t\t\tthis.timeline_items.push(...this.get_view_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_energy_point_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_version_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_share_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_workflow_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_like_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_custom_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_assignment_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_attachment_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_info_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_milestone_timeline_contents());\n\t\t}\n\t}\n\n\tget_user_link(user) {\n\t\tconst user_display_text = (frappe.user_info(user).fullname || '').bold();\n\t\treturn frappe.utils.get_form_link('User', user, true, user_display_text);\n\t}\n\n\tget_view_timeline_contents() {\n\t\tlet view_timeline_contents = [];\n\t\t(this.doc_info.views || []).forEach(view => {\n\t\t\tconst view_time = comment_when(view.creation);\n\t\t\tlet view_message = frappe.utils.is_current_user(view.owner)\n\t\t\t\t? __(\"You viewed this {0}\", [view_time], \"Form timeline\")\n\t\t\t\t: __(\"{0} viewed this {1}\",\n\t\t\t\t\t[\n\t\t\t\t\t\tthis.get_user_link(view.owner),\n\t\t\t\t\t\tview_time\n\t\t\t\t\t],\n\t\t\t\t\t\"Form timeline\"\n\t\t\t\t);\n\n\t\t\tview_timeline_contents.push({\n\t\t\t\tcreation: view.creation,\n\t\t\t\tcontent: view_message,\n\t\t\t\thide_timestamp: true,\n\t\t\t});\n\t\t});\n\t\treturn view_timeline_contents;\n\t}\n\n\tget_communication_timeline_contents() {\n\t\tlet communication_timeline_contents = [];\n\t\tlet icon_set = {Email: \"mail\", Phone: \"call\", Meeting: \"calendar\", Other: \"dot-horizontal\"};\n\t\t(this.doc_info.communications|| []).forEach(communication => {\n\t\t\tlet medium = communication.communication_medium;\n\t\t\tcommunication_timeline_contents.push({\n\t\t\t\ticon: icon_set[medium],\n\t\t\t\ticon_size: 'sm',\n\t\t\t\tcreation: communication.creation,\n\t\t\t\tis_card: true,\n\t\t\t\tcontent: this.get_communication_timeline_content(communication),\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tid: `communication-${communication.name}`,\n\t\t\t\tname: communication.name\n\t\t\t});\n\t\t});\n\t\treturn communication_timeline_contents;\n\t}\n\n\tget_communication_timeline_content(doc, allow_reply=true) {\n\t\tdoc._url = frappe.utils.get_form_link(\"Communication\", doc.name);\n\t\tthis.set_communication_doc_status(doc);\n\t\tif (doc.attachments && typeof doc.attachments === \"string\") {\n\t\t\tdoc.attachments = JSON.parse(doc.attachments);\n\t\t}\n\t\tdoc.owner = doc.sender;\n\t\tdoc.user_full_name = doc.sender_full_name;\n\t\tdoc.content = frappe.dom.remove_script_and_style(doc.content);\n\t\tlet communication_content = $(frappe.render_template('timeline_message_box', { doc }));\n\t\tif (allow_reply) {\n\t\t\tthis.setup_reply(communication_content, doc);\n\t\t}\n\t\treturn communication_content;\n\t}\n\n\tset_communication_doc_status(doc) {\n\t\tlet indicator_color = \"red\";\n\t\tif (in_list([\"Sent\", \"Clicked\"], doc.delivery_status)) {\n\t\t\tindicator_color = \"green\";\n\t\t} else if (doc.delivery_status === \"Sending\") {\n\t\t\tindicator_color = \"orange\";\n\t\t} else if (in_list([\"Opened\", \"Read\"], doc.delivery_status)) {\n\t\t\tindicator_color = \"blue\";\n\t\t} else if (doc.delivery_status == \"Error\") {\n\t\t\tindicator_color = \"red\";\n\t\t}\n\t\tdoc._doc_status = doc.delivery_status;\n\t\tdoc._doc_status_indicator = indicator_color;\n\t}\n\n\tget_auto_messages_timeline_contents() {\n\t\tlet auto_messages_timeline_contents = [];\n\t\t(this.doc_info.automated_messages|| []).forEach(message => {\n\t\t\tauto_messages_timeline_contents.push({\n\t\t\t\ticon: 'notification',\n\t\t\t\ticon_size: 'sm',\n\t\t\t\tcreation: message.creation,\n\t\t\t\tis_card: true,\n\t\t\t\tcontent: this.get_communication_timeline_content(message, false),\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tname: message.name\n\t\t\t});\n\t\t});\n\t\treturn auto_messages_timeline_contents;\n\t}\n\n\tget_comment_timeline_contents() {\n\t\tlet comment_timeline_contents = [];\n\t\t(this.doc_info.comments || []).forEach(comment => {\n\t\t\tcomment_timeline_contents.push(this.get_comment_timeline_item(comment));\n\t\t});\n\t\treturn comment_timeline_contents;\n\t}\n\n\tget_comment_timeline_item(comment) {\n\t\treturn {\n\t\t\ticon: 'small-message',\n\t\t\tcreation: comment.creation,\n\t\t\tis_card: true,\n\t\t\tdoctype: \"Comment\",\n\t\t\tid: `comment-${comment.name}`,\n\t\t\tname: comment.name,\n\t\t\tcontent: this.get_comment_timeline_content(comment),\n\t\t};\n\t}\n\n\tget_comment_timeline_content(doc) {\n\t\tdoc.content = frappe.dom.remove_script_and_style(doc.content);\n\t\tconst comment_content = $(frappe.render_template('timeline_message_box', { doc }));\n\t\tthis.setup_comment_actions(comment_content, doc);\n\t\treturn comment_content;\n\t}\n\n\tget_version_timeline_contents() {\n\t\tlet version_timeline_contents = [];\n\t\t(this.doc_info.versions || []).forEach(version => {\n\t\t\tconst contents = get_version_timeline_content(version, this.frm);\n\t\t\tcontents.forEach((content) => {\n\t\t\t\tversion_timeline_contents.push({\n\t\t\t\t\tcreation: version.creation,\n\t\t\t\t\tcontent: content,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\treturn version_timeline_contents;\n\t}\n\n\tget_share_timeline_contents() {\n\t\tlet share_timeline_contents = [];\n\t\t(this.doc_info.share_logs || []).forEach(share_log => {\n\t\t\tshare_timeline_contents.push({\n\t\t\t\tcreation: share_log.creation,\n\t\t\t\tcontent: share_log.content,\n\t\t\t});\n\t\t});\n\t\treturn share_timeline_contents;\n\t}\n\n\tget_assignment_timeline_contents() {\n\t\tlet assignment_timeline_contents = [];\n\t\t(this.doc_info.assignment_logs || []).forEach(assignment_log => {\n\t\t\tassignment_timeline_contents.push({\n\t\t\t\tcreation: assignment_log.creation,\n\t\t\t\tcontent: assignment_log.content,\n\t\t\t});\n\t\t});\n\t\treturn assignment_timeline_contents;\n\t}\n\n\tget_info_timeline_contents() {\n\t\tlet info_timeline_contents = [];\n\t\t(this.doc_info.info_logs || []).forEach(info_log => {\n\t\t\tinfo_timeline_contents.push({\n\t\t\t\tcreation: info_log.creation,\n\t\t\t\tcontent: `${this.get_user_link(info_log.owner)} ${info_log.content}`,\n\t\t\t});\n\t\t});\n\t\treturn info_timeline_contents;\n\t}\n\n\tget_attachment_timeline_contents() {\n\t\tlet attachment_timeline_contents = [];\n\t\t(this.doc_info.attachment_logs || []).forEach(attachment_log => {\n\t\t\tlet is_file_upload = attachment_log.comment_type == 'Attachment';\n\t\t\tattachment_timeline_contents.push({\n\t\t\t\ticon: is_file_upload ? 'upload' : 'delete',\n\t\t\t\ticon_size: 'sm',\n\t\t\t\tcreation: attachment_log.creation,\n\t\t\t\tcontent: `${this.get_user_link(attachment_log.owner)} ${attachment_log.content}`,\n\t\t\t});\n\t\t});\n\t\treturn attachment_timeline_contents;\n\t}\n\n\tget_milestone_timeline_contents() {\n\t\tlet milestone_timeline_contents = [];\n\t\t(this.doc_info.milestones || []).forEach(milestone_log => {\n\t\t\tmilestone_timeline_contents.push({\n\t\t\t\ticon: 'milestone',\n\t\t\t\tcreation: milestone_log.creation,\n\t\t\t\tcontent: __('{0} changed {1} to {2}', [\n\t\t\t\t\tthis.get_user_link(milestone_log.owner),\n\t\t\t\t\tfrappe.meta.get_label(this.frm.doctype, milestone_log.track_field),\n\t\t\t\t\tmilestone_log.value.bold()]),\n\t\t\t});\n\t\t});\n\t\treturn milestone_timeline_contents;\n\t}\n\n\tget_like_timeline_contents() {\n\t\tlet like_timeline_contents = [];\n\t\t(this.doc_info.like_logs || []).forEach(like_log => {\n\t\t\tlike_timeline_contents.push({\n\t\t\t\ticon: 'heart',\n\t\t\t\ticon_size: 'sm',\n\t\t\t\tcreation: like_log.creation,\n\t\t\t\tcontent: __('{0} Liked', [this.get_user_link(like_log.owner)]),\n\t\t\t\ttitle: \"Like\",\n\t\t\t});\n\t\t});\n\t\treturn like_timeline_contents;\n\t}\n\n\tget_workflow_timeline_contents() {\n\t\tlet workflow_timeline_contents = [];\n\t\t(this.doc_info.workflow_logs || []).forEach(workflow_log => {\n\t\t\tworkflow_timeline_contents.push({\n\t\t\t\ticon: 'branch',\n\t\t\t\ticon_size: 'sm',\n\t\t\t\tcreation: workflow_log.creation,\n\t\t\t\tcontent: `${this.get_user_link(workflow_log.owner)} ${__(workflow_log.content)}`,\n\t\t\t\ttitle: \"Workflow\",\n\t\t\t});\n\t\t});\n\t\treturn workflow_timeline_contents;\n\t}\n\n\tget_custom_timeline_contents() {\n\t\tlet custom_timeline_contents = [];\n\t\t(this.doc_info.additional_timeline_content || []).forEach(custom_item => {\n\t\t\tcustom_timeline_contents.push({\n\t\t\t\ticon: custom_item.icon,\n\t\t\t\ticon_size: 'sm',\n\t\t\t\tis_card: custom_item.is_card,\n\t\t\t\tcreation: custom_item.creation,\n\t\t\t\tcontent: custom_item.content || frappe.render_template(custom_item.template, custom_item.template_data),\n\t\t\t});\n\t\t});\n\t\treturn custom_timeline_contents;\n\t}\n\n\tget_energy_point_timeline_contents() {\n\t\tlet energy_point_timeline_contents = [];\n\t\t(this.doc_info.energy_point_logs || []).forEach(log => {\n\t\t\tlet timeline_badge = `\n\t\t\t<div class=\"timeline-badge ${log.points > 0 ? 'appreciation': 'criticism'} bold\">\n\t\t\t\t${log.points}\n\t\t\t</div>`;\n\n\t\t\tenergy_point_timeline_contents.push({\n\t\t\t\ttimeline_badge: timeline_badge,\n\t\t\t\tcreation: log.creation,\n\t\t\t\tcontent: frappe.energy_points.format_form_log(log)\n\t\t\t});\n\t\t});\n\t\treturn energy_point_timeline_contents;\n\t}\n\n\tsetup_reply(communication_box, communication_doc) {\n\t\tlet actions = communication_box.find('.custom-actions');\n\t\tlet reply = $(`<a class=\"action-btn reply\">${frappe.utils.icon('reply', 'md')}</a>`).click(() => {\n\t\t\tthis.compose_mail(communication_doc);\n\t\t});\n\t\tlet reply_all = $(`<a class=\"action-btn reply-all\">${frappe.utils.icon('reply-all', 'md')}</a>`).click(() => {\n\t\t\tthis.compose_mail(communication_doc, true);\n\t\t});\n\t\tactions.append(reply);\n\t\tactions.append(reply_all);\n\t}\n\n\tcompose_mail(communication_doc=null, reply_all=false) {\n\t\tconst args = {\n\t\t\tdoc: this.frm.doc,\n\t\t\tfrm: this.frm,\n\t\t\trecipients: communication_doc && communication_doc.sender != frappe.session.user_email ? communication_doc.sender : this.get_recipient(),\n\t\t\tis_a_reply: Boolean(communication_doc),\n\t\t\ttitle: communication_doc ? __('Reply') : null,\n\t\t\tlast_email: communication_doc,\n\t\t\tsubject: communication_doc && communication_doc.subject\n\t\t};\n\n\t\tif (communication_doc && reply_all) {\n\t\t\targs.cc = communication_doc.cc;\n\t\t\targs.bcc = communication_doc.bcc;\n\t\t}\n\n\t\tif (this.frm.doctype === \"Communication\") {\n\t\t\targs.message = \"\";\n\t\t\targs.last_email = this.frm.doc;\n\t\t\targs.recipients = this.frm.doc.sender;\n\t\t\targs.subject = __(\"Re: {0}\", [this.frm.doc.subject]);\n\t\t} else {\n\t\t\tconst comment_value = frappe.markdown(this.frm.comment_box.get_value());\n\t\t\targs.message = strip_html(comment_value) ? comment_value : '';\n\t\t}\n\n\t\tnew frappe.views.CommunicationComposer(args);\n\t}\n\n\tget_recipient() {\n\t\tif (this.frm.email_field) {\n\t\t\treturn this.frm.doc[this.frm.email_field];\n\t\t} else {\n\t\t\treturn this.frm.doc.email_id || this.frm.doc.email || \"\";\n\t\t}\n\t}\n\n\tsetup_comment_actions(comment_wrapper, doc) {\n\t\tlet edit_wrapper = $(`<div class=\"comment-edit-box\">`).hide();\n\t\tlet edit_box = this.make_editable(edit_wrapper);\n\t\tlet content_wrapper = comment_wrapper.find('.content');\n\t\tlet more_actions_wrapper = comment_wrapper.find('.more-actions');\n\t\tif (frappe.model.can_delete(\"Comment\") && (\n\t\t\tfrappe.session.user == doc.owner ||\n\t\t\tfrappe.user.has_role(\"System Manager\")\n\t\t)) {\n\t\t\tconst delete_option = $(`\n\t\t\t\t<li>\n\t\t\t\t\t<a class=\"dropdown-item\">\n\t\t\t\t\t\t${__(\"Delete\")}\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t`).click(() => this.delete_comment(doc.name));\n\t\t\tmore_actions_wrapper.find('.dropdown-menu').append(delete_option);\n\t\t}\n\n\t\tlet dismiss_button = $(`\n\t\t\t<button class=\"btn btn-link action-btn\">\n\t\t\t\t${__('Dismiss')}\n\t\t\t</button>\n\t\t`).click(() => edit_button.toggle_edit_mode());\n\t\tdismiss_button.hide();\n\n\t\tedit_box.set_value(doc.content);\n\n\t\tedit_box.on_submit = (value) => {\n\t\t\tcontent_wrapper.empty();\n\t\t\tcontent_wrapper.append(value);\n\t\t\tedit_button.prop(\"disabled\", true);\n\t\t\tedit_box.quill.enable(false);\n\n\t\t\tdoc.content = value;\n\t\t\tthis.update_comment(doc.name, value)\n\t\t\t\t.then(edit_button.toggle_edit_mode)\n\t\t\t\t.finally(() => {\n\t\t\t\t\tedit_button.prop(\"disabled\", false);\n\t\t\t\t\tedit_box.quill.enable(true);\n\t\t\t\t});\n\t\t};\n\n\t\tcontent_wrapper.after(edit_wrapper);\n\n\t\tlet edit_button = $();\n\t\tlet current_user = frappe.session.user;\n\t\tif (['Administrator', doc.owner].includes(current_user)) {\n\t\t\tedit_button = $(`<button class=\"btn btn-link action-btn\">${__(\"Edit\")}</a>`).click(() => {\n\t\t\t\tedit_button.edit_mode ? edit_box.submit() : edit_button.toggle_edit_mode();\n\t\t\t});\n\t\t}\n\n\t\tedit_button.toggle_edit_mode = () => {\n\t\t\tedit_button.edit_mode = !edit_button.edit_mode;\n\t\t\tedit_button.text(edit_button.edit_mode ? __('Save') : __('Edit'));\n\t\t\tmore_actions_wrapper.toggle(!edit_button.edit_mode);\n\t\t\tdismiss_button.toggle(edit_button.edit_mode);\n\t\t\tedit_wrapper.toggle(edit_button.edit_mode);\n\t\t\tcontent_wrapper.toggle(!edit_button.edit_mode);\n\t\t};\n\t\tlet actions_wrapper = comment_wrapper.find('.custom-actions');\n\t\tactions_wrapper.append(edit_button);\n\t\tactions_wrapper.append(dismiss_button);\n\t}\n\n\tmake_editable(container) {\n\t\treturn frappe.ui.form.make_control({\n\t\t\tparent: container,\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Comment',\n\t\t\t\tfieldname: 'comment',\n\t\t\t\tlabel: 'Comment'\n\t\t\t},\n\t\t\tenable_mentions: true,\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\tno_wrapper: true\n\t\t});\n\t}\n\n\tupdate_comment(name, content) {\n\t\treturn frappe.xcall('frappe.desk.form.utils.update_comment', { name, content })\n\t\t\t.then(() => {\n\t\t\t\tfrappe.utils.play_sound('click');\n\t\t\t});\n\t}\n\n\tget_last_email(from_recipient) {\n\t\tlet last_email = null;\n\t\tlet communications = this.frm.get_docinfo().communications || [];\n\t\tlet email = this.get_recipient();\n\t\t// REDESIGN TODO: What is this? Check again\n\t\t(communications.sort((a, b) =>  a.creation > b.creation ? -1 : 1 )).forEach(c => {\n\t\t\tif (c.communication_type === 'Communication' && c.communication_medium === \"Email\") {\n\t\t\t\tif (from_recipient) {\n\t\t\t\t\tif (c.sender.indexOf(email)!==-1) {\n\t\t\t\t\t\tlast_email = c;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlast_email = c;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t});\n\n\t\treturn last_email;\n\t}\n\n\tdelete_comment(comment_name) {\n\t\tfrappe.confirm(__('Delete comment?'), () => {\n\t\t\treturn frappe.xcall(\"frappe.client.delete\", {\n\t\t\t\tdoctype: \"Comment\",\n\t\t\t\tname: comment_name\n\t\t\t}).then(() => {\n\t\t\t\tfrappe.utils.play_sound(\"delete\");\n\t\t\t});\n\t\t});\n\t}\n\n\tcopy_link(ev) {\n\t\tlet doc_link = frappe.urllib.get_full_url(\n\t\t\tfrappe.utils.get_form_link(this.frm.doctype, this.frm.docname)\n\t\t);\n\t\tlet element_id = $(ev.currentTarget).closest(\".timeline-content\").attr(\"id\");\n\t\tfrappe.utils.copy_to_clipboard(`${doc_link}#${element_id}`);\n\t}\n}\n\nexport default FormTimeline;\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport FormTimeline from \"./form_timeline\";\nfrappe.ui.form.Footer = class FormFooter {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.make_comment_box();\n\t\tthis.make_timeline();\n\t\t// render-complete\n\t\t$(this.frm.wrapper).on(\"render_complete\", () => {\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\tmake() {\n\t\tthis.wrapper = $(frappe.render_template(\"form_footer\", {}))\n\t\t\t.appendTo(this.parent);\n\t\tthis.wrapper.find(\".btn-save\").click(() => {\n\t\t\tthis.frm.save('Save', null, this);\n\t\t});\n\t}\n\tmake_comment_box() {\n\t\tthis.frm.comment_box = frappe.ui.form.make_control({\n\t\t\tparent: this.wrapper.find(\".comment-box\"),\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\tenable_mentions: true,\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Comment',\n\t\t\t\tfieldname: 'comment'\n\t\t\t},\n\t\t\ton_submit: (comment) => {\n\t\t\t\tif (strip_html(comment).trim() != \"\" || comment.includes('img')) {\n\t\t\t\t\tthis.frm.comment_box.disable();\n\t\t\t\t\tfrappe.xcall(\"frappe.desk.form.utils.add_comment\", {\n\t\t\t\t\t\treference_doctype: this.frm.doctype,\n\t\t\t\t\t\treference_name: this.frm.docname,\n\t\t\t\t\t\tcontent: comment,\n\t\t\t\t\t\tcomment_email: frappe.session.user,\n\t\t\t\t\t\tcomment_by: frappe.session.user_fullname\n\t\t\t\t\t}).then((comment) => {\n\t\t\t\t\t\tlet comment_item = this.frm.timeline.get_comment_timeline_item(comment);\n\t\t\t\t\t\tthis.frm.comment_box.set_value('');\n\t\t\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t\t\t\tthis.frm.timeline.add_timeline_item(comment_item);\n\t\t\t\t\t\tthis.frm.sidebar.refresh_comments_count && this.frm.sidebar.refresh_comments_count();\n\t\t\t\t\t}).finally(() => {\n\t\t\t\t\t\tthis.frm.comment_box.enable();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\tmake_timeline() {\n\t\tthis.frm.timeline = new FormTimeline({\n\t\t\tparent: this.wrapper.find(\".timeline\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t}\n\trefresh() {\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.parent.addClass(\"hide\");\n\t\t} else {\n\t\t\tthis.parent.removeClass(\"hide\");\n\t\t\tthis.frm.timeline.refresh();\n\t\t}\n\t}\n};\n", "frappe.ui.form.FormTour = class FormTour {\n\tconstructor({ frm }) {\n\t\tthis.frm = frm;\n\t\tthis.driver_steps = [];\n\t}\n\n\tinit_driver() {\n\t\tthis.driver = new frappe.Driver({\n\t\t\tclassName: 'frappe-driver',\n\t\t\tallowClose: false,\n\t\t\tpadding: 10,\n\t\t\toverlayClickNext: true,\n\t\t\tkeyboardControl: true,\n\t\t\tnextBtnText: 'Next',\n\t\t\tprevBtnText: 'Previous',\n\t\t\topacity: 0.25,\n\t\t\tonHighlighted: (step) => {\n\t\t\t\t// if last step is to save, then attach a listener to save button\n\t\t\t\tif (step.options.is_save_step) {\n\t\t\t\t\t$(step.options.element).one('click', () => this.driver.reset());\n\t\t\t\t\tthis.driver.overlay.refresh();\n\t\t\t\t}\n\n\t\t\t\t// focus on input\n\t\t\t\tconst $input = $(step.node).find('input').get(0);\n\t\t\t\tif ($input)\n\t\t\t\t\tfrappe.utils.sleep(200).then(() => $input.focus());\n\t\t\t}\n\t\t});\n\n\t\tfrappe.router.on('change', () => this.driver.reset());\n\t\tthis.frm.layout.sections.forEach(section => section.collapse(false));\n\t}\n\n\tasync init({ tour_name, on_finish }) {\n\t\tif (tour_name) {\n\t\t\tthis.tour = await frappe.db.get_doc('Form Tour', tour_name);\n\t\t} else {\n\t\t\tconst doctype_tour_exists = await frappe.db.exists('Form Tour', this.frm.doctype);\n\t\t\tif (doctype_tour_exists) {\n\t\t\t\tthis.tour = await frappe.db.get_doc('Form Tour', this.frm.doctype);\n\t\t\t} else {\n\t\t\t\tthis.tour = { steps: frappe.tour[this.frm.doctype] };\n\t\t\t}\n\t\t}\n\n\t\tif (on_finish) this.on_finish = on_finish;\n\n\t\tthis.init_driver();\n\t\tif (this.tour.include_name_field)\n\t\t\tthis.include_name_field();\n\t\tthis.build_steps();\n\t\tthis.update_driver_steps();\n\t}\n\n\tinclude_name_field() {\n\t\tconst name_step = {\n\t\t\t\"description\": __(\"Enter a name for this {0}\", [this.frm.doctype]),\n\t\t\t\"fieldname\": \"__newname\",\n\t\t\t\"title\": __(\"Document Name\"),\n\t\t\t\"position\": \"right\",\n\t\t\t\"is_table_field\": 0\n\t\t};\n\t\tthis.tour.steps.unshift(name_step);\n\t}\n\n\tbuild_steps() {\n\t\tthis.driver_steps = [];\n\t\tthis.tour.steps.forEach((step) => {\n\t\t\tconst on_next = () => {\n\t\t\t\tif (!this.is_next_condition_satisfied(step)) {\n\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t}\n\n\t\t\t\tif (!this.driver.hasNextStep()) {\n\t\t\t\t\tthis.on_finish && this.on_finish();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst driver_step = this.get_step(step, on_next);\n\t\t\tthis.driver_steps.push(driver_step);\n\n\t\t\tif (step.fieldtype == 'Table') this.handle_table_step(step);\n\t\t\tif (step.is_table_field) this.handle_child_table_step(step);\n\t\t\tif (step.fieldtype == 'Attach Image') this.handle_attach_image_steps(step);\n\t\t});\n\n\t\tif (this.tour.save_on_complete) {\n\t\t\tthis.add_step_to_save();\n\t\t}\n\t}\n\n\tis_next_condition_satisfied(step) {\n\t\tconst form = step.is_table_field ? this.frm.cur_grid.grid_form : this.frm;\n\t\treturn form.layout.evaluate_depends_on_value(step.next_step_condition || true);\n\t}\n\n\tget_step(step_info, on_next) {\n\t\tconst { name, fieldname, title, description, position, is_table_field } = step_info;\n\t\tlet element = `.frappe-control[data-fieldname='${fieldname}']`;\n\n\t\tconst field = this.frm.get_field(fieldname);\n\t\tif (field) {\n\t\t\t// wrapper for section breaks returns in a list\n\t\t\telement = field.wrapper[0] ? field.wrapper[0] : field.wrapper;\n\t\t}\n\n\t\tif (is_table_field) {\n\t\t\t// TODO: fix wrapper for grid sections\n\t\t\telement = `.grid-row-open .frappe-control[data-fieldname='${fieldname}']`;\n\t\t}\n\n\t\treturn {\n\t\t\telement,\n\t\t\tname,\n\t\t\tpopover: { title, description, position: frappe.router.slug(position || 'Bottom') },\n\t\t\tonNext: on_next\n\t\t};\n\t}\n\n\tupdate_driver_steps(steps = []) {\n\t\tif (steps.length == 0) {\n\t\t\tsteps = this.driver_steps;\n\t\t}\n\t\tthis.driver.defineSteps(steps);\n\t}\n\n\tstart(idx = 0) {\n\t\tif (this.driver_steps.length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis.driver.start(idx);\n\t}\n\n\tget_next_step() {\n\t\t// returns the next step only if driver is active\n\t\tif (this.driver.isActivated & this.driver.hasNextStep()) {\n\t\t\tconst current_step = this.driver.currentStep;\n\t\t\treturn this.driver.steps[current_step + 1];\n\t\t}\n\t\treturn;\n\t}\n\n\thandle_table_step(step_info) {\n\t\tconst is_last_step = step_info.idx == this.tour.steps.length;\n\n\t\tif (!is_last_step) {\n\t\t\t// if next step field is inside currently highlighted table field\n\t\t\t// then check if there is a row -> if not, then prompt to add row\n\t\t\t// then edit the first row and hightlight next step\n\n\t\t\tconst curr_step = step_info;\n\t\t\tconst next_step = this.tour.steps[curr_step.idx];\n\t\t\tconst is_next_field_in_curr_table = next_step.parent_fieldname == curr_step.fieldname;\n\n\t\t\tif (!is_next_field_in_curr_table) return;\n\n\t\t\tconst rows = this.frm.doc[curr_step.fieldname];\n\t\t\tconst table_has_rows = rows && rows.length > 0;\n\t\t\tif (table_has_rows) {\n\t\t\t\t// table already has rows\n\t\t\t\t// then just edit the first one on next step\n\t\t\t\tconst curr_driver_step = this.driver_steps.find(s => s.name == curr_step.name);\n\t\t\t\tcurr_driver_step.onNext = () => {\n\t\t\t\t\tif (this.is_next_condition_satisfied(curr_step)) {\n\t\t\t\t\t\tthis.expand_row_and_proceed(curr_step, curr_step.idx);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.update_driver_steps();\n\n\t\t\t} else {\n\t\t\t\tthis.add_new_row_step(curr_step);\n\t\t\t}\n\t\t}\n\t}\n\n\tadd_new_row_step(step) {\n\t\tconst $add_row = `.frappe-control[data-fieldname='${step.fieldname}'] .grid-add-row`;\n\t\tconst add_row_step = {\n\t\t\telement: $add_row,\n\t\t\tpopover: { title: __(\"Add a Row\"), description: \"\" },\n\t\t\tonNext: () => {\n\t\t\t\tif (!cur_frm.cur_grid) {\n\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tthis.driver_steps.push(add_row_step);\n\n\t\t// setup a listener on add row button\n\t\t// so, once the row is added, move to next step automatically\n\t\t$($add_row).one('click', () => {\n\t\t\tthis.expand_row_and_proceed(step, step.idx + 1); // +1 since add row step is added\n\t\t});\n\t}\n\n\texpand_row_and_proceed(step, start_from) {\n\t\tthis.open_first_row_of(step.fieldname);\n\t\tthis.update_driver_steps(); // need to define again, since driver.js only considers steps which are inside DOM\n\t\tfrappe.utils.sleep(300).then(() => this.driver.start(start_from));\n\t}\n\n\topen_first_row_of(fieldname) {\n\t\tthis.frm.fields_dict[fieldname].grid.grid_rows[0].toggle_view();\n\n\t\t// setup a listener on close row button\n\t\t// so, once the row is closed, move to next step automatically\n\t\tconst $close_row = '.grid-row-open .grid-collapse-row';\n\t\t$($close_row).one('click', () => {\n\t\t\tconst next_step = this.get_next_step();\n\t\t\tconst next_element = next_step.options.is_save_step ? null : next_step.node;\n\n\t\t\tfrappe.utils.scroll_to(next_element, true, 150, null, () => {\n\t\t\t\tthis.driver.moveNext();\n\t\t\t\tfrappe.flags.disable_auto_scroll = false;\n\t\t\t});\n\t\t\tfrappe.flags.disable_auto_scroll = true;\n\t\t});\n\t}\n\n\thandle_child_table_step(step_info) {\n\t\tconst is_last_step = step_info.idx == this.tour.steps.length;\n\n\t\tif (!is_last_step) {\n\t\t\tconst curr_step = step_info;\n\t\t\tconst next_step = this.tour.steps[curr_step.idx];\n\t\t\tconst field = this.frm.get_field(next_step.fieldname);\n\n\t\t\tif (!field) return;\n\n\t\t\t// next step highlights parent field\n\t\t\t// so, add a step to prompt user to collapse grid form\n\t\t\tthis.add_collapse_row_step();\n\n\t\t} else if (this.tour.save_on_complete) {\n\t\t\t// if last step & save on complete is checked\n\t\t\t// add a step to prompt user to collapse grid form\n\t\t\t// to be able to save as a last step\n\t\t\tthis.add_collapse_row_step();\n\t\t}\n\t}\n\n\tadd_collapse_row_step() {\n\t\tconst $close_row = '.grid-row-open .grid-collapse-row';\n\t\tconst close_row_step = {\n\t\t\telement: $close_row,\n\t\t\tpopover: { title: __(\"Collapse\"), description: \"\", position: \"left\" },\n\t\t\tonNext: () => {\n\t\t\t\tif (cur_frm.cur_grid) {\n\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tthis.driver_steps.push(close_row_step);\n\t}\n\n\tadd_step_to_save() {\n\t\tconst page_id = `[id=\"page-${this.frm.doctype}\"]`;\n\t\tconst $save_btn = `${page_id} .standard-actions .primary-action`;\n\t\tconst save_step = {\n\t\t\telement: $save_btn,\n\t\t\tis_save_step: true,\n\t\t\tallowClose: false,\n\t\t\toverlayClickNext: false,\n\t\t\tpopover: {\n\t\t\t\ttitle: __(\"Save\"),\n\t\t\t\tdescription: \"\",\n\t\t\t\tposition: \"left\",\n\t\t\t\tdoneBtnText: __(\"Save\")\n\t\t\t},\n\t\t\tonNext: () => {\n\t\t\t\tthis.frm.save();\n\t\t\t}\n\t\t};\n\t\tthis.driver_steps.push(save_step);\n\t\tfrappe.ui.form.on(this.frm.doctype, 'after_save', () => this.on_finish && this.on_finish());\n\t}\n\n\thandle_attach_image_steps() {\n\t\t$('.btn-attach').one('click', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst modal_element = $(\".file-uploader\").closest(\".modal-content\");\n\t\t\t\tconst attach_dialog_step = {\n\t\t\t\t\telement: modal_element[0],\n\t\t\t\t\tallowClose: false,\n\t\t\t\t\toverlayClickNext: false,\n\t\t\t\t\tpopover: {\n\t\t\t\t\t\ttitle: __(\"Select an Image\"),\n\t\t\t\t\t\tdescription: \"\",\n\t\t\t\t\t\tposition: \"left\",\n\t\t\t\t\t\tdoneBtnText: __(\"Next\")\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis.driver_steps.splice(this.driver.currentStep + 1, 0, attach_dialog_step);\n\t\t\t\tthis.update_driver_steps(); // need to define again, since driver.js only considers steps which are inside DOM\n\t\t\t\tthis.driver.moveNext();\n\t\t\t\tthis.driver.overlay.refresh();\n\n\t\t\t\tmodal_element.closest('.modal').on('hidden.bs.modal', () => {\n\t\t\t\t\tthis.driver.moveNext();\n\t\t\t\t});\n\n\t\t\t}, 500);\n\t\t});\n\t}\n};\n", "export class UndoManager {\n\tconstructor({ frm }) {\n\t\tthis.frm = frm;\n\t\tthis.undo_stack = [];\n\t\tthis.redo_stack = [];\n\t}\n\trecord_change({\n\t\tfieldname,\n\t\told_value,\n\t\tnew_value,\n\t\tdoctype,\n\t\tdocname,\n\t\tis_child,\n\t}) {\n\t\tif (old_value == new_value) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.undo_stack.push({\n\t\t\tfieldname,\n\t\t\told_value,\n\t\t\tnew_value,\n\t\t\tdoctype,\n\t\t\tdocname,\n\t\t\tis_child,\n\t\t});\n\t}\n\n\terase_history() {\n\t\tthis.undo_stack = [];\n\t\tthis.redo_stack = [];\n\t}\n\n\tundo() {\n\t\tconst change = this.undo_stack.pop();\n\t\tif (change) {\n\t\t\tthis._apply_change(change);\n\t\t\tthis._push_reverse_entry(change, this.redo_stack);\n\t\t} else {\n\t\t\tthis._show_alert(__(\"Nothing left to undo\"));\n\t\t}\n\t}\n\n\tredo() {\n\t\tconst change = this.redo_stack.pop();\n\t\tif (change) {\n\t\t\tthis._apply_change(change);\n\t\t\tthis._push_reverse_entry(change, this.undo_stack);\n\t\t} else {\n\t\t\tthis._show_alert(__(\"Nothing left to redo\"));\n\t\t}\n\t}\n\n\t_push_reverse_entry(change, stack) {\n\t\tstack.push({\n\t\t\t...change,\n\t\t\tnew_value: change.old_value,\n\t\t\told_value: change.new_value,\n\t\t});\n\t}\n\n\t_apply_change(change) {\n\t\tif (change.is_child) {\n\t\t\tfrappe.model.set_value(\n\t\t\t\tchange.doctype,\n\t\t\t\tchange.docname,\n\t\t\t\tchange.fieldname,\n\t\t\t\tchange.old_value\n\t\t\t);\n\t\t} else {\n\t\t\tthis.frm.set_value(change.fieldname, change.old_value);\n\t\t\tthis.frm.scroll_to_field(change.fieldname, false);\n\t\t}\n\t}\n\n\t_show_alert(msg) {\n\t\t// reduce duration\n\t\t// keyboard interactions shouldn't have long running annoying toasts\n\t\tfrappe.show_alert(msg, 3);\n\t}\n}\n", "frappe.provide('frappe.model');\nfrappe.provide('frappe.utils');\n\n/**\n * Opens the Website Meta Tag form if it exists for {route}\n * or creates a new doc and opens the form\n */\nfrappe.utils.set_meta_tag = function(route) {\n\tfrappe.db.exists('Website Route Meta', route)\n\t\t.then(exists => {\n\t\t\tif (exists) {\n\t\t\t\tfrappe.set_route('Form', 'Website Route Meta', route);\n\t\t\t} else {\n\t\t\t\t// new doc\n\t\t\t\tconst doc = frappe.model.get_new_doc('Website Route Meta');\n\t\t\t\tdoc.__newname = route;\n\t\t\t\tfrappe.set_route('Form', doc.doctype, doc.name);\n\t\t\t}\n\t\t});\n};\n", "frappe.provide(\"frappe.model\");\n\n/*\n\tCommon class for handling client side interactions that\n\tapply to both DocType form and customize form.\n*/\nfrappe.model.DocTypeController = class DocTypeController extends frappe.ui.form.Controller {\n\tsetup() {\n\t\t// setup formatters for fieldtype\n\t\tfrappe.meta.docfield_map[this.frm.doctype==='DocType' ? 'DocField' : 'Customize Form Field'].fieldtype.formatter = (value) => {\n\t\t\tconst prefix = {\n\t\t\t\t'Tab Break': '\uD83D\uDD34',\n\t\t\t\t'Section Break': '\uD83D\uDD35',\n\t\t\t\t'Column Break': '\uD83D\uDFE1',\n\t\t\t};\n\t\t\tif (prefix[value]) {\n\t\t\t\tvalue = prefix[value] + ' ' + value;\n\t\t\t}\n\t\t\treturn value;\n\t\t};\n\t}\n\n\tmax_attachments() {\n\t\tif (!this.frm.doc.max_attachments) {\n\t\t\treturn;\n\t\t}\n\t\tconst is_attach_field = (f) => [\"Attach\", \"Attach Image\"].includes(f.fieldtype);\n\t\tconst no_of_attach_fields = this.frm.doc.fields.filter(is_attach_field).length;\n\n\t\tif (no_of_attach_fields > this.frm.doc.max_attachments) {\n\t\t\tthis.frm.set_value(\"max_attachments\", no_of_attach_fields);\n\t\t\tconst label = this.frm.get_docfield(\"max_attachments\").label;\n\t\t\tfrappe.show_alert(\n\t\t\t\t__(\"Number of attachment fields are more than {}, limit updated to {}.\", [label, no_of_attach_fields]));\n\t\t}\n\t}\n\n\tnaming_rule() {\n\t\t// set the \"autoname\" property based on naming_rule\n\t\tif (this.frm.doc.naming_rule && !this.frm.__from_autoname) {\n\n\t\t\t// flag to avoid recursion\n\t\t\tthis.frm.__from_naming_rule = true;\n\n\t\t\tconst naming_rule_default_autoname_map = {\n\t\t\t\t\"Autoincrement\": \"autoincrement\",\n\t\t\t\t\"Set by user\": \"prompt\",\n\t\t\t\t\"By fieldname\": \"field:\",\n\t\t\t\t'By \"Naming Series\" field': \"naming_series:\",\n\t\t\t\t\"Expression\": \"format:\",\n\t\t\t\t\"Expression (sld style)\": \"\",\n\t\t\t\t\"Random\": \"hash\",\n\t\t\t\t\"By script\": \"\"\n\t\t\t};\n\t\t\tthis.frm.set_value(\"autoname\", naming_rule_default_autoname_map[this.frm.doc.naming_rule] || \"\");\n\t\t\tsetTimeout(() => (this.frm.__from_naming_rule = false), 500);\n\n\t\t\tthis.set_naming_rule_description();\n\t\t}\n\n\t}\n\n\tset_naming_rule_description() {\n\t\tlet naming_rule_description = {\n\t\t\t'Set by user': '',\n\t\t\t'Autoincrement': 'Uses Auto Increment feature of database.<br><b>WARNING: After using this option, any other naming option will not be accessible.</b>',\n\t\t\t'By fieldname': 'Format: <code>field:[fieldname]</code>. Valid fieldname must exist',\n\t\t\t'By \"Naming Series\" field': 'Format: <code>naming_series:[fieldname]</code>. Default fieldname is <code>naming_series</code>',\n\t\t\t'Expression': 'Format: <code>format:EXAMPLE-{MM}morewords{fieldname1}-{fieldname2}-{#####}</code> - Replace all braced words (fieldnames, date words (DD, MM, YY), series) with their value. Outside braces, any characters can be used.',\n\t\t\t'Expression (old style)': 'Format: <code>EXAMPLE-.#####</code> Series by prefix (separated by a dot)',\n\t\t\t'Random': '',\n\t\t\t'By script': ''\n\t\t};\n\n\t\tif (this.frm.doc.naming_rule) {\n\t\t\tthis.frm.get_field('autoname').set_description(naming_rule_description[this.frm.doc.naming_rule]);\n\t\t}\n\t}\n\n\tautoname() {\n\t\t// set naming_rule based on autoname (for old doctypes where its not been set)\n\t\tif (this.frm.doc.autoname && !this.frm.doc.naming_rule && !this.frm.__from_naming_rule) {\n\t\t\t// flag to avoid recursion\n\t\t\tthis.frm.__from_autoname = true;\n\t\t\tconst autoname = this.frm.doc.autoname.toLowerCase();\n\n\t\t\tif (autoname === \"prompt\")\n\t\t\t\tthis.frm.set_value(\"naming_rule\", \"Set by user\");\n\t\t\telse if (autoname === \"autoincrement\")\n\t\t\t\tthis.frm.set_value(\"naming_rule\", \"Autoincrement\");\n\t\t\telse if (autoname.startsWith(\"field:\"))\n\t\t\t\tthis.frm.set_value(\"naming_rule\", \"By fieldname\");\n\t\t\telse if (autoname.startsWith(\"naming_series:\"))\n\t\t\t\tthis.frm.set_value(\"naming_rule\", 'By \"Naming Series\" field');\n\t\t\telse if (autoname.startsWith(\"format:\"))\n\t\t\t\tthis.frm.set_value(\"naming_rule\", \"Expression\");\n\t\t\telse if (autoname === \"hash\")\n\t\t\t\tthis.frm.set_value(\"naming_rule\", \"Random\");\n\t\t\telse\n\t\t\t\tthis.frm.set_value(\"naming_rule\", \"Expression (old style)\");\n\n\t\t\tsetTimeout(() => (this.frm.__from_autoname = false), 500);\n\t\t}\n\n\t\tthis.frm.set_df_property('fields', 'reqd', this.frm.doc.autoname !== 'Prompt');\n\t}\n};\n"],
  "mappings": "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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAnC,SAAO,UAAU,kBAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAnC,SAAO,UAAU,kBAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAnC,SAAO,UAAU,iBAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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",
  "names": []
}
